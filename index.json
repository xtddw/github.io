[{"content":" Python Cookbook Python Web å…¥å‘æŒ‡å— ã€ŠPython in Practiceã€‹ Pythoné¢è¯•é¢˜ ã€Šwriting idiomatic python ebookã€‹ ã€ŠPython 3 Patterns, Recipes and Idiomsã€‹ ã€Š30ä¸ªæœ‰å…³Pythonçš„å°æŠ€å·§ã€‹ ã€ŠHidden features of Pythonã€‹ ã€ŠPythonç¨‹åºå‘˜çš„10ä¸ªå¸¸è§é”™è¯¯ã€‹ ã€ŠPythoné«˜çº§ç¼–ç¨‹slideã€‹ ã€ŠEffective Pythonã€‹ ã€Šç¼–å†™é«˜è´¨é‡ä»£ç ï¼šæ”¹å–„Pythonç¨‹åºçš„91ä¸ªå»ºè®®ã€‹ ã€ŠCode Like a Pythonista: Idiomatic Pythonã€‹ ã€ŠThe Little Book of Python Anti-Patternsã€‹  None ç©ºç±»å‹æ˜¯å¯¹è±¡ != ç©ºå­—ç¬¦ä¸²ã€ç©ºåˆ—è¡¨ã€0ã€False(å€¼å’Œç±»å‹éƒ½ä¸ç›¸åŒ)\nåˆ¤ç©ºï¼š\n1 2 3 4  if a:\rpass\rif not a:\rpass\r  å¯¹è±¡å­˜åœ¨ä¸ä¸€å®šä¸ºçœŸï¼\n1 2 3 4 5  class obj():\rdef __bool__(self):\rpass\rdef __len__(self):\rpass\r  å¸¸é‡å…¨å¤§å†™ ACCOUNT\nnew å’Œ init çš„åŒºåˆ«\n new æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œinit æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³• new æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªåˆ›å»ºçš„å®ä¾‹ï¼Œè€Œ init ä»€ä¹ˆéƒ½ä¸è¿”å› åªæœ‰ new è¿”å›ä¸€ä¸ª cls å®ä¾‹æ—¶ï¼Œåé¢çš„ init æ‰ä¼šè¢«è°ƒç”¨ å½“åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹æ—¶è°ƒç”¨ newï¼Œåˆå§‹åŒ–å®ä¾‹æ—¶ç”¨ init  Write Idiom Python 1 2 3  # é“¾å¼æ¯”è¾ƒ  if 1 \u0026lt; a \u0026lt; b:\rpass\r  1 2 3 4  #äº¤æ¢å˜é‡\r x = 10\ry = 5\rx, y = y, x\r  1 2  # ä¸‰ç›®è¿ç®—\r c = a if a ) b else b\r  1 2  # æ‹¼æ¥å­—ç¬¦åˆ—è¡¨æ—¶ï¼Œç”¨joinæ–¹æ³•å»å®ç°\r \u0026#34;.\u0026#34;.join(string_list)\r  1 2  # æ ¼å¼åŒ–å­—ç¬¦æ—¶å¤šä½¿ç”¨formatå‡½æ•°\r str = \u0026#34;myname: {} myage:{}\u0026#34;.format(name,age)\r  1 2 3  # è¿­ä»£å¼\r odd_list = [e for e in mylist if e % 2 == 1]\r{user[\u0026#39;name\u0026#39;]:user[\u0026#39;email\u0026#39;] for user in user_list if \u0026#39;email\u0026#39; in user}\r  1 2 3 4 5  # æ¡ä»¶åˆ¤æ–­æ—¶ï¼Œé¿å…ç›´æ¥å’ŒTrue, False, Noneè¿›è¡Œæ¯”è¾ƒ(==)\r if var:\rpass\rif somethin is None:\rpass\r  1 2 3  # ä½¿ç”¨enumerateä»£æ›¿forå¾ªç¯ä¸­çš„indexå˜é‡è®¿é—®\r for index, element in enumerate(my_container):\rprint \u0026#39;%d%s\u0026#39; % (index, element)\r  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  # é¿å…ä½¿ç”¨å¯å˜(mutable)å˜é‡ä½œä¸ºå‡½æ•°å‚æ•°çš„é»˜è®¤åˆå§‹åŒ–å€¼\r # bad\r def function(l = []):\rl.append(1)\rreturn l\rprint function()\rprint function()\rprint function()\r# print\r [1]\r[1, 1]\r[1, 1, 1]\r# good ä½¿ç”¨Noneä½œä¸ºå¯å˜å¯¹è±¡å ä½ç¬¦\r def function(l=None):\rif l is None:\rl = []\rl.append(1)\rreturn l\r  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  # ç”¨dictå¯¹è±¡å®Œæˆswitch...case...çš„åŠŸèƒ½\r # bad\r def apply_operation(left_operand, right_operand, operator):\rif operator == \u0026#39;+\u0026#39;:\rreturn left_operand + right_operand\relif operator == \u0026#39;-\u0026#39;:\rreturn left_operand - right_operand\relif operator == \u0026#39;*\u0026#39;:\rreturn left_operand * right_operand\relif operator == \u0026#39;/\u0026#39;:\rreturn left_operand / right_operand\r# good\r def apply_operation(left_operand, right_operand, operator):\rimport operator as op\roperator_mapper = {\u0026#39;+\u0026#39;: op.add, \u0026#39;-\u0026#39;: op.sub, \u0026#39;*\u0026#39;: op.mul, \u0026#39;/\u0026#39;: op.truediv}\rreturn operator_mapper[operator](left_operand, right_operand)\r  1 2 3 4 5 6 7 8 9 10 11 12  # è®¿é—®tupleçš„æ•°æ®é¡¹æ—¶ï¼Œå¯ä»¥ç”¨namedtupleä»£æ›¿indexçš„æ–¹å¼è®¿é—®\r # bad\r rows = [(\u0026#39;lily\u0026#39;, 20, 2000), (\u0026#39;lucy\u0026#39;, 19, 2500)]\rfor row in rows:\rprint \u0026#39;{}`age is {}, salary is {} \u0026#39;.format(row[0], row[1], row[2])\r# good\r from collections import namedtuple\rEmployee = namedtuple(\u0026#39;Employee\u0026#39;, \u0026#39;name, age, salary\u0026#39;)\rfor row in rows:\remployee = Employee._make(row)\rprint \u0026#39;{}`age is {}, salary is {} \u0026#39;.format(employee.name, employee.age, employee.salary)\r  1 2 3  # ç”¨isinstanceæ¥åˆ¤æ–­å¯¹è±¡çš„ç±»å‹\r if isinstance(some_object, (list, dict, str, tuple)):\rreturn len(some_object)\r  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  # ç”¨withç®¡ç†æ“ä½œèµ„æºçš„ä¸Šä¸‹æ–‡ç¯å¢ƒ\r #åœ¨ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„åœºæ™¯é‡Œï¼Œå¦‚æ•°æ®åº“æ“ä½œï¼Œæˆ‘ä»¬æ“ä½œconnectionæ—¶ä¸€èˆ¬è¦æ­£å¸¸å…³é—­è¿æ¥ï¼Œè€Œä¸ç®¡æ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯å¼‚å¸¸é€€å‡ºã€‚å¦‚ä¸‹ï¼š\r # bad\r class Connection(object):\rdef execute(self, sql):\rraise Exception(\u0026#39;ohoh, exception!\u0026#39;)\rdef close(self):\rprint \u0026#39;closed the Connection\u0026#39;\rtry:\rconn = Connection()\rconn.execute(\u0026#39;select * from t_users\u0026#39;)\rfinally:\rconn.close()\r# good\r class Connection(object):\rdef execute(self, sql):\rraise Exception(\u0026#39;ohoh, exception!\u0026#39;)\rdef close(self):\rprint \u0026#39;closed the Connection\u0026#39;\rdef __enter__(self):\rreturn self\rdef __exit__(self, errorType, errorValue, error):\rself.close()\rwith Connection() as conn:\rconn.execute(\u0026#39;select * from t_users\u0026#39;)\r  Python æœåŠ¡ç«¯  Pythonè¯­è¨€åŸºç¡€è€ƒå¯Ÿç‚¹ Pythonç®—æ³•ä¸æ•°æ®ç»“æ„è€ƒå¯Ÿç‚¹ ç¼–ç¨‹èŒƒå¼è€ƒå¯Ÿç‚¹ æ“ä½œç³»ç»Ÿè€ƒå¯Ÿç‚¹ ç½‘ç»œç¼–ç¨‹è€ƒå¯Ÿç‚¹ æ•°æ®åº“è€ƒå¯Ÿç‚¹ Python Web æ¡†æ¶è€ƒå¯Ÿç‚¹ ç³»ç»Ÿè®¾è®¡è€ƒå¯Ÿ  ä¸€åˆ‡çš†å¯¹è±¡ python é¢å‘å¯¹è±¡æ›´å½»åº•\nå‡½æ•°å’Œç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå±äºä¸€ç­‰å…¬æ°‘\n å¤åˆ¶ç»™ä¸€ä¸ªå˜é‡  1 2 3 4  def ask(name=\u0026#39;zgx\u0026#39;):\rprint(name)\rmy_func = ask\rmy_func(\u0026#34;zgx\u0026#34;)\r  1 2 3 4 5  class Person:\rdef __init__(self):\rprint(\u0026#34;zgx\u0026#34;)\rmy_class = Person\rPerson()\r   æ·»åŠ åˆ°é›†åˆå¯¹è±¡ä¸­  1 2 3 4  obj_list =[]\robj_list.append(Person)\rfor item_class in obj_list:\rprint(item_class())\r   ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°  1 2  def print_type(item):\rprint(type(item))\r   ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼  1 2 3 4 5 6  def decorator_func():\rprint(\u0026#34;dec start\u0026#34;)\rretun ask\rmy_ask = decorator_func()\rmy_ask(\u0026#34;ENFI\u0026#34;)\r  typeã€objectã€classå…³ç³» type=\u0026gt;class=\u0026gt;obj\ntypeç±»ç”¨æ¥ç”Ÿäº§ç±»ï¼Œç±»æ¥ç”Ÿæˆå®ä¾‹\nobjectæ˜¯æœ€é¡¶å±‚åŸºç±»ï¼Œé»˜è®¤ç»§æ‰¿\ntypeæ˜¯ä¸€ä¸ªç±»ï¼Œä¹Ÿæ˜¯å¯¹è±¡,æ˜¯è‡ªå·±çš„å¯¹è±¡\npythonä¸­å¸¸è§çš„å†…ç½®ç±»å‹   å¯¹è±¡çš„ä¸‰ä¸ªç‰¹å¾:\n èº«ä»½(å¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œid()) ç±»å‹(int,double\u0026hellip;) å€¼    None å…¨å±€å”¯ä¸€\n  æ•°å€¼ç±»å‹\n int float complex bool    è¿­ä»£ç±»å‹\n for    åºåˆ—ç±»å‹\n list bytes\\bytearray\\memoryview(äºŒè¿›åˆ¶åºåˆ—) range tuple str array    æ˜ å°„ç±»å‹\n dict    é›†åˆ\n set frozenset    ä¸Šä¸‹æ–‡ç®¡ç†å™¨\n with    å…¶ä»–\n æ¨¡å—ç±»å‹ classä¸å®ä¾‹obj å‡½æ•°ç±»å‹ æ–¹æ³•ç±»å‹ ä»£ç ç±»å‹ objectå¯¹è±¡ typeç±»å‹ elipsisç±»å‹ï¼ˆçœç•¥å·ï¼‰ notimplementedç±»å¯¹è±¡    é­”æ³•å‡½æ•° åŒä¸‹åˆ’çº¿å¼€å¤´ç»“å°¾,ä¸€èˆ¬ä¸éœ€è¦æ˜¾å¼è°ƒç”¨ï¼Œpythonä¼šè‡ªåŠ¨è°ƒç”¨ã€‚ä½¿ç”¨åä¼šå½±å“ç±»æœ¬èº«çš„æ•°æ®æ¨¡å‹\n__getitem__ å®ç°å¯è¿­ä»£\næ·±å…¥ç†è§£ç±»å’Œå¯¹è±¡ é¸­å­æ¨¡å‹ å®ç°å¤šæ€ï¼Œç±»å®ç°åŒä¸€ä¸ªå‡½æ•°åï¼Œå…·ä½“å‡½æ•°ä½“ä¸åŒ\n1 2 3 4 5 6 7 8 9 10 11 12  class cat:\rdef say(self):\rprint(\u0026#34;i am a cat\u0026#34;)\rclass Dog:\rdef say(self):\rprint(\u0026#34;i am a dog\u0026#34;)\rclass Duck:\rdef say(self):\rprint(\u0026#34;i am a duck\u0026#34;)\ranimal = Cat #Dog #Duck\r animal().say()\r  ","description":"","id":0,"section":"code","tags":null,"title":"Base Python","uri":"https://xtddw.github.io/code/python/base/"},{"content":"Readed  å°ç‹å­ åœ£åŸƒå…‹è‹ä½©é‡Œ å›´åŸ é’±é’Ÿä¹¦ æ´»ç€ ä½™å 1988æˆ‘æƒ³å’Œè¿™ä¸ªä¸–ç•Œè°ˆè°ˆ éŸ©å¯’ å¹³å‡¡çš„ä¸–ç•Œ è·¯é¥ æ˜æœé‚£äº›äº‹å„¿ å½“å¹´æ˜æœˆ ä¸‡å†åäº”å¹´ é»„ä»å®‡ 1Q84 æ‘ä¸Šæ˜¥æ ‘ è¾¹åŸ æ²ˆä»æ–‡ è®¸ä¸‰è§‚å–è¡€è®° ä½™å æ–‡åŒ–è‹¦æ—… ä½™ç§‹é›¨ ä¸‰å›½æ¼”ä¹‰ ç½—è´¯ä¸­ çº¢æ¥¼æ¢¦ æ›¹é›ªèŠ¹ å…„å¼Ÿ ä½™å éº¦ç”°çš„å®ˆæœ›è€… J.D ç™½é¹¿åŸ é™ˆå¿ å® åŒ—äº¬æ³•æºå¯º ææ•– å‘å–Š é²è¿… ä¹Œåˆä¹‹ä¼— å‹’åº é˜¿Qæ­£ä¼  é²è¿… å¦‚ä½•é˜…è¯»ä¸€æœ¬ä¹¦ è‰¾å¾·å‹’ ä¹”å¸ƒæ–¯ä¼  è‰¾è¨å…‹æ£® é•¿æ¨æ­Œ ç‹å®‰å¿† äº¬åçƒŸäº‘ æ—è¯­å ‚ é£é¸Ÿé›† æ³°æˆˆå°” ä¸‰ä½“ åˆ˜æ…ˆæ¬£  Like Read  è§£å¿§æ‚è´§åº— ä¸œé‡åœ­å¾  ","description":"","id":1,"section":"life","tags":null,"title":"Book","uri":"https://xtddw.github.io/life/book/"},{"content":"redis docker pull redis\n åˆ›å»ºrediså®¹å™¨ï¼Œå¯åŠ¨redis-server  docker run -d --name myredis -p 6379:6379 -v /c:/Workspace/redis redis --appendonly yes\ndockersä¸­å¼€å¯ç£ç›˜å…±äº«\nâ€‹\t* -it å¯åŠ¨äº¤äº’ç•Œé¢\n å¯åŠ¨redis cli\n docker exec -it py-redis redis-cli\n  python\npip install redis\n  test\nfrom redis import Redis\nr = Redis(host='127.0.0.1\u0026rsquo;, port=6379, db=0)\n  mysql docker pull mysql\nmkdir docker_v/mysql/conf\ntouch my.conf\ndocker run -p 3306:3306 --name mysql -v /opt/docker_v/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 -d mysql\n","description":"","id":2,"section":"note","tags":null,"title":"docker","uri":"https://xtddw.github.io/note/docker/"},{"content":"ç”¨Pythonicæ–¹å¼æ¥æ€è€ƒ ç¡®è®¤pythonç‰ˆæœ¬  python2 python3 CPython Jython IronPython PyPy  1  python --version\r  1 2 3  import sys\rprint(sys.version)\rprint(sys.version_info)\r  éµå¾ªPEP8é£æ ¼æŒ‡å— python Enhancement Proposal #8\nPylint æºç é™æ€åˆ†æå·¥å…·\nç©ºç™½  ä½¿ç”¨spaceè¡¨ç¤ºç¼©è¿›ï¼Œä¸è¦ä½¿ç”¨tab 4ä¸ªç©ºæ ¼ æ¯è¡Œå­—ç¬¦æ•°ä¸åº”è¶…è¿‡79 å‡½æ•°ä¸ç±»ä¹‹é—´ä¸¤ä¸ªç©ºè¡Œéš”å¼€ åŒä¸€ä¸ªç±»ä¸­ä¸ªæ–¹æ³•ä¹‹é—´ç”¨ä¸€ä¸ªç©ºè¡Œéš”å¼€ ä½¿ç”¨ä¸‹æ ‡æ¥è·å–åˆ—è¡¨å…ƒç´ ã€è°ƒç”¨å‡½æ•°æˆ–ç»™å…³é”®å­—å‚æ•°èµ‹å€¼çš„æ—¶å€™ï¼Œä¸è¦åœ¨ä¸¤æ—æ·»åŠ ç©ºæ ¼ èµ‹å€¼=å‰ååŠ ç©ºæ ¼  å‘½å  å‡½æ•°ã€å˜é‡åŠå±æ€§å°å†™ï¼Œä¸‹åˆ’çº¿è¿æ¥ lowercase_underscore å—ä¿æŠ¤çš„å®ä¾‹å±æ€§ï¼Œå•ä¸‹åˆ’çº¿å¼€å¤´ _leading_underscore ç§æœ‰çš„å®ä¾‹å±æ€§ï¼ŒåŒä¸‹åˆ’çº¿å¼€å¤´ __double_leading_underscore ç±»ä¸å¼‚å¸¸ï¼Œé¦–å­—ç¬¦å¤§å†™ CapitalizWord æ¨¡å—çº§åˆ«çš„å˜é‡ï¼Œåº”å…¨éƒ¨å¤§å†™ï¼Œä¸‹åˆ’çº¿è¿æ¥ ALL_CAPS ç±»ä¸­çš„å®ä¾‹æ–¹æ³•ï¼ˆinstance method),é¦–ä¸ªå‚æ•°å‘½åä¸ºself ç±»æ–¹æ³•ï¼ˆclass method),é¦–ä¸ªå‚æ•°å‘½åä¸ºcls  è¡¨è¾¾å¼å’Œè¯­å¥  é‡‡ç”¨å†…è”å½¢å¼çš„å¦å®šè¯ã€‚ if a is not b \u0026gt; if not a is b ä¸è¦é€šè¿‡æ£€æŸ¥é•¿åº¦çš„æ–¹æ³•æ¥åˆ¤æ–­listæ˜¯å¦ä¸º[]æˆ–'\u0026lsquo;ç­‰ç©ºå€¼ã€‚ if not somelist\u0026gt;if len(somelist)==0 ä¸è¦ç¼–å†™å•è¡Œçš„forã€if ã€whileã€exceptç¬¦åˆè¯­å¥ importè¯­å¥åº”è¯¥æ€»æ˜¯æ”¾åœ¨æ–‡ä»¶å¼€å¤´ å¼•å…¥æ¨¡å—æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨ç»å¯¹åç§°ï¼Œè€Œä¸åº”è¯¥æ ¹æ®å½“å‰æ¨¡å—çš„è·¯å¾„æ¥ä½¿ç”¨ç›¸å¯¹åç§°ã€‚å¼•å…¥baråŒ…ä¸­çš„fooæ¨¡å—æ—¶ï¼Œåº”è¯¥å®Œæ•´åœ°å†™å‡ºfrom bar import foo ã€‹ import foo,æˆ–è€…é‡‡ç”¨æ˜ç¡®å†™æ³• from . import foo  bytes|str|unicodeåŒºåˆ« python3å­—ç¬¦åºåˆ—ç±»å‹\n bytes ï¼ˆå®ä¾‹åŒ…å«åŸå§‹8ä¸ªå­—èŠ‚ï¼‰ str ï¼ˆå®ä¾‹åŒ…å«Unicodeå­—ç¬¦ï¼‰  Unicode=\u0026gt;äºŒè¿›åˆ¶ encode ç¼–ç  UTF-8\näºŒè¿›åˆ¶=ã€‹Unicode decode è§£ç \nè§£ç ä¸ç¼–ç æ“ä½œæ”¾åœ¨ç•Œé¢æœ€å¤–å›´æ¥åšï¼Œç¨‹åºæ ¸å¿ƒéƒ¨åˆ†ä½¿ç”¨Unicodeå­—ç¬¦ç±»å‹ï¼Œè€Œä¸”ä¸è¦å¯¹å­—ç¬¦ç¼–ç åšä»»ä½•å‡è®¾ã€‚\npython3ä¸­ï¼Œå†…ç½®openå‡½æ•°è·å–äº†æ–‡ä»¶å¥æŸ„ï¼Œé»˜è®¤é‡‡ç”¨UTF-8ç¼–ç æ ¼å¼æ¥æ“ä½œæ–‡ä»¶ã€‚openå‡½æ•°æ·»åŠ äº†encodingæ–°å‚æ•°ï¼Œé»˜è®¤å€¼ä¸º'utf-8\u0026rsquo;,å¿…é¡»ä¼ å…¥åŒ…å«Unicodeå­—ç¬¦çš„strå®ä¾‹ï¼Œè€Œä¸æ¥å—åŒ…å«äºŒè¿›åˆ¶çš„byteså®ä¾‹ã€‚\u0026lsquo;wb\u0026rsquo; \u0026lsquo;rb'æ¥å¼€å¯å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜\nç”¨è¾…åŠ©å‡½æ•°æ¥å–ä»£å¤æ‚çš„è¡¨è¾¾å¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  red = int(my_values.get(\u0026#39;red\u0026#39;,[\u0026#39;\u0026#39;])[0] or 0)\rred = my_values.get(\u0026#39;red\u0026#39;,[\u0026#39;\u0026#39;])\rred = int(red[0]) if red[0] else 0\rred = my_values.get(\u0026#39;red\u0026#39;,[\u0026#39;\u0026#39;])\rif red[0]:\rred = int(green[0])\relse:\rred = 0\r## è¾…åŠ©å‡½æ•°å°è£…\r def get_first_int(values,key,default=0):\rfound = values.get(key,[\u0026#39;\u0026#39;])\rif found[0]:\rfound = int(found[0])\relse:\rfound = default\rreturn found\rred = get_first_int(my_values,\u0026#39;red\u0026#39;)\r  äº†è§£åˆ‡å‰²åºåˆ—çš„æ–¹æ³• somelist[startğŸ”šstride]\n start èµ·å§‹ç´¢å¼•ï¼Œæ¶µç›– end ç»“æŸç´¢å¼•ï¼Œä¸æ¶µç›– stride æ­¥è¿›ï¼Œä¸è¦åŒæ—¶ä½¿ç”¨ï¼Œå…ˆèŒƒå›´åˆ‡å‰²ï¼Œå†æ­¥è¿›åˆ‡å‰²ï¼Œè€Œä¸”ä¸è¦è®¾å®šè´Ÿå€¼ start=0æˆ–è€…end=len(list),åº”è¯¥çœç•¥ åˆ‡ç‰‡æ“ä½œä¸ä¼šè®¡è¾ƒstartä¸endæ˜¯å¦è¶Šç•Œ  åˆ—è¡¨æ¨å¯¼å¼æ¥å–ä»£map|filter 1 2 3 4 5 6  a = [1,2,3,4,5,6]\rsquares = [ x**2 for x in a]\rsquares = map(lambda x:x**2,a)\reven_squares = [x**2 for x in a if x%2 == 0]\ralt = map(lambda x:x**2,filter(lambda x:x%2 ==0ï¼Œa))\r  1 2 3 4 5  chile_ranks={\u0026#39;ghost\u0026#39;:1,\u0026#39;habanero\u0026#39;:2,\u0026#39;cayenne\u0026#39;:3}\rrank_dict={rank:name for name,rank in chile_ranks.items()}\r#{ 1:\u0026#39;ghost\u0026#39;,2:\u0026#39;habanero\u0026#39;,3,\u0026#39;cayenne\u0026#39;}\r chile_len_set={len(name) for name in rank_dict.values()}\r## {8,5,7}\r   åˆ—è¡¨æ¨å¯¼å¼æ”¯æŒå¤šçº§å¾ªç¯ï¼Œæ¯ä¸€çº§å¾ªç¯ä¹Ÿæ”¯æŒå¤šé¡¹æ¡ä»¶ï¼Œè¶…è¿‡ä¸¤ä¸ªè¡¨è¾¾å¼çš„åˆ—è¡¨æ¨å¯¼ä¸å»ºè®®ä½¿ç”¨\nç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼æ¥æ”¹å†™æ•°æ®é‡è¾ƒå¤§çš„åˆ—è¡¨æ¨å¯¼ 1 2  value = [len(x) for x in open(\u0026#39;test.txt\u0026#39;)]\r## æ–‡ä»¶è¾ƒå¤§æ—¶ ä¼šå‡ºé—®é¢˜ï¼Œé€‚åˆå°‘é‡çš„è¾“å…¥å€¼\r   ç”Ÿæˆå™¨è¡¨è¾¾å¼generator expressionå¯¹åˆ—è¡¨æ¨å¯¼å’Œç”Ÿæˆå™¨çš„ä¸€ç§æ³›åŒ–\nç”Ÿæˆå™¨è¡¨è¾¾å¼åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šæŠŠæ•´ä¸ªè¾“å‡ºåºåˆ—éƒ½å‘ˆç°å‡ºæ¥ï¼Œè€Œæ˜¯ä¼šä¼°å€¼ä¸ºè¿­ä»£å™¨ï¼ˆiterator)ã€‚æ¯æ¬¡å¯ä»¥æ ¹æ®ç”Ÿæˆå™¨è¡¨è¾¾å¼äº§ç”Ÿä¸€é¡¹æ•°æ®ã€‚\næŠŠå®ç°åˆ—è¡¨æ¨å¯¼æ‰€ç”¨çš„å†™æ³•æ”¾åœ¨ï¼ˆï¼‰ä¸­ï¼Œå°±æ„æˆäº†ç”Ÿæˆå™¨è¡¨è¾¾å¼ã€‚ä»–ä¼šç«‹å³è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè€Œä¸ä¼šæ·±å…¥å¤„ç†æ–‡ä»¶ä¸­çš„å†…å®¹ã€‚\n1 2 3 4  it = (len(x) for x in open(\u0026#39;test.txt\u0026#39;))\r## \u0026lt;generator object ....\u0026gt;\r next(it)\r## 1000\r   å°½é‡ä½¿ç”¨enumerateå–ä»£range enumerateå¯ä»¥æŠŠå„ç§è¿­ä»£å™¨åŒ…è£…ä¸ºç”Ÿæˆå™¨ï¼Œæ¯æ¬¡äº§å‡ºä¸€å¯¹è¾“å‡ºå€¼ï¼Œå‰è€…è¡¨ç¤ºå¾ªç¯ä¸‹æ ‡ï¼Œåè€…è¡¨ç¤ºè¿­ä»£å™¨ä¸­æ¸ é“çš„ä¸‹ä¸€ä¸ªåºåˆ—å…ƒç´ \n1 2 3 4 5  for i, flavor in enumerate(flavor_list):\rprint(\u0026#39;%d:%s\u0026#39; %(i+1,flavor))\r## å¯ä»¥æŒ‡å®šenumerateå‡½æ•°å¼€å§‹è®¡æ•°æ‰€ç”¨å€¼\r for i, flavor in enumerate(flavor_list,1):\rprint(\u0026#39;%d:%s\u0026#39; %(i,flavor))\r  ç”¨zipå‡½æ•°åŒæ—¶éå†ä¸¤ä¸ªè¿­ä»£å™¨ 1 2 3 4 5 6 7 8  names=[\u0026#39;James\u0026#39;,\u0026#39;Kobe\u0026#39;,\u0026#39;Zgx\u0026#39;]\rletters=[len(n) for n in names]\rlongest_name=None\rmax_letters =0\rfor name, count in zip(names,letters):\rif count\u0026gt;max_letters:\rlongest_name = name\rmax_letters = count\r  åˆç†åˆ©ç”¨try/except/else/finally   finally\nè‹¥æ—¢è¦å°†å¼‚å¸¸å‘ä¸Šä¼ æ’­ï¼Œåˆè¦åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶æ‰§è¡Œæ¸…ç†å·¥ä½œ\n  1 2 3 4 5 6 7 8 9  handle = open(\u0026#39;test.txt\u0026#39;)\rtry: data = handle.read()\rfinally:\rhandle.close()\r## æ³¨æ„open æ–¹æ³•å¿…é¡»æ”¾åœ¨tryå—å¤–é¢ï¼Œå¦‚æœæ‰“å¼€æ–‡ä»¶æ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆç¨‹åºåº”è¯¥è·³è¿‡finallyå—ã€‚\r ## ä½¿ç”¨ä¸Šä¸‹æ–‡æ›´ç®€ä¾¿\r with open(\u0026#39;test.txt\u0026#39;) as f:\rdata = f.read()\r   else\ntry/except/elseç»“æœå¯ä»¥æ¸…æ™°æè¿°å‡ºé‚£äº›å¼‚å¸¸ç”±è‡ªå·±çš„ä»£ç å¤„ç†ï¼Œé‚£äº›å¼‚å¸¸ä¼šä¼ æ’­åˆ°ä¸Šä¸€çº§ã€‚å¦‚æœtryå—æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆæ‰§è¡Œelse;å¦‚æœtryå—å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆæ‰§è¡Œexceptå—ã€‚\n  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  def load_json_key(data,key):\rtry:\rresult_dict = json.loads(data) #may raise ValueError\r except ValueError as e:\rraise KeyError from e\relse:\rreturn result_dict[key] ## may raise KeyError\r 3. æ··åˆä½¿ç”¨\r```python def divide_json(path):\rhandle = open(path,\u0026#39;r+\u0026#39;) ## may raise IOError\r try:\rdata = handle.read() ## may raise UnicodeDecodeError\r op = json.loads(data) ## may raise ValueError\r value = (op[\u0026#39;numerator\u0026#39;]/op[\u0026#39;denominator\u0026#39;]) ## may raise ZeroDivisionError\r except ZeroDivisionError as e:\rreturn UNDEFINED\relse:\rop[\u0026#39;result\u0026#39;]= value\rresult = json.dumps(op)\rhandle.write(result) #may raise IOError\r return value\rfinally:\rhandle.close() ## Always runs\r   ","description":"","id":3,"section":"code","tags":null,"title":"effective python","uri":"https://xtddw.github.io/code/python/effective-python/"},{"content":"é…ç½®  ç”¨æˆ·åå’Œé‚®ä»¶\n$ git config --global user.name \u0026quot;zhanggx\u0026quot;\n$ git config --global user.email enfizgx@163.com è®¾ç½®åˆ«å  sudo git config \u0026ndash;system alias.st status sudo git config \u0026ndash;system alias.ci commit sudo git config \u0026ndash;system alias.co checkout sudo git config \u0026ndash;system alias.br branch   å¼€å¯é¢œè‰²æç¤º  git config \u0026ndash;global color.ui true    æ•™ç¨‹ ","description":"","id":4,"section":"note","tags":null,"title":"git","uri":"https://xtddw.github.io/note/git/"},{"content":" FindHao v2ex Hostsä¿®æ”¹ç¿»å¢™  ","description":"","id":5,"section":"note","tags":null,"title":"link","uri":"https://xtddw.github.io/note/link/"},{"content":"ç”µå½±  è‚–ç”³å…‹çš„æ•‘èµ éœ¸ç‹åˆ«å§¬ è¿™ä¸ªæ€æ‰‹ä¸å¤ªå†· åƒä¸åƒå¯» æ³°å¦å°¼å…‹å· é˜¿ç”˜æ­£ä¼  ç›—æ¢¦ç©ºé—´ æµ·ä¸Šé’¢ç´å¸ˆ ä¸‰å‚»å¤§é—¹å®è±å å¿ çŠ¬å…«å…¬çš„æ•…äº‹ å¤§è¯è¥¿æ¸¸ä¹‹å¤§åœ£å¨¶äº²/ä»™å±¥å¥‡ç¼˜ å¤§è¯è¥¿æ¸¸ä¹‹æœˆå…‰å®ç›’ é¾™çŒ« æ•™çˆ¶1/2/3 æå‡»ä¿±ä¹éƒ¨ æ— é—´é“ å¤©ç©ºä¹‹åŸ å°‘å¹´æ´¾çš„å¥‡å¹»æ¼‚æµ é¬¼å­æ¥äº† æ´»ç€ ä¸¤æ†å¤§çƒŸæª å“ˆå°”çš„ç§»åŠ¨åŸå ¡ ä¸ƒå®—ç½ª é¥®é£Ÿç”·å¥³ å…¥æ®“å¸ˆ ç´ åª› é»‘å®¢å¸å›½ è´è¶æ•ˆåº” æ‹¯æ•‘å¤§å…µç‘æ© å¹½çµå…¬ä¸» è®©å­å¼¹é£ é˜³å…‰ç¿çƒ‚çš„æ—¥å­ é‡åº†æ£®æ— å°„é›•è‹±é›„ä¼ ä¹‹ä¸œæˆè¥¿å°± ä¸Šå¸ä¹‹åŸ ç¦é—­å²› è‡´å‘½ID ä¸€ä¸€ æœ«ä»£çš‡å¸ æ‘©ç™»æ—¶ä»£ é£ä¹‹è°· è¤ç«è™«ä¹‹å¢“ å¹¸ç¦ç»ˆç‚¹ç«™ èŠæ¬¡éƒçš„å¤å¤© å€©å¥³å¹½é­‚ ç”µé”¯æƒŠé­‚ è°å½±é‡é‡ é›¨äºº ä¸œé‚ªè¥¿æ¯’ æ€äººå›å¿† å–œå®´ å–œå‰§ä¹‹ç‹ è‹±é›„æœ¬è‰² èŠ±æ ·å¹´å å†°å·æ—¶ä»£ å”ä¼¯è™ç‚¹ç§‹é¦™ ç§’é€Ÿäº”å˜ç±³ é˜¿é£æ­£ä¼  çˆ†è£‚é¼“æ‰‹ ç‰¯å²­è¡—å°‘å¹´æ€äººäº‹ä»¶ é­”å¥³å®…æ€¥ä¾¿ æ–°é¾™é—¨å®¢æ ˆ å›½ç‹çš„æ¼”è®² é—æ„¿æ¸…å• ç–¯ç‹‚çš„çŸ³å¤´ å¤©æ³¨å®š é¢å’Œå›­ æ‘”è·¤å§ï¼çˆ¸çˆ¸ é©´å¾—æ°´ å‰‘é›¨ ä¸€ä¸ªé™Œç”Ÿå¥³äººçš„æ¥ä¿¡ å¤ªé˜³ç…§å¸¸å‡èµ·  ç”µè§†å‰§  èµ°å‘å…±å’Œ å¤©é“ åº·ç†™ç‹æœ ç»å‘½æ¯’å¸ˆ ç”Ÿæ´»å¤§çˆ†ç‚¸ è¶Šç‹± æ¯›éª— å¤§å®…é—¨ äº®å‰‘ å¤–ä¹¡äºº æ­¦æ—å¤–ä¼  æ½œä¼ ä¸‰å›½æ¼”ä¹‰ ç™½é¹¿åŸ å£«å…µçªå‡» èŒ¶é¦† æˆ‘çˆ±æˆ‘å®¶  ","description":"","id":6,"section":"life","tags":null,"title":"Movie","uri":"https://xtddw.github.io/life/movie/"},{"content":" python data structures and algorithms\n  problem-solving-with-algorithms-and-data-structure-using-python  ç¨‹åº = ç®—æ³• + æ•°æ®ç»“æ„\nç®—æ³•ï¼ˆAlgorithmï¼‰ï¼šæ˜¯æŒ‡è§£é¢˜æ–¹æ¡ˆçš„å‡†ç¡®è€Œå®Œæ•´çš„æè¿°ï¼Œæ˜¯ä¸€ç³»åˆ—è§£å†³é—®é¢˜çš„æ¸…æ™°æŒ‡ä»¤ï¼Œç®—æ³•ä»£è¡¨ç€ç”¨ç³»ç»Ÿçš„æ–¹æ³•æè¿°è§£å†³é—®é¢˜çš„ç­–ç•¥æœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œèƒ½å¤Ÿå¯¹ä¸€å®šè§„èŒƒçš„è¾“å…¥ï¼Œåœ¨æœ‰é™æ—¶é—´å†…è·å¾—æ‰€è¦æ±‚çš„è¾“å‡ºã€‚\næ•°æ®ç»“æ„ï¼ˆData Structuresï¼‰ï¼šæ˜¯è®¡ç®—æœºå­˜å‚¨å’Œç»„ç»‡æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥ç”¨æ¥é«˜æ•ˆåœ°å¤„ç†æ•°æ®ã€‚\nä¸¾ä¸ªä¾‹å­ï¼šäºŒåˆ†æŸ¥æ‰¾å°±æ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„ç®—æ³•ï¼Œè€ŒäºŒåˆ†æŸ¥æ‰¾ç»å¸¸éœ€è¦ä½œç”¨åœ¨ä¸€ä¸ªæœ‰åºæ•°ç»„ä¸Šã€‚è¿™é‡ŒäºŒåˆ†å°±æ˜¯ä¸€ç§æŠ˜åŠçš„ç®—æ³•æ€æƒ³ï¼Œ\nè€Œæ•°ç»„æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ”¯æŒæ ¹æ®ä¸‹æ ‡å¿«é€Ÿè®¿é—®ã€‚å¾ˆå¤šç®—æ³•éœ€è¦ç‰¹å®šçš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œæ‰€ä»¥ç»å¸¸æŠŠå®ƒä»¬æ”¾åˆ°ä¸€å—è®²ã€‚\nå®é™…ä¸Šï¼Œåœ¨çœŸæ­£çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œå¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯ ä»æ•°æ®åº“å–æ•°æ® -\u0026gt; æ•°æ®æ“ä½œå’Œç»“æ„åŒ– -\u0026gt; è¿”å›ç»™å‰ç«¯ï¼Œåœ¨æ•°æ®æ“ä½œè¿‡ç¨‹ä¸­éœ€è¦åˆç†åœ°æŠ½è±¡ï¼Œ\nç»„ç»‡ã€å¤„ç†æ•°æ®ï¼Œå¦‚æœé€‰ç”¨äº†é”™è¯¯çš„æ•°æ®ç»“æ„ï¼Œå°±ä¼šé€ æˆä»£ç è¿è¡Œä½æ•ˆã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦å­¦ä¹ ç®—æ³•å’Œæ•°æ®ç»“æ„çš„åŸå› ã€‚\næŠ½è±¡æ•°æ®ç±»å‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹ å†…ç½®å¸¸ç”¨ç®—æ³•å’Œæ•°æ®ç»“æ„  å¸¸ç”¨å†…ç½®æ•°æ®ç±»å‹ï¼šlist, tuple, dict, set, frozenset, collections, heapq, bisect     æ•°æ®ç»“æ„/ç®—æ³• è¯­è¨€å†…ç½® å†…ç½®åº“     çº¿æ€§ç»“æ„ list(åˆ—è¡¨)/tuple(å…ƒç¥–) array(æ•°ç»„ï¼Œä¸å¸¸ç”¨)/collections.namedtuple   é“¾å¼ç»“æ„  collections.deque(åŒç«¯é˜Ÿåˆ—)   å­—å…¸ç»“æ„ dict(å­—å…¸) collections.Counter(è®¡æ•°å™¨)/OrderedDict(æœ‰åºå­—å…¸)/defaultdict   é›†åˆç»“æ„ set(é›†åˆ)/frozenset(ä¸å¯å˜é›†åˆ)    æ’åºç®—æ³• sorted    äºŒåˆ†ç®—æ³•  bisectæ¨¡å—   å †ç®—æ³•  heapqæ¨¡å—   ç¼“å­˜ç®—æ³•  functools.lru_cache(Least Recent Used, python3)    é“¾è¡¨ é˜Ÿåˆ— æ ˆ ç®—æ³•åˆ†æ å“ˆå¸Œè¡¨ å­—å…¸ é›†åˆ é€’å½’ çº¿æ€§æŸ¥æ‰¾ä¸äºŒåˆ†æŸ¥æ‰¾ åŸºæœ¬æ’åºç®—æ³• é«˜çº§æ’åºç®—æ³•  é«˜çº§æ’åºç®—æ³• åˆ†æ²»æ³•ä¸å½’å¹¶æ’åº å¿«é€Ÿæ’åº  æ ‘ä¸äºŒå‰æ ‘ å †å’Œå †æ’åº ä¼˜å…ˆçº§é˜Ÿåˆ— äºŒå‰æŸ¥æ‰¾æ ‘ å›¾ä¸å›¾çš„éå† ","description":"","id":7,"section":"code","tags":null,"title":"Pythonæ•°æ®ç»“æ„ä¸ç®—æ³•","uri":"https://xtddw.github.io/code/python/aads/"},{"content":"set key value\nget key\nmset mget ä¸€æ¬¡è®¾ç½®è¯»å–å¤šä¸ªå€¼\nexists åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨\ndel åˆ é™¤key\ntype æ£€æŸ¥valueç±»å‹\nexpire è®¾ç½®keyçš„æœ‰æ•ˆå€¼ expire key æ—¶é•¿(s)\nex : set key value ex æ—¶é•¿(s)\nttl: æŸ¥çœ‹keyå‰©ä½™æ—¶é—´\n","description":"","id":8,"section":"note","tags":null,"title":"redis","uri":"https://xtddw.github.io/note/redis/"},{"content":"windows  Listary total commander AHK Everything æœç´¢  common  vim|neovim Emacs org-mode Potlayer WW è§†é¢‘æ’­æ”¾å™¨ Foobar2000 éŸ³ä¹æ’­æ”¾å™¨ Ditto å‰ªè´´ç‰ˆåŠ å¼º hexo åšå®¢ mkdocs æ–‡æ¡£ Firefox/Chrome æµè§ˆå™¨ï¼ˆå¥”è·‘çš„å¥¶ç‰›ï¼‰  ä¹¦ç­¾åŒæ­¥ XMarks   é¼ æ ‡æ‰‹åŠ¿ CLEAN crxMouse Gestures vimæ¨¡å¼æ“ä½œ  Vimium githubå¢å¼ºæ ‘ç»“æ„ octotree æƒ æƒ è´­ç‰©åŠ©æ‰‹ è‡ªå®šä¹‰æ˜¾ç¤ºæ ·å¼ stylish ç½‘ç«™ æ’ä»¶ç®¡ç† Tampermonkey (æ²¹çŒ´) æœç´¢è„šæœ¬    ","description":"","id":9,"section":"note","tags":null,"title":"soft","uri":"https://xtddw.github.io/note/soft/"},{"content":"webå‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ èŒä½èŒè´£ï¼š\n  å‚ä¸Webå‰ç«¯é¡¹ç›®æ¶æ„åŠæ ¸å¿ƒä»£ç ç ”å‘å·¥ä½œï¼›\n  å„äº§å“webç«¯åŠŸèƒ½çš„è®¾è®¡å¼€å‘åŠå®ç°ï¼›\n  JSä¸å…¶ä»–è¯­è¨€çš„æ··åˆå‹åº”ç”¨å¼€å‘ï¼›\n  é…åˆåç«¯å·¥ç¨‹å¸ˆå®Œæˆäº§å“å‰å°é¡µé¢çš„å¼€å‘ï¼›\n  æ ¹æ®äº§å“éœ€æ±‚ï¼Œä»æŠ€æœ¯çš„è§’åº¦è¿›è¡Œè¯„ä¼°ï¼Œå¹¶ç»™å‡ºå»ºè®®ï¼Œæ¨åŠ¨ç”¨æˆ·ä½“éªŒçš„ä¼˜åŒ–ã€‚\n  è§£å†³å„ç§æµè§ˆå™¨è®¾å¤‡å’Œç§»åŠ¨è®¾å¤‡çš„å…¼å®¹æ€§é—®é¢˜ï¼›\n  è´Ÿè´£å®Œæˆé¢†å¯¼äº¤åŠå…¶å®ƒå„é¡¹å·¥ä½œï¼›\n  å­¦ä¹ æ–°æŠ€æœ¯ï¼Œæé«˜å¼€å‘èƒ½åŠ›ï¼›\n  å²—ä½è¦æ±‚ï¼š\n æœ¬ç§‘ä»¥ä¸Šå­¦å†ï¼Œå­¦ä¹ èƒ½åŠ›å¼ºï¼Œé€‚åº”èƒ½åŠ›å¥½ã€‚ ç†Ÿæ‚‰javascriptï¼ŒHTMLï¼ŒCSSç­‰ç›¸å…³æŠ€æœ¯ï¼Œç†Ÿæ‚‰é¡µé¢æ¶æ„åŠå¸ƒå±€ã€ç†Ÿæ‚‰æµè§ˆå™¨çš„èµ„æºåŠ è½½ã€æ¸²æŸ“æœºåˆ¶ã€‚ è‡³å°‘ç†Ÿç»ƒæŒæ¡Angularï¼ŒVueï¼ŒReactæ¡†æ¶å…¶ä¸­ä¸€ç§ï¼Œå¹¶æœ‰ç›¸å…³SPAé¡¹ç›®ç»éªŒï¼Œèƒ½å¤Ÿå¤„ç†é¡µé¢å¤æ‚æ•°æ®äº¤äº’ï¼› ç†Ÿç»ƒæŒæ¡å¸¸ç”¨å¼€å‘å·¥å…·å’Œè°ƒè¯•æŠ€å·§ï¼Œå¦‚Gitï¼ŒæŠ“åŒ…å·¥å…·ï¼Œå‘½ä»¤è¡Œç­‰ï¼› è‰¯å¥½çš„ç¼–ç ä¹ æƒ¯å’Œå›¢é˜Ÿåˆä½œç²¾ç¥ï¼Œè¾ƒå¼ºçš„æ²Ÿé€šèƒ½åŠ›åŠè¾ƒå¥½çš„åˆ›æ–°èƒ½åŠ›ï¼Œè¯šå®ã€ç»†è‡´ã€æ•¬ä¸šï¼› 3å¹´ä»¥ä¸ŠWebå‰ç«¯å¼€å‘ç»éªŒè€…ä¼˜å…ˆã€æœ‰Electronä½¿ç”¨ç»éªŒè€…ä¼˜å…ˆã€‚  æ™ºèƒ½å†¶ç‚¼åç«¯å¼€å‘å·¥ç¨‹å¸ˆ èŒä½èŒè´£ï¼š\n  å‚ä¸æœ‰è‰²å†¶ç‚¼æ™ºèƒ½å·¥å‚é¡¹ç›®è®¾è®¡ä¸æ¶æ„è®¾è®¡ã€‚\n  è´Ÿè´£ä¸šåŠ¡æµç¨‹åˆ†æã€è¯¦ç»†è®¾è®¡ã€æ•°æ®åº“è®¾è®¡ã€æµ‹è¯•æŠ¥å‘Šç­‰ç›¸å…³æŠ€æœ¯ææ–™ç¼–åˆ¶å·¥ä½œï¼›\n  è´Ÿè´£ç³»ç»Ÿæ¨¡å—çš„å¼€å‘ä¸å•å…ƒæµ‹è¯•ã€‚\n  è´Ÿè´£å®Œæˆé¢†å¯¼äº¤åŠå…¶å®ƒå„é¡¹å·¥ä½œï¼›\n  å­¦ä¹ æ–°æŠ€æœ¯ï¼Œæé«˜å¼€å‘èƒ½åŠ›ï¼›\n  å²—ä½è¦æ±‚ï¼š\n æœ¬ç§‘ä»¥ä¸Šå­¦å†ï¼Œå­¦ä¹ èƒ½åŠ›å¼ºï¼Œé€‚åº”èƒ½åŠ›å¥½ï¼Œå…³æ³¨æ–°æŠ€æœ¯ï¼› åŸºç¡€çŸ¥è¯†æ‰å®ï¼Œç†Ÿæ‚‰é¢å‘å¯¹è±¡è®¾è®¡æ–¹æ³•ï¼Œç†Ÿæ‚‰å¸¸ç”¨æ•°æ®ç»“æ„ã€ç®—æ³•åŠè®¾è®¡æ¨¡å¼ï¼› ç†Ÿç»ƒæŒæ¡C#æˆ–pythonè¯­è¨€; ç†Ÿæ‚‰Asp dotnet CoreæŠ€æœ¯æ¡†æ¶æˆ–python webå¼€å‘æ¡†æ¶ï¼ˆflaskç†Ÿæ‚‰è€…ä¼˜å…ˆï¼‰; ç†Ÿæ‚‰MySQLã€ SQL Serverç­‰æ•°æ®åº“CURDæ“ä½œ; è‰¯å¥½çš„ç¼–ç ä¹ æƒ¯å’Œå›¢é˜Ÿåˆä½œç²¾ç¥ï¼Œè¾ƒå¼ºçš„æ²Ÿé€šèƒ½åŠ›åŠè¾ƒå¥½çš„åˆ›æ–°èƒ½åŠ›ï¼Œè¯šå®ã€ç»†è‡´ã€æ•¬ä¸š; ç†Ÿç»ƒæŒæ¡å¸¸ç”¨å¼€å‘å·¥å…·å’Œè°ƒè¯•æŠ€å·§ï¼Œå¦‚Gitï¼ŒåŸºæœ¬linuxæ“ä½œç­‰ï¼› å¯¹å¤æ‚çš„æœåŠ¡ç«¯ç³»ç»Ÿæœ‰æ„æ¶ã€ä¼˜åŒ–ç»éªŒè€…ä¼˜å…ˆ; å…·æœ‰å†¶é‡‘ç›¸å…³ä¸“ä¸šå­¦ä¹ èƒŒæ™¯è€…ä¼˜å…ˆ  ","description":"","id":10,"section":"work","tags":null,"title":"äººæ‰æ‹›è˜","uri":"https://xtddw.github.io/work/doc/"},{"content":"é£ä¹‹è°· 1984å¹´ï¼šé£ä¹‹è°·ï¼ˆé£ã®è°·ã®ãƒŠã‚¦ã‚·ã‚«)\nå¤©ç©ºä¹‹åŸ 1986å¹´ï¼šå¤©ç©ºä¹‹åŸ(å¤©ç©ºã®åŸãƒ©ãƒ”ãƒ¥ã‚¿)\né¾™çŒ« 1988å¹´ï¼šé¾™çŒ«(ã¨ãªã‚Šã®ãƒˆãƒˆãƒ­)\né­”å¥³å®…æ€¥ä¾¿ 1989å¹´ï¼šé­”å¥³å®…æ€¥ä¾¿(é­”å¥³ã®å®…æ€¥ä¾¿)\nçº¢çŒª 1992å¹´ï¼šçº¢çŒª(çº¢ã®è±š)\nå¹½çµå…¬ä¸» 1997å¹´ï¼šå¹½çµå…¬ä¸»(ã‚‚ã®ã®ã‘å§«)\nåƒä¸åƒå¯» 2001å¹´ï¼šåƒä¸åƒå¯»(åƒã¨åƒå¯»ã®ç¥éš ã—)\nå“ˆå°”çš„ç§»åŠ¨åŸå ¡ 2004å¹´ï¼šå“ˆå°”çš„ç§»åŠ¨åŸå ¡ï¼ˆãƒã‚¦ãƒ«ã®åŠ¨ãåŸ)\næ‚¬å´–ä¸Šçš„é‡‘é±¼å§¬ 2008å¹´ï¼šæ‚¬å´–ä¸Šçš„é‡‘é±¼å§¬ï¼ˆå´–ã®ä¸Šã®ãƒãƒ‹ãƒ§)\nèµ·é£äº† 2013å¹´ï¼šèµ·é£äº†ï¼ˆé£ç«‹ã¡ã¬)\n","description":"","id":11,"section":"life","tags":null,"title":"å®«å´éª","uri":"https://xtddw.github.io/life/gqj/"},{"content":"ä¼¼æ°´æµå¹´ 2003å¹´9æœˆ\n ç»½æ”¾ ä¼¼æ°´æµå¹´ è¿œ ä¸€è¾ˆå­çš„ååˆ†é’Ÿ ä»Šç”Ÿä»Šä¸– é¥ä¸å¯åŠ ä»€åˆ¹æµ· å…«æœˆç…§ç›¸é¦† æ¸©æš– ä¼ å¥‡ ç´«ç½—å…°  ä¸ºä½ è€Œæ¥ 2005å¹´1æœˆ\n ä¸ºä½ è€Œæ¥ ä¸çŸ¥ä¸è§‰ åœ¨æµ·ä¸Š æ˜å¤©è¿˜ä¼šåœ¨è·¯ä¸Š çˆ¶äº² å‘å¾€ æ‹äºº äº‘ä¸Šçš„æ—¥å­ çºµèº«ä¸€è·³ ä½ åƒä»å‰ä¸€æ ·  ä»€åˆ¹æµ· 2006å¹´10æœˆ\n ä¸çŸ¥ä¸è§‰ ä»€åˆ¹æµ· ä¸€è¾ˆå­çš„ååˆ†é’Ÿ å…«æœˆç…§ç›¸é¦† è¿œ ä¼¼æ°´æµå¹´ ä¸ºä½ è€Œæ¥ çˆ¶äº² ç»½æ”¾ å‘å¾€  æƒ³å¿µä½  2007å¹´4æœˆ\n  æŠšä»™æ¹–\n  é£å¹éº¦æµª\n  ç«¥å¹´\n  è¶…è¶Š\n  æ¾èŠ±æ±Ÿ\n  å¤©ç‹\n  å¼‚ä¹¡äºº\n   è¯ï¼šæå¥\næ›²ï¼šæå¥\næŠ«æ˜Ÿæˆ´æœˆåœ°å¥”æ³¢\nåªä¸ºä¸€æ‰‡çª—\nå½“ä½ è¿·å¤±åœ¨è·¯ä¸Š\nèƒ½å¤Ÿçœ‹è§é‚£ç¯å…‰\nä¸çŸ¥ä¸è§‰æŠŠä»–ä¹¡\nå½“åšäº†æ•…ä¹¡\nåªæ˜¯å¶å°”éš¾è¿‡æ—¶\nä¸ç»æ„é¥æœ›è¿œæ–¹\næ›¾ç»çš„ä¹¡éŸ³\næ‚„æ‚„åœ°éšè—\nè¯´ä¸å‡ºçš„è¯ºè¨€\nä¸€ç›´æ”¾å¿ƒä¸Š\næœ‰è®¸å¤šæ—¶å€™\nçœ¼æ³ªå°±è¦æµ\né‚£æ‰‡çª—æ˜¯è®©æˆ‘åšå¼ºçš„ç†ç”±\nå°å°çš„é—¨å£\nè¿˜æœ‰å¥¹çš„æ¸©æŸ”\nç»™æˆ‘æ¸©æš–é™ªä¼´æˆ‘å·¦å³\n   æƒ³å¿µä½ \n  å°é¸Ÿç¡åœ¨æˆ‘èº«æ—\n  å¼‚ä¹¡äººï¼ˆä¼´å¥ï¼‰\n  å¯‚å¯æ˜Ÿç©ºÂ·è§æ­Œ 2008å¹´10æœˆ\n é¥è¿œçš„å¤©ç©ºåº•ä¸‹ éœ²å¤©ç”µå½±é™¢ çŸœæŒ é™€èº æººçˆ± å¤§æµ·å•Š,æ•…ä¹¡ æ¢¦ä¸€åœº çª—å° ç»’èŠ± å†åˆ«åº·æ¡¥  éŸ³ä¹å‚²éª¨ 2009å¹´12æœˆ\n ç’€ç’¨   ä½œæ›² : æå¥\nä½œè¯ : æå¥\næ²¡æœ‰ä¸€æœµèŠ± ç•™ä½å®ƒçš„å­£èŠ‚\nåƒæˆ‘ä¸€æ · ä¸èƒ½åœ¨ä½ èº«è¾¹ åˆ°æ°¸è¿œ\næ€»æœ‰ä¸€é˜µé£ è¦å¸¦èµ°äº›ä»€ä¹ˆ\nåƒä½ ä¸€æ · ç¦»å»æ—¶æ€»ä¸è¯´ å†è§\nç”Ÿå‘½å¦‚æ­¤æ— å¸¸\næˆ‘æ€»æ˜¯ä¸€æ · ä¸åœåœ°è¿½å¯»æˆ‘ç»ˆç©¶è¦ å¤±å»çš„\nåƒä¸€é˜µé£åœ¨åŸé‡æµæµª\nç”Ÿå‘½å°±æ˜¯è¿™æ ·\næˆ‘å´æ˜¯æ— å¸¸ æ°¸è¿œä¸çŸ¥é“ä¸‹ä¸€åˆ» æ¬¢ä¹æˆ–æ‚²ä¼¤\nåƒæ²³æ°´æ¼«æ— ç›®çš„æµæ·Œ\nå¤šç»šçƒ‚çš„èŠ± å¤šç¾å¦™çš„å­£èŠ‚\nè¯´æˆ‘çˆ±ä½  è¯·ä½ ä¸€å®šç›¸ä¿¡ è¿™ä¸€åˆ»\næ€»æœ‰ä¸€é˜µé£ è¦å¸¦èµ°äº›ä»€ä¹ˆ\nåƒä½ ä¸€æ · ç¦»å»æ—¶æ€»ä¸è¯´ å†è§\nç”Ÿå‘½å¦‚æ­¤æ— å¸¸\næˆ‘æ€»æ˜¯ä¸€æ · ä¸åœåœ°è¿½å¯»æˆ‘ç»ˆç©¶è¦ å¤±å»çš„\nåƒä¸€é˜µé£åœ¨åŸé‡æµæµª\nç”Ÿå‘½å°±æ˜¯è¿™æ ·\næˆ‘å´æ˜¯æ— å¸¸ æ°¸è¿œä¸çŸ¥é“ä¸‹ä¸€åˆ» æ¬¢ä¹æˆ–æ‚²ä¼¤\nåƒæ²³æ°´æ¼«æ— ç›®çš„æµæ·Œ\nå¤šç»šçƒ‚çš„èŠ± å¤šç¾å¦™çš„å­£èŠ‚\næˆ‘è¯´çˆ±ä½  è¯·ä½ ä¸€å®šç›¸ä¿¡ è¿™ä¸€åˆ‡\n   ä¸€å¾€æƒ…æ·±çš„æ‹äºº\n  åœ£æ´ä¹‹å…‰\n  å®Œç¾åšæŒ\n  åœ¨æ¯ä¸ªæƒ³ä½ çš„å¤œé‡Œ\n  æ•…ä¹¡å±±å·\n   ä½œæ›² : æå¥\nä½œè¯ : æå¥\nå½“å¾®é£é€èŠ±è‰æ¸…é¦™\næ­£æ˜¯æˆ‘æƒ³ä½ çš„å­£èŠ‚\nè¿œæ–¹çš„å®¶æ˜¯å¦æ— æ™\næ±Ÿæ°´æ—¥å¤œæµæ·Œ\nå½“é£ç­å·²æ¼«å¤©é£æ—‹\næ›¾æ˜¯ä½ æœ›çœ¼æ¬²ç©¿\nå¾€æ—¥æ—¶å…‰\nåŒ†åŒ†æµæ°´\nå¸¦ä½ å¥”å‘ä½•æ–¹\næˆ‘å¿ƒä¸­çš„ä¸–ç•Œç«Ÿæ˜¯å¦‚æ­¤é¥è¿œ\nä¸çŸ¥ä¸è§‰ä¸­å·²ç¦»å®¶åƒä¸‡é‡Œ\næ­¤åˆ»ç¯ç«è¾‰ç…Œå¤šæƒ³ä¸ä½ åˆ†äº«\nå´å†ä¹Ÿä¸èƒ½å›åˆ°ä½ èº«è¾¹\nè„šä¸‹è™½æœ‰ä¸‡æ°´åƒå±±\nå´è¿œä¸è¿‡å¯¹ä½ çš„æ€å¿µ\nçœ‹è¿‡å¤šå°‘\næœˆè½æ—¥å‡º\næ²¡æœ‰ç›¸åŒçš„ä¸€å¤©\næ¯å½“é›ªèŠ±ç»½æ”¾\nå¿ƒä¹Ÿè·Ÿéšé£èˆ\næ›¾ç»çš„å€™é¸Ÿ\nå¦‚ä»Šèº«åœ¨ä½•å¤„\nåœ¨é‚£é¥è¿œåœ°æ–¹\nç¯ç«ä¾ç„¶æ˜é»„\nå´æ— æ•°æ¬¡\nç…§äº®æˆ‘çš„æ¢¦ä¹¡\næˆ‘å¿ƒä¸­çš„ä¸–ç•Œç«Ÿæ˜¯å¦‚æ­¤é¥è¿œ\nä¸çŸ¥ä¸è§‰ä¸­å·²ç¦»å®¶åƒä¸‡é‡Œ\nåœ¨é‚£é¥è¿œåœ°æ–¹ç¯ç«ä¾ç„¶æ˜é»„\nå´æ— æ•°æ¬¡ç…§äº®æˆ‘çš„æ¢¦ä¹¡\n  Lily çˆ±çš„å››å­£ è½¬çœ¼ç¬é—´ å¥½æœ›è§’ æˆ‘çš„æœ‹å‹ ä¼ å¥‡ (2010ç‰ˆ) *å†ç‰ˆBonus Track  ä¼ å¥‡ 2010å¹´7æœˆ\n ä¼ å¥‡ å½“æœ‰å¤©è€å» *æ–°æ­Œ ä¼¼æ°´æµå¹´ ç»½æ”¾ æˆ‘æ„¿äººé•¿ä¹… *æ–°æ­Œ è¿œ ä¸ºä½ è€Œæ¥ äº‘ä¸Šçš„æ—¥å­ å…«æœˆç…§ç›¸é¦† æ‹äºº ä»€åˆ¹æµ· å‘å¾€ çˆ¶äº² ä¸€è¾ˆå­çš„ååˆ†é’Ÿ  ä¾ç„¶ 2011å¹´12æœˆ\n å¿ƒå‡æ˜æœˆ Color Me Love æˆ‘å§‹ç»ˆåœ¨è¿™é‡Œ å›åˆ°ä»å‰ èˆå¾— ççˆ±æ·±æ·± ä¾ç„¶åœ¨è·¯ä¸Š è´åŠ å°”æ¹–ç•” çœ·æ‹ å‡Œæ™¨ä¸¤ç‚¹ è°¢è°¢ä½   æ‹¾å…‰ 2013å¹´9æœˆ\n  å‘å¾€\n  æŠšä»™æ¹–\n  ä¸ºä½ è€Œæ¥\n  å¼‚ä¹¡äºº\n  é£å¹éº¦æµª\n  è¿œ\n  ä½ åƒä»å‰ä¸€æ ·\n  ç»½æ”¾\n  å…«æœˆç…§ç›¸é¦†\n  æ‹äºº\n  ä¸½æ±Ÿ\n  å½“æœ‰å¤©è€å»\n  ä¸€å¾€æƒ…æ·±çš„æ‹äºº\n  ä»Šç”Ÿä»Šä¸–é¥ä¸å¯åŠ\n  çˆ¶äº²\n  ä¼ å¥‡ (2013é‡å”±ç‰ˆ)\n  æå¥ 2015å¹´8æœˆ\n  æ·±æµ·ä¹‹å¯»\n  ç¾è‹¥é»æ˜\n  æ—¥è½ä¹‹å‰\n  æ²§æµ·è½»èˆŸ\n  é›¨ååˆæ™´\n  ä¼—å¦™\n  è¿·é›¾\n  é£å¹é»„æ˜\n  æ¶ˆå¤±çš„æœˆå…‰\n  å‡å¦‚çˆ±æœ‰å¤©æ„\n   è¯ï¼šæå¥\næ›²ï¼šYoo Young Seok\nå½“å¤©è¾¹é‚£é¢—æ˜Ÿå‡ºç°\nä½ å¯çŸ¥æˆ‘åˆå¼€å§‹æƒ³å¿µ\næœ‰å¤šå°‘çˆ±æ‹åªèƒ½é¥é¥ç›¸æœ›\nå°±åƒæœˆå…‰æ´’å‘æµ·é¢\nå¹´å°‘çš„æˆ‘ä»¬æ›¾ä»¥ä¸º\nç›¸çˆ±çš„äººå°±èƒ½åˆ°æ°¸è¿œ\nå½“æˆ‘ä»¬ç›¸ä¿¡æƒ…åˆ°æ·±å¤„åœ¨ä¸€èµ·\nå¬ä¸è§é£ä¸­çš„å¹æ¯\nè°çŸ¥é“çˆ±æ˜¯ä»€ä¹ˆ\nçŸ­æš‚çš„ç›¸é‡å´å¿µå¿µä¸å¿˜\nç”¨å°½ä¸€ç”Ÿçš„æ—¶é—´\nç«Ÿå­¦ä¸ä¼šé—å¿˜\nå¦‚ä»Šæˆ‘ä»¬å·²å¤©å„ä¸€æ–¹\nç”Ÿæ´»å¾—åƒå‘¨å›´äººä¸€æ ·\nçœ¼å‰äººç»™æˆ‘æœ€ä¿¡ä»»çš„ä¾èµ–\nä½†æ„¿ä½ è¢«æ¸©æŸ”å¯¹å¾…\nå¤šå°‘ææƒšçš„æ—¶å€™\nä»¿ä½›çœ‹è§ä½ åœ¨äººæµ·å·æµ\néšçº¦ä¸­ä½ å·²æµ®ç°\nä¸€è½¬çœ¼åˆä¸è§\nçŸ­æš‚çš„ç›¸é‡å´å¿µå¿µä¸å¿˜\nå¤šå°‘ææƒšçš„æ—¶å€™\nä»¿ä½›çœ‹è§ä½ åœ¨äººæµ·å·æµ\néšçº¦ä¸­ä½ å·²æµ®ç°\nä¸€è½¬çœ¼åˆä¸è§\nå½“å¤©è¾¹é‚£é¢—æ˜Ÿå‡ºç°\nä½ å¯çŸ¥æˆ‘åˆå¼€å§‹æƒ³å¿µ\næœ‰å¤šå°‘çˆ±æ‹ä»Šç”Ÿæ— å¤„å®‰æ”¾\nå†¥å†¥ä¸­ä»€ä¹ˆå·²æ”¹å˜\næœˆå…‰å¦‚æ˜¥é£æ‹‚é¢\n ","description":"","id":12,"section":"life","tags":null,"title":"æå¥","uri":"https://xtddw.github.io/life/lijian/"},{"content":"é¥®é…’-é™¶æ¸Šæ˜  ç»“åºåœ¨äººå¢ƒï¼Œè€Œæ— è½¦é©¬å–§\né—®å›ä½•èƒ½å°”ï¼Œå¿ƒè¿œåœ°è‡ªå\né‡‡èŠä¸œç¯±ä¸‹ï¼Œæ‚ ç„¶è§å—å±±\nå±±æ°”æ—¥å¤•ä½³ï¼Œé£é¸Ÿç›¸ä¸è¿˜\næ­¤ä¸­æœ‰çœŸæ„ï¼Œæ¬²è¾¨å·²å¿˜è¨€\n ","description":"","id":13,"section":"post","tags":null,"title":"è¯—è¯","uri":"https://xtddw.github.io/post/01_%E8%AF%97%E8%AF%8D/"},{"content":"æ±Ÿé“œè´µæºªå†¶ç‚¼å‚ é‡åº†é¦–å±Šæ™ºåšä¼š Smart China Export\n","description":"","id":14,"section":"work","tags":null,"title":"è°ƒç ”è€ƒå¯Ÿ","uri":"https://xtddw.github.io/work/log/"},{"content":"å®‰è£…å·¥å…·  Nodejs npm Angular CLI   npm install -g @angular/cli\n é¡¹ç›®å»ºç«‹ ng new blog-client\ncd my-app\nng serve â€“open (aliasng serve -o)\n å¸¸ç”¨å‘½ä»¤  --dry-run (alias: -d) : Run through without making any changes. --style less : The file extension to be used for style files.    NG-ZORRO ng add ng-zorro-antd\n","description":"","id":15,"section":"code","tags":null,"title":"01_é¡¹ç›®åˆ›å»º","uri":"https://xtddw.github.io/code/angular/angular_01_%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/"},{"content":"é¡¹ç›®åˆ›å»º  ASP .NET Core Web Application è®¾ç½®ä¸ºBlog.Api é€‰æ‹©Empty+No Authentication æ·»åŠ .NET Coreç±»åº“ï¼ŒBlog.Core + Blog.Infrastructure  Infrastructure ä¾èµ– Core Api ä¾èµ– Infrastructure + Core    Program + Startup Programè¿›è¡ŒåŸºç¡€è®¾æ–½çš„é…ç½®ï¼Œå¾ˆå°‘å‘ç”Ÿå˜åŒ–\n HTTP Server é›†æˆ IIS é…ç½®ä¿¡æ¯æ¥æº  Startup é…ç½®è‡ªå®šä¹‰è¡Œä¸ºï¼Œå¯èƒ½ç»å¸¸å‘ç”Ÿå˜åŒ–\n ç»„ä»¶ æœåŠ¡ åŠŸèƒ½ ä¸­é—´ä»¶ç®¡é“  Startup.cs\n  ConfigureServices æ‰€æœ‰ç¨‹åºçº§çš„ä¾èµ–é¡¹éƒ½å¯ä»¥åœ¨è¿™é‡Œæ³¨å†Œåˆ°é»˜è®¤çš„IoCå®¹å™¨é‡Œ, æŠŠå®ƒä»¬æ·»åŠ åˆ°IServiceCollectionå³å¯\n  Configure é…ç½®åº”è¯¥éµå¾ªAdd/Useçš„é£æ ¼æ ·å¼, é¦–å…ˆå®šä¹‰éœ€è¦ä»€ä¹ˆ, ç„¶åå®šä¹‰å¦‚ä½•ä½¿ç”¨å®ƒ.æ˜¯çœŸæ­£è´Ÿè´£é…ç½®HTTPè¯·æ±‚ç®¡é“çš„æ–¹æ³•, å¹¶ä¸”è¿è¡Œæ—¶ä¹Ÿéœ€è¦å®ƒ\n  åŸºç¡€é…ç½® è¿è¡Œæ—¶ç¯å¢ƒ ASPNETCORE_ENVIRONMENT\n ASP.NET Coreè¿˜å…è®¸æˆ‘ä»¬æŒ‰çº¦å®šä¸ºæŒ‡å®šç¯å¢ƒå»ºç«‹å•ç‹¬çš„å¯åŠ¨é…ç½®. å¯åŠ¨ç±»å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°å®šä¹‰UseStartup(startupAssemblyName: xxx); è¿è¡Œæ—¶ä¼šåœ¨è¿™ä¸ªæŒ‡å®šçš„ç»„ä»¶æŸ¥æ‰¾å«åšStartup, Startup[ç¯å¢ƒå]çš„ç±», å…¶ä¸­[ç¯å¢ƒå]å°±æ˜¯ASPNETCORE_ENVIRONMENTè¿™ä¸ªç¯å¢ƒå˜é‡çš„å€¼. å¦‚æœèƒ½æ‰¾åˆ°æŒ‡å®šç¯å¢ƒçš„ç±», é‚£ä¹ˆå®ƒå°†è¦†ç›–é»˜è®¤çš„å¯åŠ¨ç±».\n  ä¾‹å¦‚:ç¯å¢ƒå˜é‡å€¼å¦‚æœæ˜¯Developmentçš„è¯, é‚£ä¹ˆè¿è¡Œæ—¶å°±ä¼šå°è¯•å¯»æ‰¾Startupå’ŒStartupDevelopmentç±», è¯¥çº¦å®šåœ¨å¯åŠ¨ç±»é‡Œé¢çš„æ–¹æ³•åä¸Šä¹Ÿæœ‰æ•ˆ, ç¯å¢ƒç‰¹å®šçš„å¯åŠ¨ç±»é‡Œçš„ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯ Configure[ç¯å¢ƒå]å’ŒConfigure[ç¯å¢ƒå]Services.\n  ASPNETCORE_ENVIRONMENTç¯å¢ƒå˜é‡ Production Development Staging æ²¡æœ‰è®¾ç½®åˆ™ä½¿ç”¨Production\n 1 2 3 4 5  public static IWebHostBuilder CreateWebHostBuilder(string[] args) =\u0026gt; WebHost.CreateDefaultBuilder(args) //.UseStartup\u0026lt;Startup\u0026gt;();  .UseStartup(typeof(StartupDevelopment).GetTypeInfo().Assembly.FullName);   HTTPS\n å¾®è½¯å»ºè®®æ‰€æœ‰åº”ç”¨è°ƒç”¨HTTPSé‡å®šå‘ä¸­é—´ä»¶ï¼Œæ¥æŠŠæ‰€æœ‰çš„HTTPè¯·æ±‚é‡å®šå‘ä¸ºHTTPS Startupï¼š  ConfigureServicesæ–¹æ³•æ³¨å†Œï¼Œå¹¶é…ç½®ç«¯å£åŠçŠ¶æ€ç  Configureæ–¹æ³•ä½¿ç”¨è¯¥ä¸­é—´ä»¶ï¼š app.UseHttpsRedirection()    1 2 3 4 5  services.AddHttpsRedirection(options =\u0026gt; { options.RedirectStatusCode = StatusCodes.Status307TemporaryRedirect; options.HttpsPort = 5001; });   HSTS ï¼ˆHTTP Strict Transport Sercurity Protocolï¼‰\n å¾®è½¯å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒ(production)ä¸‹å¯ç”¨HSTS Startupï¼š\n* ConfigureServicesæ–¹æ³•æ³¨å†Œå¹¶é…ç½® HSTSÂ * Configureæ–¹æ³•ä½¿ç”¨è¯¥ä¸­é—´ä»¶ï¼š app.UseHsts()  1 2 3 4 5 6 7 8 9  //HSTS åªé…ç½®åœ¨ç”Ÿäº§ç¯å¢ƒ services.AddHsts(options =\u0026gt; { options.Preload = true; options.IncludeSubDomains = true; options.MaxAge = TimeSpan.FromDays(60); options.ExcludedHosts.Add(\u0026#34;example.com\u0026#34;); options.ExcludedHosts.Add(\u0026#34;www.example.com\u0026#34;); });   launchSettings.json\n å¼€å‘æ—¶åªä¿ç•™console,å…¶ä½™åˆ é™¤  1 2 3 4 5 6 7 8 9 10 11 12 13  { \u0026#34;profiles\u0026#34;: { \u0026#34;Blog.Api\u0026#34;: { \u0026#34;commandName\u0026#34;: \u0026#34;Project\u0026#34;, \u0026#34;launchBrowser\u0026#34;: true, \u0026#34;launchUrl\u0026#34;: \u0026#34;http://localhost:5000/api/posts\u0026#34;, \u0026#34;applicationUrl\u0026#34;: \u0026#34;https://localhost:5001;http://localhost:5000\u0026#34;, \u0026#34;environmentVariables\u0026#34;: { \u0026#34;ASPNETCORE_ENVIRONMENT\u0026#34;: \u0026#34;Development\u0026#34; } } } }   ","description":"","id":16,"section":"code","tags":null,"title":"01_é¡¹ç›®åˆ›å»ºåŠåŸºç¡€é…ç½®","uri":"https://xtddw.github.io/code/dotnetcore/01%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA%E5%8F%8A%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/"},{"content":"å»ºç«‹å’Œæ³¨å†ŒContext  å®‰è£…åŒ… \u0026raquo;\u0026gt; Infrastructureé¡¹ç›®   Microsoft.EntityFrameworkCore.Design Microsoft.EntityFrameworkCore.[Sqlite][SqlServer][MySql]\ndotnet add package Microsoft.EntityFrameworkCore.SqlServer\nInstall-Package Microsoft.EntityFrameworkCore.SqlServer  å»ºç«‹Context   Entities \u0026raquo;\u0026gt; Coreé¡¹ç›®  1 2 3 4 5 6 7 8  public class Post : Entity { // public int Id { get; set; }  public string Title { get; set; } public string Body { get; set; } public string Author { get; set; } public DateTime LastModified { get; set; } }    Context:DbContext \u0026raquo;\u0026gt;Infrastructureé¡¹ç›®  1 2 3 4 5 6 7  public class ApplicationContext:DbContext { public ApplicationContext(DbContextOptions\u0026lt;ApplicationContext\u0026gt; options):base(options) { } public DbSet\u0026lt;Post\u0026gt; Posts { get; set; } }   Startupé‡Œæ³¨å†ŒContext  1 2 3 4 5 6 7  //æ³¨å†ŒDbcontxt  services.AddDbContext\u0026lt;ApplicationContext\u0026gt;(options =\u0026gt; { //var contectionString = \u0026#34;Data Source = localhost; Database = Blog.db; User = sa; Password = password\u0026#34;;  var contectionString = \u0026#34;Data Source = .;Database = Blog.db;Integrated Security=True\u0026#34;; options.UseSqlServer(contectionString); });   æ•°æ®åº“è¿ç§»   å¿«é€Ÿè°ƒå‡ºpackage manager console Alt + T N O add-migration [Name] update-database\n  æ·»åŠ ç§å­æ•°æ®   Seed.cs  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80  public class Seed { public static async Task SeedAsync(ApplicationContext applicationContext, ILoggerFactory loggerFactory, int retry = 0) { int retryForAvailability = retry; try { // TODO: Only run this if using a real database  // myContext.Database.Migrate();  if (!applicationContext.Posts.Any()) { applicationContext.Posts.AddRange( new List\u0026lt;Post\u0026gt;{ new Post{ Title = \u0026#34;Post Title 1\u0026#34;, Body = \u0026#34;Post Body 1\u0026#34;, Author = \u0026#34;Dave\u0026#34;, LastModified = DateTime.Now }, new Post{ Title = \u0026#34;Post Title 2\u0026#34;, Body = \u0026#34;Post Body 2\u0026#34;, Author = \u0026#34;Dave\u0026#34;, LastModified = DateTime.Now }, new Post{ Title = \u0026#34;Post Title 3\u0026#34;, Body = \u0026#34;Post Body 3\u0026#34;, Author = \u0026#34;Dave\u0026#34;, LastModified = DateTime.Now }, new Post{ Title = \u0026#34;Post Title 4\u0026#34;, Body = \u0026#34;Post Body 4\u0026#34;, Author = \u0026#34;Dave\u0026#34;, LastModified = DateTime.Now }, new Post{ Title = \u0026#34;Post Title 5\u0026#34;, Body = \u0026#34;Post Body 5\u0026#34;, Author = \u0026#34;Dave\u0026#34;, LastModified = DateTime.Now }, new Post{ Title = \u0026#34;Post Title 6\u0026#34;, Body = \u0026#34;Post Body 6\u0026#34;, Author = \u0026#34;Dave\u0026#34;, LastModified = DateTime.Now }, new Post{ Title = \u0026#34;Post Title 7\u0026#34;, Body = \u0026#34;Post Body 7\u0026#34;, Author = \u0026#34;Dave\u0026#34;, LastModified = DateTime.Now }, new Post{ Title = \u0026#34;Post Title 8\u0026#34;, Body = \u0026#34;Post Body 8\u0026#34;, Author = \u0026#34;Dave\u0026#34;, LastModified = DateTime.Now } } ); await applicationContext.SaveChangesAsync(); } } catch (Exception ex) { if (retryForAvailability \u0026lt; 10) { retryForAvailability++; var logger = loggerFactory.CreateLogger\u0026lt;Seed\u0026gt;(); logger.LogError(ex.Message); await SeedAsync(applicationContext, loggerFactory, retryForAvailability); } } } }    Programä¸­è°ƒç”¨  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  public static void Main(string[] args) { var host = CreateWebHostBuilder(args).Build(); using (var scope = host.Services.CreateScope()) { var services = scope.ServiceProvider; var loggerFactory = services.GetRequiredService\u0026lt;ILoggerFactory\u0026gt;(); try { var applicationContext = services.GetRequiredService\u0026lt;ApplicationContext\u0026gt;(); //è°ƒç”¨æ–¹æ³•åˆ›å»ºç§å­æ•°æ®  Seed.SeedAsync(applicationContext, loggerFactory).Wait(); } catch (Exception e) { var logger = loggerFactory.CreateLogger\u0026lt;Program\u0026gt;(); logger.LogError(e, \u0026#34;Error occured seeding the Database.\u0026#34;); } } host.Run(); }    æ·»åŠ PostController  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  [Route(\u0026#34;api/posts\u0026#34;)] public class PostController : Controller { private readonly ApplicationContext _applicationContext; public PostController(ApplicationContext applicationContext) { _applicationContext = applicationContext; } [HttpGet] public async Task\u0026lt;IActionResult\u0026gt; Get() { var posts = await _applicationContext.Posts.ToListAsync(); return Ok(posts); } }    æˆåŠŸ\n  Repository ä»“å‚¨æœåŠ¡ ä¸æŒä¹…åŒ–æŠ€æœ¯æ— å…³(ä½¿ç”¨å…¶ä»–Drapperç­‰æ›¿ä»£EF Core)ã€æ˜“äºæµ‹è¯•ã€ä»£ç é‡ç”¨\nIRepositoryæ¥å£ï¼šä¾èµ–æ³¨å…¥ã€æ¾è€¦åˆã€DIPåŸåˆ™ã€æ˜“äºæµ‹è¯•\n æ³¨å…¥çš„æ˜¯æ¥å£ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ç±»ã€‚å¦‚æœæ³¨å…¥Repositoryè¿™ä¸ªç±»ï¼ŒControllerå°±ä¾èµ–äº†Repositoryï¼Œè¿™æ ·å°±æ˜¯é«˜çº§åˆ«æ¨¡å—ä¾èµ–äº†ä½çº§åˆ«æ¨¡å—ï¼Œè¿åäº†DIPåŸåˆ™! åº”è¯¥éƒ½ä¾èµ–äºæŠ½è±¡IRepositoryæ¥å£ã€‚   IRepository \u0026raquo;\u0026gt; Core.Interface  1 2 3 4  public interface IPostRepository { Task\u0026lt;IEnumerable\u0026lt;Post\u0026gt;\u0026gt; GetAllPostsAsync(); }   Repository \u0026raquo;\u0026gt; Infrastructure.Repositories  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  public class PostRepository : IPostRepository { //æ³¨å…¥DbContext  private readonly ApplicationContext _applicationContext; public PostRepository(ApplicationContext applicationContext) { _applicationContext = applicationContext; } public async Task\u0026lt;IEnumerable\u0026lt;Post\u0026gt;\u0026gt; GetAllPostsAsync() { return await _applicationContext.Posts.ToListAsync(); } }   Startupä¸­æ³¨å†ŒæœåŠ¡  1 2  //æ³¨å†Œä»“å‚¨æœåŠ¡  services.AddScoped\u0026lt;IPostRepository, PostRepository\u0026gt;();    æœåŠ¡æ³¨å†Œç”Ÿå‘½å‘¨æœŸ  Transient:Â æ¯æ¬¡å…¶å®ƒçš„ç±»è¯·æ±‚ï¼ˆä¸æ˜¯æŒ‡HTTP Requestï¼‰éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå®ƒæ¯”è¾ƒé€‚åˆè½»é‡çº§çš„æ— çŠ¶æ€çš„ï¼ˆStatelessï¼‰çš„service. Scope: æ¯æ¬¡HTTPè¯·æ±‚ä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚ Singleton:Â åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™å°±ä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œä»¥åä¹Ÿåªæœ‰è¿™ä¸€ä¸ªå®ä¾‹; æˆ–è€…åœ¨ConfigureServicesè¿™æ®µä»£ç è¿è¡Œçš„æ—¶å€™åˆ›å»ºå”¯ä¸€ä¸€ä¸ªå®ä¾‹ã€‚    ä¿®æ”¹Controller,æ³¨å…¥Repository  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  [Route(\u0026#34;api/posts\u0026#34;)] public class PostController : Controller { private readonly IPostRepository _postRepository; public PostController(IPostRepository postRepository) { _postRepository = postRepository; } [HttpGet] public async Task\u0026lt;IActionResult\u0026gt; Get() { var posts = await _postRepository.GetAllPostsAsync(); return Ok(posts); } }   Unit of Work ä»“å‚¨æœåŠ¡  IUntiOfWork \u0026raquo;\u0026gt; Core.Interface  1 2 3 4  public interface IUnitOfWork { Task\u0026lt;bool\u0026gt; SaveAsync(); }   UnitOfWork \u0026raquo;\u0026gt; Infrastructure.Database  1 2 3 4 5 6 7 8 9 10 11 12 13 14  public class UnitOfWork : IUnitOfWork { private readonly ApplicationContext _applicationContext; public UnitOfWork(ApplicationContext applicationContext) { _applicationContext = applicationContext; } public async Task\u0026lt;bool\u0026gt; SaveAsync() { return await _applicationContext.SaveChangesAsync() \u0026gt; 0; } }   Startupä¸­æ³¨å†ŒæœåŠ¡  1 2  //æ³¨å†Œä»“å‚¨æœåŠ¡  services.AddScoped\u0026lt;IUnitOfWork , UnitOfWork \u0026gt;();   Repositoryæ·»åŠ AddPostæ–¹æ³•  1 2 3 4  public void AddPost(Post post) { _applicationContext.Posts.Add(post); }   ä¿®æ”¹controller, æ³¨å…¥IUnitOfWork, Post()æ–¹æ³•ä¸­è°ƒç”¨  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  [Route(\u0026#34;api/posts\u0026#34;)] public class PostController : Controller { private readonly IPostRepository _postRepository; private readonly IUnitOfWork _unitOfWork; public PostController( IPostRepository postRepository, IUnitOfWork unitOfWork) { _postRepository = postRepository; _unitOfWork = unitOfWork; } [HttpGet] public async Task\u0026lt;IActionResult\u0026gt; Get() { var posts = await _postRepository.GetAllPostsAsync(); return Ok(posts); } [HttpPost] public async Task\u0026lt;IActionResult\u0026gt; Post() { var newPost = new Post { Title = \u0026#34;ENFI\u0026#34;, Author = \u0026#34;ZGX\u0026#34;, Body = \u0026#34;adskfasdjfladsjfa;ldsfads\u0026#34;, LastModified = DateTime.Now }; _postRepository.AddPost(newPost); await _unitOfWork.SaveAsync(); return Ok(); } }   Entityçº¦æŸ  PostConfiguration.cs \u0026raquo;\u0026gt; Infrastructure.EntityConfiguration  1 2 3 4 5 6 7 8 9  public class PostConfiguration : IEntityTypeConfiguration\u0026lt;Post\u0026gt; { public void Configure(EntityTypeBuilder\u0026lt;Post\u0026gt; builder) { builder.Property(x =\u0026gt; x.Author).IsRequired().HasMaxLength(50); builder.Property(x =\u0026gt; x.Title).IsRequired().HasMaxLength(100); builder.Property(x =\u0026gt; x.Body).IsRequired().HasColumnType(\u0026#34;nvarchar(max)\u0026#34;); } }   DbContextä¸­é‡å†™OnModel  1 2 3 4 5  protected override void OnModelCreating(ModelBuilder modelBuilder) { base.OnModelCreating(modelBuilder); modelBuilder.ApplyConfiguration(new PostConfiguration()); }   ","description":"","id":17,"section":"code","tags":null,"title":"02_é›†æˆEFCore","uri":"https://xtddw.github.io/code/dotnetcore/02%E9%9B%86%E6%88%90efcore/"},{"content":"Log  é»˜è®¤è‡ªå¸¦log \u0026raquo;\u0026gt;Program  1  WebHost.CreateDefaultBuilder()ä¸­åšäº†é»˜è®¤é…ç½®   2. Log API\nASP .NET Core æä¾›äº†ä¸€å¥—Log API, å®ƒå¯ä»¥å„ç§å„æ ·çš„Logæä¾›å•†é…åˆä½¿ç”¨. http://www.cnblogs.com/cgzl/p/9019314.html\nå†…ç½®6ä¸ªLogæä¾›å•†:\n Console Debug EventSource EventLog TraceSource Azure App Service\nç¬¬ä¸‰æ–¹æä¾›å•†ï¼š Nlog Serilog  ILoggeræ¥å£  åˆ›å»ºILoggerçš„æ—¶å€™æŒ‡æ˜åˆ†ç±»ï¼Œåˆ†ç±»åçº¦å®šæ˜¯è°ƒç”¨ç±»çš„å…¨å(string) PostControllerä¾‹å¦‚ï¼š\nä¾èµ–æ³¨å…¥ILogger\u0026lt;TCategoryName\u0026gt;\n åœ¨ILoggerFactory ä¸Šè°ƒç”¨CreateLoggeræ–¹æ³•æ—¶å¯ä»¥æŒ‡å®šåˆ†ç±»çš„åç§°.  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  [Route(\u0026#34;api/posts\u0026#34;)] public class PostController : Controller { private readonly IPostRepository _postRepository; private readonly IUnitOfWork _unitOfWork; private readonly ILogger _logger; public PostController( IPostRepository postRepository, IUnitOfWork unitOfWork, ILoggerFactory loggerFactory) { _postRepository = postRepository; _unitOfWork = unitOfWork; _logger = loggerFactory.CreateLogger(\u0026#34;Blog.Api.Controllers.PostController\u0026#34;); } [HttpGet] public async Task\u0026lt;IActionResult\u0026gt; Get() { var posts = await _postRepository.GetAllPostsAsync(); _logger.LogError(\u0026#34;Get All Posts ......\u0026#34;); return Ok(posts); }   ILoggerå…¶ä»–  çº§åˆ«  LogTrace(), 0ï¼Œè®°å½•è¿½è¸ªä¿¡æ¯ LogDebug(), 1ï¼Œè®°å½•è°ƒè¯•ä¿¡æ¯ LogInformation(), 2ï¼Œè®°å½•ä¿¡æ¯æ€§çš„äº‹æƒ… LogWarning(), 3ï¼Œè®°å½•è­¦å‘Šä¿¡æ¯ LogError(), 4ï¼Œè®°å½•å¼‚å¸¸ LogCritical(), 5ï¼Œç”¨æ¥è®°å½•ä¸¥é‡çš„äº‹æƒ…   Event ID ä¿¡æ¯æ¨¡æ¿ å¼‚å¸¸ è¿‡æ»¤ ä½œç”¨èŒƒå›´\nâ€¦â€¦  æ·»åŠ Serilog  å®‰è£…åŒ…\nInstall-Package Serilog\nInstall-Package Serilog.AspNetCore\nSinksæ—¥å¿—è¾“å‡ºåª’ä»‹(æ§åˆ¶å°ã€æ–‡ä»¶ã€sqlserverç­‰ï¼‰\nInstall-Package Serilog.Sinks.Console\nInstall-Package Serilog.Sinks.File\nâ€¦ Main()ä¸­é…ç½®  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  public static void Main(string[] args) { //é…ç½®Serilog  Log.Logger = new LoggerConfiguration() //æœ€ä½è¾“å‡ºçº§åˆ«ä¸ºDebug  .MinimumLevel.Debug() //ä»¥Microsoftå¼€å¤´çš„ç‰¹æ®Š,è°ƒæ•´æœ€å°çº§åˆ«ä¸ºInformation  .MinimumLevel.Override(\u0026#34;Microsoft\u0026#34;, LogEventLevel.Information) .Enrich.FromLogContext() .WriteTo.Console() .WriteTo.File(Path.Combine(\u0026#34;logs\u0026#34;, @\u0026#34;log.txt\u0026#34;), rollingInterval: RollingInterval.Day) .CreateLogger(); var host = CreateWebHostBuilder(args).Build(); //ç§å­æ–‡ä»¶  using (var scope = host.Services.CreateScope()) { var services = scope.ServiceProvider; var loggerFactory = services.GetRequiredService\u0026lt;ILoggerFactory\u0026gt;(); try { var applicationContext = services.GetRequiredService\u0026lt;ApplicationContext\u0026gt;(); //è°ƒç”¨æ–¹æ³•åˆ›å»ºç§å­æ•°æ®  Seed.SeedAsync(applicationContext, loggerFactory).Wait(); } catch (Exception e) { var logger = loggerFactory.CreateLogger\u0026lt;Program\u0026gt;(); logger.LogError(e, \u0026#34;Error occured seeding the Database.\u0026#34;); } } host.Run(); } public static IWebHostBuilder CreateWebHostBuilder(string[] args) =\u0026gt; WebHost.CreateDefaultBuilder(args) //.UseStartup\u0026lt;Startup\u0026gt;();  .UseStartup(typeof(StartupDevelopment).GetTypeInfo().Assembly.FullName) .UseSerilog(); //è°ƒç”¨Serilog,è¦†ç›–æ‰CreateDefaultBuilderä¸­çš„é»˜è®¤é…ç½®  }   ","description":"","id":18,"section":"code","tags":null,"title":"03_æ—¥å¿—","uri":"https://xtddw.github.io/code/dotnetcore/03%E6%97%A5%E5%BF%97logger/"},{"content":" é…ç½®æä¾›å•†  æ–‡ä»¶æ ¼å¼(INI, JSON, XML) å‘½ä»¤è¡Œå‚æ•° ç¯å¢ƒå˜é‡ å†…å­˜ä¸­çš„.NETå¯¹è±¡ æœªåŠ å¯†çš„Secretç®¡ç†å­˜å‚¨ åŠ å¯†çš„ç”¨æˆ·å­˜å‚¨, ä¾‹å¦‚Azureç§˜é’¥åº“ è‡ªå®šä¹‰çš„æä¾›å•†   JSONé…ç½®æ–‡ä»¶  é»˜è®¤ appsettings.json æ³¨æ„ï¼šååŠ è½½çš„å€¼ä¼šè¦†ç›–ã€‚\n å–å¾—é…ç½®  IConfiguration[â€œKey:ChildKeyâ€] é’ˆå¯¹â€ConnectionStrings:xxxâ€, å¯ä»¥ä½¿ç”¨IConfiguration. GetConnectionString(â€œxxxâ€)      1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  public static IConfiguration Configuration; public StartupDevelopment(IConfiguration configuration) { Configuration = configuration; } public void ConfigureServices(IServiceCollection services) { services.AddMvc(); //æ³¨å†ŒDbcontxt  services.AddDbContext\u0026lt;ApplicationContext\u0026gt;(options =\u0026gt; { //var connectionString = \u0026#34;Data Source = 10.30.0.14; Database = Blog.db; User = sa; Password = Hello,MMOC\u0026#34;;  //var connectionString = \u0026#34;Data Source = .;Database = Blog.db;Integrated Security=True\u0026#34;;  //var connectionString = Configuration[\u0026#34;ConnectionStrings:DefaultConnection\u0026#34;];  var connectionString = Configuration.GetConnectionString(\u0026#34;DefaultConnection\u0026#34;); options.UseSqlServer(connectionString); }); ... }    å…¶ä»–æ–‡ä»¶é…ç½®\nConfigurationBuilder().AddJsonFile(\u0026ldquo;appsettings.json\u0026rdquo;).Build() è¿”å›IConfigurationRootï¼Œç»§æ‰¿äºIConfiguration. ä½¿ç”¨æ¥å£IConfigurationå³å¯ã€‚  ","description":"","id":19,"section":"code","tags":null,"title":"04_é¡¹ç›®é…ç½®","uri":"https://xtddw.github.io/code/dotnetcore/04%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/"},{"content":"é»˜è®¤å¼‚å¸¸å¤„ç† 1  app.UseDeveloperExceptionPage();   è‡ªå®šä¹‰å¼‚å¸¸å¤„ç† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  public static class ExceptionHandlingExtensions { public static void UseMyExceptionHandler(this IApplicationBuilder app,ILoggerFactory loggerFactory) { app.UseExceptionHandler(build =\u0026gt; { build.Run(async context =\u0026gt; { context.Response.StatusCode = StatusCodes.Status500InternalServerError; context.Response.ContentType = \u0026#34;application/json\u0026#34;; var ex = context.Features.Get\u0026lt;IExceptionHandlerFeature\u0026gt;(); if (ex != null) { var logger = loggerFactory.CreateLogger(\u0026#34;Blog.Api.Extensions.ExceptionHandlingExtensions\u0026#34;); logger.LogError(500, ex.Error, ex.Error.Message); } await context.Response.WriteAsync(ex?.Error?.Message ?? \u0026#34;An Error Occurred.\u0026#34;); }); }); } }   1 2 3 4 5 6  public void Configure(IApplicationBuilder app,ILoggerFactory loggerFactory) { app.UseMyExceptionHandler(loggerFactory); app.UseHttpsRedirection(); app.UseMvc(); }   ","description":"","id":20,"section":"code","tags":null,"title":"05_å¼‚å¸¸å¤„ç†","uri":"https://xtddw.github.io/code/dotnetcore/05%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"},{"content":"API ä¸åº”ç›´æ¥è¿”å›Entity  * Entity/Domain Modelæ˜¯å†…éƒ¨å®ç°ç»†èŠ‚ * åˆçº¦/æ¥å£ç•Œé¢  APIåº”è¿”å›å¦å¤–ä¸€ä¸ªç±»ï¼ˆèµ„æº Resourceï¼‰  ä¸Entityå¯èƒ½å¾ˆåƒ. ç‹¬ç«‹äºEntity, å•ç‹¬è¿›åŒ–å’Œæ”¹å˜. ä¹Ÿå¯ä»¥å«åšViewModel, Dto  Entityä¸Resoucreä¹‹é—´æ˜ å°„[AutoMapper]  å®‰è£…NugetåŒ…:\nAutoMapper\nAutoMapper.Extensions.Microsoft.DependencyInjection \u0026raquo;\u0026gt; API é…ç½®æ˜ å°„\nå¯ä»¥åˆ›å»ºProfile\nCreateMap\u0026lt;TSource, TDestination\u0026gt;()  1 2 3 4 5 6 7 8 9  public class MappingProfile:Profile { public MappingProfile() { CreateMap\u0026lt;Post, PostResource\u0026gt;() .ForMember(dest =\u0026gt; dest.UpdateTime, opt =\u0026gt; opt.MapFrom(src =\u0026gt; src.LastModified)); CreateMap\u0026lt;PostResource,Post\u0026gt;(); } }    services.AddAutoMapper() ä¾èµ–æ³¨å…¥AutoMapper  1 2 3 4 5 6 7  [HttpGet] public async Task\u0026lt;IActionResult\u0026gt; Get() { var posts = await _postRepository.GetAllPostsAsync(); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;,IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(posts); return Ok(postResources); }   ","description":"","id":21,"section":"code","tags":null,"title":"06_ResourceModel","uri":"https://xtddw.github.io/code/dotnetcore/06resourcemodel/"},{"content":"å±æ€§æ ‡ç­¾ https://docs.microsoft.com/zh-cn/aspnet/core/mvc/models/validation?view=aspnetcore-2.1\n [CreditCard]ï¼šéªŒè¯å±æ€§æ˜¯å¦å…·æœ‰ä¿¡ç”¨å¡æ ¼å¼ã€‚ [Compare]ï¼šéªŒè¯æŸä¸ªæ¨¡å‹ä¸­çš„ä¸¤ä¸ªå±æ€§æ˜¯å¦åŒ¹é…ã€‚ [EmailAddress]ï¼šéªŒè¯å±æ€§æ˜¯å¦å…·æœ‰ç”µå­é‚®ä»¶æ ¼å¼ã€‚ [Phone]ï¼šéªŒè¯å±æ€§æ˜¯å¦å…·æœ‰ç”µè¯æ ¼å¼ã€‚ [Range]ï¼šéªŒè¯å±æ€§å€¼æ˜¯å¦è½åœ¨ç»™å®šèŒƒå›´å†…ã€‚ [RegularExpression]ï¼šéªŒè¯æ•°æ®æ˜¯å¦ä¸æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ [Required]ï¼šå°†å±æ€§è®¾ç½®ä¸ºå¿…éœ€å±æ€§ã€‚ [StringLength]ï¼šéªŒè¯å­—ç¬¦ä¸²å±æ€§æ˜¯å¦æœ€å¤šå…·æœ‰ç»™å®šçš„æœ€å¤§é•¿åº¦ã€‚ [Url]ï¼šéªŒè¯å±æ€§æ˜¯å¦å…·æœ‰ URL æ ¼å¼ã€‚  FluentValidation  éªŒè¯é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦» çµæ´», åŠŸèƒ½å¼ºå¤§\nFluent API, Lambdaè¡¨è¾¾å¼ å®‰è£…NugetåŒ…:\nFluentValidation\nFluentValidation.AspNetCore ä¸ºResourceé…ç½®éªŒè¯å™¨\nç»§æ‰¿äºAbstractValidator  1 2 3 4 5 6 7 8 9 10 11 12  public class PostResourceValidator:AbstractValidator\u0026lt;PostResource\u0026gt; { public PostResourceValidator() { RuleFor(x =\u0026gt; x.Author) .NotNull() .WithName(\u0026#34;ä½œè€…\u0026#34;) .WithMessage(\u0026#34;{PropertyName}æ˜¯å¿…å¡«çš„\u0026#34;) .MaximumLength(20) .WithMessage(\u0026#34;{PropertyName}çš„æœ€å¤§é•¿åº¦æ˜¯{MaxLength}\u0026#34;); } }   æ³¨å†Œåˆ°å®¹å™¨: services.AddTransient\u0026lt;\u0026gt;()  1 2  //æ³¨å†ŒFluentValidator  services.AddTransient\u0026lt;IValidator\u0026lt;PostResource\u0026gt;, PostResourceValidator\u0026gt;();   ","description":"","id":22,"section":"code","tags":null,"title":"07_æ¨¡å‹éªŒè¯","uri":"https://xtddw.github.io/code/dotnetcore/07%E6%A8%A1%E5%9E%8B%E9%AA%8C%E8%AF%81/"},{"content":"ä»€ä¹ˆæ˜¯REST REST æ˜¯ Representational State Transfer çš„ç¼©å†™. å®ƒæ˜¯ä¸€ç§æ¶æ„çš„é£æ ¼, è¿™ç§é£æ ¼åŸºäºä¸€å¥—é¢„å®šä¹‰çš„è§„åˆ™, è¿™äº›è§„åˆ™æè¿°äº†ç½‘ç»œèµ„æºæ˜¯å¦‚ä½•å®šä¹‰å’Œå¯»å€çš„.\nä¸€ä¸ªå®ç°äº†RESTè¿™äº›è§„åˆ™çš„æœåŠ¡å°±å«åšRESTfulçš„æœåŠ¡.\nRESTçš„åŸåˆ™/çº¦æŸ RESTæœ‰6å¤§åŸåˆ™/çº¦æŸ, æ¯ä¸€ä¸ªåŸåˆ™éƒ½æ˜¯å¯¹APIæœ‰æ­£é¢æˆ–è´Ÿé¢å½±å“çš„è®¾è®¡å†³å®š.\nRESTful API æœ€å…³å¿ƒçš„æœ‰è¿™å‡ æ–¹é¢: æ€§èƒ½, å¯æ‰©å±•æ€§, ç®€æ´æ€§, äº’æ“ä½œæ€§, é€šè®¯å¯è§æ€§, ç»„ä»¶ä¾¿æºæ€§å’Œå¯é æ€§.\nè¿™äº›æ–¹é¢è¢«å°è£…åœ¨RESTçš„6ä¸ªåŸåˆ™é‡Œ, å®ƒä»¬æ˜¯:\n å®¢æœç«¯-æœåŠ¡ç«¯çº¦æŸ: å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯åˆ†ç¦»çš„, å®ƒä»¬å¯ä»¥ç‹¬è‡ªçš„è¿›åŒ–. æ— çŠ¶æ€: å®¢æˆ·ç«¯å’ŒæœåŠ¡æ®µçš„é€šä¿¡å¿…é¡»æ˜¯æ— çŠ¶æ€çš„, çŠ¶æ€åº”åŒ…å«åœ¨è¯·æ±‚é‡Œçš„. ä¹Ÿå°±æ˜¯è¯´è¯·æ±‚é‡Œè¦åŒ…å«æœåŠ¡ç«¯éœ€è¦çš„æ‰€æœ‰çš„ä¿¡æ¯, ä»¥ä¾¿æœåŠ¡ç«¯å¯ä»¥ç†è§£è¯·æ±‚å¹¶å¯ä»¥åˆ›é€ ä¸Šä¸‹æ–‡. åˆ†å±‚ç³»ç»Ÿ: å°±åƒå…¶å®ƒçš„è½¯ä»¶æ¶æ„ä¸€æ ·, RESTä¹Ÿéœ€è¦åˆ†å±‚ç»“æ„, ä½†æ˜¯ä¸å…è®¸æŸå±‚ç›´æ¥è®¿é—®ä¸ç›¸é‚»çš„å±‚. ç»Ÿä¸€æ¥å£: è¿™é‡Œåˆ†ä¸º4ç‚¹, ä»–ä»¬æ˜¯: èµ„æºæ ‡è¯†ç¬¦(URI), èµ„æºçš„æ“ä½œ(ä¹Ÿå°±æ˜¯æ–¹æ³•Method, HTTPåŠ¨è¯), è‡ªæè¿°çš„å“åº”(å¯ä»¥è®¤ä¸ºæ˜¯åª’ä½“ç±»å‹Media-Type), ä»¥åŠçŠ¶æ€ç®¡ç†(è¶…åª’ä½“ä½œä¸ºåº”ç”¨çŠ¶æ€çš„å¼•æ“ HATEOAS, Hypermedia as the Engine of Application State). ç¼“å­˜: ç¼“å­˜çº¦æŸæ´¾ç”Ÿäºæ— çŠ¶æ€çº¦æŸ, å®ƒè¦æ±‚ä»æœåŠ¡ç«¯è¿”å›çš„å“åº”å¿…é¡»æ˜ç¡®è¡¨æ˜æ˜¯å¯ç¼“å­˜çš„è¿˜æ˜¯ä¸å¯ç¼“å­˜çš„. æŒ‰éœ€ç¼–ç : è¿™å…è®¸å®¢æˆ·ç«¯å¯ä»¥ä»æœåŠ¡ç«¯è®¿é—®ç‰¹å®šçš„èµ„æºè€Œæ— é¡»çŸ¥æ™“å¦‚ä½•å¤„ç†å®ƒä»¬. æœåŠ¡ç«¯å¯ä»¥æ‰©å±•æˆ–è‡ªå®šä¹‰å®¢æˆ·ç«¯çš„åŠŸèƒ½.  åªæœ‰æ»¡è¶³äº†è¿™6ä¸ªåŸåˆ™çš„ç³»ç»Ÿæ‰å¯ä»¥çœŸæ­£ç§°å¾—ä¸Šæ˜¯RESTfulçš„, å…¶å®å¤§éƒ¨åˆ†ç³»ç»Ÿçš„RESTful APIå¹¶ä¸æ˜¯RESTfulçš„, ä½†è¿™æ ·å¹¶ä¸ä»£è¡¨è¿™äº›APIå°±ä¸å¥½, åˆ©å¼Šéœ€è¦å¼€å‘äººå‘˜å»è¡¡é‡.\nRichardson æˆç†Ÿåº¦æ¨¡å‹ Richardson æˆç†Ÿåº¦æ¨¡å‹ä»£è¡¨ç€ä½ çš„APIæ˜¯å¦è¶³å¤Ÿæˆç†Ÿ, åˆ†ä¸º4ä¸ªçº§åˆ«, 0ä»£è¡¨æœ€å·®, 3ä»£è¡¨æœ€å¥½.\n  0çº§, Plain Old XMLæ²¼æ³½:\nè¿™é‡ŒHTTPåè®®åªæ˜¯è¢«ç”¨æ¥è¿›è¡Œè¿œç¨‹äº¤äº’, åè®®çš„å…¶ä½™éƒ¨åˆ†éƒ½ç”¨é”™äº†, éƒ½æ˜¯RPCé£æ ¼çš„å®ç°(ä¾‹å¦‚SOAP, å°¤å…¶æ˜¯ä½¿ç”¨WCFçš„æ—¶å€™).\nä¾‹å¦‚:\nPOST (æŸ¥è¯¢æ•°æ®ä¿¡æ¯)\nhttp://host/myapi\nPOST (åˆ›å»ºæ•°æ®)\nhttp://host/myapi\n  1çº§, èµ„æº:\nè¿™çº§é‡Œ, æ¯ä¸ªèµ„æºéƒ½æ˜ å°„åˆ°ä¸€ä¸ªURIä¸Šäº†, ä½†æ˜¯HTTPæ–¹æ³•å¹¶æ²¡æœ‰æ­£ç¡®çš„ä½¿ç”¨, ç»“æœçš„å¤æ‚åº¦ä¸ç®—å¤ªé«˜.\nä¾‹å¦‚è¿™ä¸¤ä¸ªæŸ¥è¯¢:\nPOST\nhttp://host/api/authors\nPOST\nhttp://host/api/authors/{id}\n  2çº§, åŠ¨è¯:\næ­£ç¡®ä½¿ç”¨äº†HTTPåŠ¨è¯, çŠ¶æ€ç ä¹Ÿæ­£ç¡®çš„ä½¿ç”¨äº†, åŒæ—¶ä¹Ÿå»æ‰äº†ä¸å¿…è¦çš„å˜ç§.\nä¾‹å¦‚:\nGET\nhttp://host/api/authors\nOk (authors)\nPOST (author representation)\nhttp://host/api/authors\nCreated (author)\n  3çº§, è¶…åª’ä½“:\nAPIæ”¯æŒè¶…åª’ä½“ä½œä¸ºåº”ç”¨çŠ¶æ€çš„å¼•æ“Â HATEOAS, Hypermedia as the Engine of Application State, å¼•å…¥äº†å¯å‘ç°æ€§.\nä¾‹å¦‚:\nGET\nhttp://host/api/authors\n200 Ok (è¿”å›äº†authors å’Œ é©±åŠ¨åº”ç”¨ç¨‹åºçš„è¶…é“¾æ¥)\n  API èµ„æºå‘½å  èµ„æºåº”è¯¥ä½¿ç”¨åè¯, å®ƒæ˜¯ä¸ªä¸œè¥¿, ä¸æ˜¯åŠ¨ä½œ\nGET api/usersÂ å°±æ˜¯æ­£ç¡®çš„\nGET api/users/{userId}. å±‚æ¬¡ç»“æ„\nä¾‹å¦‚Â api/department/{departmentId}/emoloyees, è¿™å°±è¡¨ç¤ºäº†department (éƒ¨é—¨)å’Œå‘˜å·¥(employee)ä¹‹å‰æ˜¯ä¸»ä»å…³ç³».\nè€ŒÂ api/department/{departmentId}/emoloyees/{employeeId}, å°±è¡¨ç¤ºäº†è¯¥éƒ¨é—¨ä¸‹çš„æŸä¸ªå‘˜å·¥. è¿‡æ»¤æ’åº\nè¿‡æ»¤å’Œæ’åº, ä¸æ˜¯èµ„æº, åº”ä½œä¸ºå‚æ•°.ä¾‹å¦‚Â api/users?orderby=username ID\nèµ„æºçš„URIåº”è¯¥æ°¸è¿œéƒ½æ˜¯ä¸€æ ·çš„.\næ¨èGUIDåº”è¯¥ä½œä¸ºIDæ¥ä½¿ç”¨.\nè‡ªå¢intç±»å‹çš„ID, åœ¨è¿ç§»åˆ°æ–°æ•°æ®åº“æ—¶éœ€è¦ç‰¹æ®Šè®¾å®š, ä¿è¯IDå€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–.  HTTPæ–¹æ³•ä¸èµ„æºäº¤äº’ æ³¨æ„:\n HEAD: å’ŒGETå·®ä¸å¤š, ä½†æ˜¯å®ƒä¸åº”è¯¥è¿”å›å“åº”çš„body, æ‰€ä»¥æ²¡æœ‰å“åº”çš„payload. å®ƒä¸»è¦ä½¿ç”¨æ¥è·å–èµ„æºçš„ä¸€äº›ä¿¡æ¯, ä¾‹å¦‚æŸ¥çœ‹èµ„æºæ˜¯å¦å¯ç”¨ç­‰. OPTIONS: å®ƒæ˜¯ç”¨æ¥æŸ¥è¯¢æŸä¸ªèµ„æºURIçš„å¯äº¤äº’æ–¹å¼æœ‰å“ªäº›, æ¢å¥è¯è¯´å°±æ˜¯, ä½¿ç”¨å®ƒå¯ä»¥çŸ¥é“æŸä¸ªURIæ˜¯å¦å¯ä»¥æ‰§è¡ŒGETæˆ–è€…POSTåŠ¨ä½œ, è¿™äº›ç»“æœé€šå¸¸æ˜¯åœ¨å“åº”çš„Headersé‡Œé¢è€Œä¸æ˜¯bodyé‡Œ, æ‰€ä»¥ä¹Ÿæ²¡æœ‰å“åº”çš„payload.  çŠ¶æ€ç   çŠ¶æ€ç ä¼šå‘Šè¯‰APIçš„æ¶ˆè´¹è€…:  è¯·æ±‚æ˜¯å¦å¦‚é¢„æœŸçš„æˆåŠŸï¼Œæˆ–è€…å¤±è´¥ å¦‚æœå‡ºç°äº†é”™è¯¯ï¼Œè°è¯¥ä¸ºè¿™ä¸ªé”™è¯¯è´Ÿè´£   APIä¸»è¦ç”¨åˆ°:  200çº§åˆ«, è¡¨ç¤ºæˆåŠŸ.\n* 200 - OK\n* 201 - Createdï¼Œè¡¨ç¤ºèµ„æºåˆ›å»ºæˆåŠŸäº†\n* 204 - No contentï¼ŒæˆåŠŸæ‰§è¡Œï¼Œä½†æ˜¯ä¸åº”è¯¥è¿”å›ä»»ä½•ä¸œè¥¿ 400çº§åˆ«, è¡¨ç¤ºå®¢æˆ·ç«¯å¼•èµ·çš„é”™è¯¯.\n* 400 - Bad requestï¼Œè¡¨ç¤ºAPIçš„æ¶ˆè´¹è€…å‘é€åˆ°æœåŠ¡å™¨çš„è¯·æ±‚æ˜¯é”™è¯¯çš„\n* 401 - Unauthorizedï¼Œè¡¨ç¤ºæ²¡æœ‰æƒé™\n* 403 - Forbiddenï¼Œè¡¨ç¤ºç”¨æˆ·éªŒè¯æˆåŠŸï¼Œä½†æ˜¯è¯¥ç”¨æˆ·ä»ç„¶æ— æ³•è®¿é—®è¯¥èµ„æº\n* 404 - Not foundï¼Œè¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸å­˜åœ¨\n* 405 - Method not allowedï¼Œè¿™å°±æ˜¯å½“æˆ‘ä»¬å°è¯•å‘é€è¯·æ±‚ç»™æŸä¸ªèµ„æºæ—¶ï¼Œä½¿ç”¨çš„HTTPæ–¹æ³•å´æ˜¯ä¸å…è®¸çš„ï¼Œä¾‹å¦‚ä½¿ç”¨POST api/countries, è€Œè¯¥èµ„æºåªå®ç°äº† GETï¼Œæ‰€ä»¥POSTä¸è¢«å…è®¸\n* 406 - Not acceptableï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†media typeï¼Œä¾‹å¦‚APIæ¶ˆè´¹è€…è¯·æ±‚çš„æ˜¯application/xmlæ ¼å¼çš„media typeï¼Œè€ŒAPIåªæ”¯æŒapplication/json\n* 409 - Conflictï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚æ— æ³•å®Œæˆï¼Œå› ä¸ºè¯·æ±‚ä¸å½“å‰èµ„æºçš„çŠ¶æ€æœ‰å†²çªï¼Œä¾‹å¦‚ä½ ç¼–è¾‘æŸä¸ªèµ„æºæ•°æ®ä»¥åï¼Œè¯¥èµ„æºåˆè¢«å…¶å®ƒäººæ›´æ–°äº†ï¼Œè¿™æ—¶ä½ å†PUTä½ çš„æ•°æ®å°±ä¼šå‡ºç°409é”™è¯¯ï¼›æœ‰æ—¶ä¹Ÿç”¨åœ¨å°è¯•åˆ›å»ºèµ„æºæ—¶è¯¥èµ„æºå·²å­˜åœ¨çš„æƒ…å†µã€‚\n* 415 - Unsupported media typeï¼Œè¿™ä¸ªå’Œ406æ­£å¥½è¿”å›æ¥ï¼Œæ¯”å¦‚è¯´æˆ‘å‘æœåŠ¡å™¨æäº¤æ•°æ®çš„media typeæ˜¯xmlçš„ï¼Œè€ŒæœåŠ¡å™¨åªæ”¯æŒjsonï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›415\n* 422 - Unprocessable entityï¼Œè¡¨ç¤ºè¯·æ±‚çš„æ ¼å¼æ²¡é—®é¢˜ï¼Œä½†æ˜¯è¯­ä¹‰æœ‰é”™è¯¯ï¼Œä¾‹å¦‚å®ä½“éªŒè¯é”™è¯¯ã€‚ 500çº§åˆ«, è¡¨ç¤ºæœåŠ¡å™¨é”™è¯¯.\n* 500 - Internal server errorï¼Œè¿™è¡¨ç¤ºæ˜¯æœåŠ¡å™¨å‘ç”Ÿäº†é”™è¯¯    HTTP GET  å•ä¸ªæ•°æ®\næ‰¾åˆ°äº†: 200\næ²¡æ‰¾åˆ°: 404  1 2 3 4 5 6 7 8 9 10 11  [HttpGet(\u0026#34;{id}\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; Get(int id) { var post = await _postRepository.GetPostByIdAsync(id); if (post == null) { return NotFound();//404  } var postResource = _mapper.Map\u0026lt;Post, PostResource\u0026gt;(post); return Ok(postResource); //200  }    é›†åˆæ•°æ®\nè‡³å°‘æœ‰ä¸€æ¡æ•°æ®, 200\næ²¡æœ‰æ•°æ®, ä¹Ÿæ˜¯200  1 2 3 4 5 6 7  [HttpGet] public async Task\u0026lt;IActionResult\u0026gt; Get() { var posts = await _postRepository.GetAllPostsAsync(); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(posts); return Ok(postResources); }   å†…å®¹åå•† å¦‚æœèµ„æºæ”¯æŒå¤šç§å±•ç°æ ¼å¼ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…å¯ä»¥é€‰æ‹©å®ƒæƒ³è¦çš„æ ¼å¼\n åœ¨è¯·æ±‚çš„Accept HeaderæŒ‡å®šMedia Type\n* application/json, application/xml\n* è‹¥æœªæŒ‡å®š, è¿”å›é»˜è®¤ application/json è¯·æ±‚çš„media typeä¸å¯ç”¨æ—¶, å¹¶ä¸”æ¶ˆè´¹è€…ä¸æ”¯æŒé»˜è®¤æ ¼å¼, è¿”å›406 ASP.NET Coreæ”¯æŒè¾“å‡ºå’Œè¾“å…¥ä¸¤ç§æ ¼å¼åŒ–å™¨.\n* ç”¨äºè¾“å‡ºçš„media typeæ”¾åœ¨Accept Headeré‡Œ, è¡¨ç¤ºå®¢æˆ·ç«¯æ¥å—è¿™ç§æ ¼å¼çš„è¾“å‡º.\n* ç”¨äºè¾“å…¥çš„media typeæ”¾Content-Type Headeré‡Œ, è¡¨ç¤ºå®¢æˆ·ç«¯ä¼ è¿›æ¥çš„æ•°æ®æ˜¯è¿™ç§æ ¼å¼.\n* ReturnHttpNotAcceptableè®¾ä¸ºtrue, å°±ä¼šè¿”å›406.  1 2 3 4 5 6  services.AddMvc( options=\u0026gt; { options.ReturnHttpNotAcceptable = true; //å¼€å¯406  options.OutputFormatters.Add(new XmlDataContractSerializerOutputFormatter()); });   ","description":"","id":23,"section":"code","tags":null,"title":"08_RESTful API","uri":"https://xtddw.github.io/code/dotnetcore/08rest/"},{"content":"ç¿»é¡µ  Query String\nhttp://localhost:5000/api/posts?pageIndex=1\u0026amp;pageSize=10\u0026amp;orderBy=id ä½¿ç”¨æŠ½è±¡çˆ¶ç±» QueryParameters, åŒ…å«å¸¸è§å‚æ•°:\nPageIndex PageSize OrderByâ€¦  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69  public abstract class QueryParameters : INotifyPropertyChanged { private const int DefaultPageSize = 10; private const int DefaultMaxPageSize = 100; private int _pageIndex; public int PageIndex { get { return _pageIndex; } set { _pageIndex = value \u0026gt;= 0 ? value : 0; } } private int _pageSize; public virtual int PageSize { get { return _pageSize; } set =\u0026gt; SetField(ref _pageSize, value); } private string _orderBy; public string OrderBy { get { return _orderBy; } set { _orderBy = value ?? nameof(IEntity.Id); } } private int _maxPageSize = DefaultMaxPageSize; protected internal virtual int MaxPageSize { get { return _maxPageSize; } set =\u0026gt; SetField(ref _maxPageSize, value); } public string Fields { get; set; } public event PropertyChangedEventHandler PropertyChanged; protected void OnPropertyChanged([CallerMemberName] string propertyName = null) { PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName)); } protected bool SetField\u0026lt;T\u0026gt;(ref T field, T value, [CallerMemberName] string propertyName = null) { if (EqualityComparer\u0026lt;T\u0026gt;.Default.Equals(field, value)) { return false; } field = value; OnPropertyChanged(propertyName); if (propertyName == nameof(PageSize) || propertyName == nameof(MaxPageSize)) { SetPageSize(); } return true; } private void SetPageSize() { if (_maxPageSize\u0026lt;=0) { _maxPageSize = DefaultMaxPageSize; } if (_pageSize\u0026lt;=0) { _pageSize = DefaultPageSize; } _pageSize = _pageSize \u0026gt; _maxPageSize ? _maxPageSize : _pageSize; } }   å­ç±»ç»§æ‰¿  1 2 3  public class PostParameters:QueryParameters { }   HTTP Get ä¼ å‚  1 2 3 4 5 6 7  [HttpGet] public async Task\u0026lt;IActionResult\u0026gt; Get(PostParameters postParameters) { var posts = await _postRepository.GetAllPostsAsync(postParameters); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(posts); return Ok(postResources); }   ä¿®æ”¹Repositroy  1 2 3 4 5 6 7 8 9  public async Task\u0026lt;IEnumerable\u0026lt;Post\u0026gt;\u0026gt; GetAllPostsAsync(PostParameters postParameters) { var query = _applicationContext.Posts.OrderBy(x =\u0026gt; x.Id); return await query .Skip(postParameters.PageIndex * postParameters.PageSize) .Take(postParameters.PageSize) .ToListAsync(); }   è¿”å›ç¿»é¡µå…ƒæ•°æ®  å¦‚æœå°†æ•°æ®å’Œç¿»é¡µå…ƒæ•°æ®ä¸€èµ·è¿”å›:\n* * å“åº”çš„bodyä¸å†ç¬¦åˆAccept Headeräº†(ä¸æ˜¯èµ„æºçš„application/json), è¿™æ˜¯ä¸€ç§æ–°çš„media type.\n* è¿åRESTçº¦æŸ, APIæ¶ˆè´¹è€…ä¸çŸ¥é“å¦‚ä½•é€šè¿‡application/jsonè¿™ä¸ªç±»å‹æ¥è§£é‡Šå“åº”çš„æ•°æ®. ç¿»é¡µæ•°æ®ä¸æ˜¯èµ„æºè¡¨è¿°çš„ä¸€éƒ¨åˆ†, åº”ä½¿ç”¨è‡ªå®šä¹‰Header (X-Pagination). å­˜æ”¾ç¿»é¡µæ•°æ®çš„ç±»: PaginatedListå¯ä»¥ç»§æ‰¿äºList.  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  public class PaginatedList\u0026lt;T\u0026gt;:List\u0026lt;T\u0026gt; where T:class { public int PageSize { get; set; } public int PageIndex { get; set; } private int _totalItemsCount; public int TotalItemsCount { get { return _totalItemsCount; } set { _totalItemsCount = value; } } public int PageCount =\u0026gt; TotalItemsCount / PageSize + (TotalItemsCount % PageSize \u0026gt; 0 ? 1 : 0); public bool HasPrevious =\u0026gt; PageIndex \u0026gt; 0; public bool HasNext =\u0026gt; PageIndex \u0026lt; PageCount - 1; public PaginatedList(int pageIndex,int pageSize,int totalItemsCount,IEnumerable\u0026lt;T\u0026gt; data) { PageIndex = pageIndex; PageSize = pageSize; TotalItemsCount = totalItemsCount; AddRange(data); } }   ä¿®æ”¹Repository\n1 2 3 4 5 6 7 8 9 10 11  public async Task\u0026lt;PaginatedList\u0026lt;Post\u0026gt;\u0026gt; GetAllPostsAsync(PostParameters postParameters) { var query = _applicationContext.Posts.OrderBy(x =\u0026gt; x.Id); var count = await query.CountAsync(); var data = await query .Skip(postParameters.PageIndex * postParameters.PageSize) .Take(postParameters.PageSize) .ToListAsync(); return new PaginatedList\u0026lt;Post\u0026gt;(postParameters.PageIndex, postParameters.PageSize, count, data); }   ä¿®æ”¹controller\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  [HttpGet] public async Task\u0026lt;IActionResult\u0026gt; Get(PostParameters postParameters) { var postList = await _postRepository.GetAllPostsAsync(postParameters); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(postList); var meta = new { postList.PageSize, postList.PageIndex, postList.TotalItemsCount, postList.PageCount }; Response.Headers.Add(\u0026#34;X-Pagination\u0026#34;, JsonConvert.SerializeObject(meta, new JsonSerializerSettings { //ä½¿å¾—å‘½åç¬¦åˆé©¼å³°å‘½åæ³•  ContractResolver = new CamelCasePropertyNamesContractResolver() })); return Ok(postResources); }   ç”Ÿæˆå‰åé¡µçš„URI  æšä¸¾UriType  1 2 3 4 5 6  public enum PaginationResourceUriType { CurrentPage, PreviousPage, NextPage }   æ³¨å†ŒUrlHelper  1 2 3 4 5 6 7  //æ³¨å†ŒUrlHelper services.AddSingleton\u0026lt;IActionContextAccessor, ActionContextAccessor\u0026gt;(); services.AddScoped\u0026lt;IUrlHelper\u0026gt;(factory =\u0026gt; { var actionContext = factory.GetService\u0026lt;IActionContextAccessor\u0026gt;().ActionContext; return new IUrlHelper(actionContext); });   åˆ›å»ºCreatePostUri()æ–¹æ³•  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  private string CreatePostUri(PostParameters parameters,PaginationResourceUriType uriType) { switch(uriType) { case PaginationResourceUriType.PreviousPage: var previousParameters = new { pageIndex = parameters.PageIndex - 1, pagesize = parameters.PageSize, orderBy = parameters.OrderBy, fields = parameters.Fields }; return _urlHelper.Link(\u0026#34;GetPosts\u0026#34;, previousParameters); case PaginationResourceUriType.NextPage: var nextParameters = new { pageIndex = parameters.PageIndex + 1, pagesize = parameters.PageSize, orderBy = parameters.OrderBy, fields = parameters.Fields }; return _urlHelper.Link(\u0026#34;GetPosts\u0026#34;, nextParameters); default: var currentParameters = new { pageIndex = parameters.PageIndex, pagesize = parameters.PageSize, orderBy = parameters.OrderBy, fields = parameters.Fields }; return _urlHelper.Link(\u0026#34;GetPosts\u0026#34;, currentParameters); } }   ä¿®æ”¹Getæ–¹æ³•  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  [HttpGet(Name =\u0026#34;GetPosts\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; Get(PostParameters postParameters) { var postList = await _postRepository.GetAllPostsAsync(postParameters); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(postList); var previousPageLink = postList.HasPrevious ? CreatePostUri(postParameters, PaginationResourceUriType.PreviousPage) : null; var nextPageLink = postList.HasNext ? CreatePostUri(postParameters, PaginationResourceUriType.NextPage) : null; var meta = new { postList.PageSize, postList.PageIndex, postList.TotalItemsCount, postList.PageCount, previousPageLink, nextPageLink }; Response.Headers.Add(\u0026#34;X-Pagination\u0026#34;, JsonConvert.SerializeObject(meta, new JsonSerializerSettings { //ä½¿å¾—å‘½åç¬¦åˆé©¼å³°å‘½åæ³•  ContractResolver = new CamelCasePropertyNamesContractResolver() })); return Ok(postResources); }   è¿‡æ»¤å’Œæœç´¢  è¿‡æ»¤: å¯¹é›†åˆèµ„æºé™„åŠ ä¸€äº›æ¡ä»¶, ç­›é€‰å‡ºç»“æœ.\nhttp://localhost:5000/api/posts?title=China\næ¡ä»¶åº”ç”¨äºResource Model.\nè¿‡æ»¤å±æ€§å¯ä»¥æ”¾åœ¨QueryParametersçš„å­ç±»é‡Œ.  1 2 3 4  public class PostParameters:QueryParameters { public string Title { get; set; } }   ä¿®æ”¹Repository\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  public async Task\u0026lt;PaginatedList\u0026lt;Post\u0026gt;\u0026gt; GetAllPostsAsync(PostParameters postParameters) { var query = _applicationContext.Posts.AsQueryable(); if (!string.IsNullOrEmpty(postParameters.Title)) { var title = postParameters.Title.ToLowerInvariant(); query = query.Where(x =\u0026gt; x.Title.ToLowerInvariant()==title); } query = query.OrderBy(x =\u0026gt; x.Id); var count = await query.CountAsync(); var data = await query .Skip(postParameters.PageIndex * postParameters.PageSize) .Take(postParameters.PageSize) .ToListAsync(); return new PaginatedList\u0026lt;Post\u0026gt;(postParameters.PageIndex, postParameters.PageSize, count, data); }    æœç´¢: ä½¿ç”¨å…³é”®å­—å¯¹é›†åˆèµ„æºè¿›è¡Œæ¨¡ç³Šæœç´¢.\nhttp://localhost/api/posts?searchTerm=hin  æ’åº  é—®é¢˜\nç¿»é¡µéœ€è¦æ’åº.\nè®©èµ„æºæŒ‰ç…§èµ„æºçš„æŸä¸ªå±æ€§æˆ–å¤šä¸ªå±æ€§è¿›è¡Œæ­£å‘æˆ–åå‘çš„æ’åº.\nResource Modelçš„ä¸€ä¸ªå±æ€§å¯èƒ½ä¼šæ˜ å°„åˆ°Entity Modelçš„å¤šä¸ªå±æ€§ä¸Š\nResource Modelä¸Šçš„æ­£åºå¯èƒ½åœ¨Entity Modelä¸Šå°±æ˜¯å€’åºçš„\néœ€è¦æ”¯æŒå¤šå±æ€§çš„æ’åº\nå¤ç”¨ å®‰è£…System.Linq.Dynamic.Core æ’åºå¼‚å¸¸è¿”å›400BadRequest æ’åºæ€è·¯   PropertyMappingContainer\n* PropertyMapping (PostPropertyMapping)\n* MappedProperty\n  MappedProperty 1 2 3 4 5  public class MappedProperty { public string Name { get; set; } public bool Revert { get; set; } }   PropertyMapping 1 2 3 4  public interface IPropertyMapping { Dictionary\u0026lt;string, List\u0026lt;MappedProperty\u0026gt;\u0026gt; MappingDictionary { get; } }   1 2 3 4 5 6 7 8 9 10 11 12 13 14  public abstract class PropertyMapping\u0026lt;TSource,TDestination\u0026gt;:IPropertyMapping where TDestination:IEntity { //å¯èƒ½æ˜ å°„å¤šä¸ªEntityä¸­å±æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨List\u0026lt;MappedProperty\u0026gt;  public Dictionary\u0026lt;string,List\u0026lt;MappedProperty\u0026gt;\u0026gt; MappingDictionary { get; } protected PropertyMapping(Dictionary\u0026lt;string,List\u0026lt;MappedProperty\u0026gt;\u0026gt; mappingDictionary) { MappingDictionary = mappingDictionary; MappingDictionary[nameof(IEntity.Id)] = new List\u0026lt;MappedProperty\u0026gt; { new MappedProperty{Name=nameof(IEntity.Id),Revert =false} }; } }    PostPropertyMapping  1 2 3 4 5 6 7 8 9 10 11 12  public class PostPropertyMapping : PropertyMapping\u0026lt;PostResource, Post\u0026gt; { public PostPropertyMapping() : base(new Dictionary\u0026lt;string, List\u0026lt;MappedProperty\u0026gt;\u0026gt;(StringComparer.OrdinalIgnoreCase) { [nameof(PostResource.Title)] = new List\u0026lt;MappedProperty\u0026gt; { new MappedProperty { Name=nameof(Post.Title),Revert=false}}, [nameof(PostResource.Body)] = new List\u0026lt;MappedProperty\u0026gt; { new MappedProperty { Name=nameof(Post.Body),Revert=false}}, [nameof(PostResource.Author)] = new List\u0026lt;MappedProperty\u0026gt; { new MappedProperty { Name=nameof(Post.Author),Revert=false}}, }) { }   PropertyMappingContainer 1 2 3 4 5 6  public interface IPropertyMappingContainer { void Register\u0026lt;T\u0026gt;() where T : IPropertyMapping, new(); IPropertyMapping Resolve\u0026lt;TSource, TDestination\u0026gt;() where TDestination : IEntity; bool ValidateMappingExistsFor\u0026lt;TSource, TDestination\u0026gt;(string fields) where TDestination : IEntity; }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49  public class PropertyMappingContainer : IPropertyMappingContainer { protected internal readonly IList\u0026lt;IPropertyMapping\u0026gt; PropertyMappings = new List\u0026lt;IPropertyMapping\u0026gt;(); public void Register\u0026lt;T\u0026gt;() where T : IPropertyMapping, new() { if (PropertyMappings.All(x=\u0026gt;x.GetType()!=typeof(T))) { PropertyMappings.Add(new T()); } } //æ³¨å†Œ  public IPropertyMapping Resolve\u0026lt;TSource, TDestination\u0026gt;() where TDestination : IEntity { var matchingMapping = PropertyMappings.OfType\u0026lt;PropertyMapping\u0026lt;TSource, TDestination\u0026gt;\u0026gt;().ToList(); if (matchingMapping.Count ==1) { return matchingMapping.First(); } throw new Exception($\u0026#34;Cannot find property mapping instance for {typeof(TSource)},{typeof(TDestination)}\u0026#34;); } //éªŒè¯  public bool ValidateMappingExistsFor\u0026lt;TSource, TDestination\u0026gt;(string fields) where TDestination : IEntity { var propertyMapping = Resolve\u0026lt;TSource, TDestination\u0026gt;(); if (string.IsNullOrWhiteSpace(fields)) { return false; } var fieldsAfterSplit = fields.Split(\u0026#39;,\u0026#39;); foreach (var field in fieldsAfterSplit) { var trimedField = field.Trim(); var indexOfFirstSpace = trimedField.IndexOf(\u0026#34; \u0026#34;, StringComparison.Ordinal); var propertyName = indexOfFirstSpace == -1 ? trimedField : trimedField.Remove(indexOfFirstSpace); if (string.IsNullOrWhiteSpace(propertyName)) { continue; } if (!propertyMapping.MappingDictionary.ContainsKey(propertyName)) { return false; } } return true; } }   æ³¨å†ŒæœåŠ¡ 1 2 3 4 5 6 7  //æ³¨å†Œæ’åºæœåŠ¡  //1.æ–°å»ºä¸€ä¸ªå®¹å™¨ var propertyMappingContainer = new PropertyMappingContainer(); //2.æŠŠPostPropertyMappingæ³¨å†Œ propertyMappingContainer.Register\u0026lt;PostPropertyMapping\u0026gt;(); //3.æ³¨å†Œå•ä¾‹å®¹å™¨ services.AddSingleton\u0026lt;IPropertyMappingContainer\u0026gt;(propertyMappingContainer);   QueryableExtensions 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95  public static class QueryableExtensions { public static IQueryable\u0026lt;T\u0026gt; ApplySort\u0026lt;T\u0026gt;(this IQueryable\u0026lt;T\u0026gt; source, string orderBy, IPropertyMapping propertyMapping) { if (source ==null) throw new ArgumentNullException(nameof(source)); if (propertyMapping == null) throw new ArgumentNullException(nameof(propertyMapping)); var mappingDictionary = propertyMapping.MappingDictionary; if (mappingDictionary ==null) throw new ArgumentNullException(nameof(mappingDictionary)); if (string.IsNullOrWhiteSpace(orderBy)) return source; var orderByAfterSplit = orderBy.Split(\u0026#39;,\u0026#39;); foreach (var orderByClause in orderByAfterSplit.Reverse()) { var trimedOrderByClause = orderByClause.Trim(); var orderDescending = trimedOrderByClause.EndsWith(\u0026#34; desc\u0026#34;); var indexOfFirstSpace = trimedOrderByClause.IndexOf(\u0026#34; \u0026#34;, StringComparison.Ordinal); var propertyName = indexOfFirstSpace == -1 ? trimedOrderByClause : trimedOrderByClause.Remove(indexOfFirstSpace); if (string.IsNullOrEmpty(propertyName)) continue; if (!mappingDictionary.TryGetValue(propertyName,out List\u0026lt;MappedProperty\u0026gt; mappedProperties)) throw new ArgumentNullException($\u0026#34;Key mapping for {propertyName} is missing\u0026#34;); if (mappedProperties == null) throw new ArgumentNullException(propertyName); mappedProperties.Reverse(); foreach (var destinationProperty in mappedProperties) { if (destinationProperty.Revert) { orderDescending = !orderDescending; } source = source.OrderBy(destinationProperty.Name + (orderDescending ? \u0026#34; descending\u0026#34; : \u0026#34; ascending\u0026#34;)); //OrderBy =====\u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt; System.Linq.Dynamic.Core;  } } return source; } public static IQueryable\u0026lt;object\u0026gt; ToDynamicQueryable\u0026lt;TSource\u0026gt; (this IQueryable\u0026lt;TSource\u0026gt; source, string fields, Dictionary\u0026lt;string, List\u0026lt;MappedProperty\u0026gt;\u0026gt; mappingDictionary) { if (source == null) { throw new ArgumentNullException(nameof(source)); } if (mappingDictionary == null) { throw new ArgumentNullException(nameof(mappingDictionary)); } if (string.IsNullOrWhiteSpace(fields)) { return (IQueryable\u0026lt;object\u0026gt;)source; } fields = fields.ToLower(); var fieldsAfterSplit = fields.Split(\u0026#39;,\u0026#39;).ToList(); if (!fieldsAfterSplit.Contains(\u0026#34;id\u0026#34;, StringComparer.InvariantCultureIgnoreCase)) { fieldsAfterSplit.Add(\u0026#34;id\u0026#34;); } var selectClause = \u0026#34;new (\u0026#34;; foreach (var field in fieldsAfterSplit) { var propertyName = field.Trim(); if (string.IsNullOrEmpty(propertyName)) { continue; } var key = mappingDictionary.Keys.SingleOrDefault(k =\u0026gt; String.CompareOrdinal(k.ToLower(), propertyName.ToLower()) == 0); if (string.IsNullOrEmpty(key)) { throw new ArgumentException($\u0026#34;Key mapping for {propertyName} is missing\u0026#34;); } var mappedProperties = mappingDictionary[key]; if (mappedProperties == null) { throw new ArgumentNullException(key); } foreach (var destinationProperty in mappedProperties) { selectClause += $\u0026#34; {destinationProperty.Name},\u0026#34;; } } selectClause = selectClause.Substring(0, selectClause.Length - 1) + \u0026#34;)\u0026#34;; return (IQueryable\u0026lt;object\u0026gt;)source.Select(selectClause); } }   ä¿®æ”¹Repository 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  public async Task\u0026lt;PaginatedList\u0026lt;Post\u0026gt;\u0026gt; GetAllPostsAsync(PostParameters postParameters) { var query = _applicationContext.Posts.AsQueryable(); if (!string.IsNullOrEmpty(postParameters.Title)) { var title = postParameters.Title.ToLowerInvariant(); query = query.Where(x =\u0026gt; x.Title.ToLowerInvariant()==title); } //è°ƒç”¨æ’åº  //query = query.OrderBy(x =\u0026gt; x.Id);  query = query.ApplySort(postParameters.OrderBy, _propertyMappingContainer.Resolve\u0026lt;PostResource, Post\u0026gt;()); var count = await query.CountAsync(); var data = await query .Skip(postParameters.PageIndex * postParameters.PageSize) .Take(postParameters.PageSize) .ToListAsync(); return new PaginatedList\u0026lt;Post\u0026gt;(postParameters.PageIndex, postParameters.PageSize, count, data); }   ","description":"","id":24,"section":"code","tags":null,"title":"09_ç¿»é¡µè¿‡æ»¤æ’åº","uri":"https://xtddw.github.io/code/dotnetcore/09%E7%BF%BB%E9%A1%B5%E8%BF%87%E6%BB%A4%E6%8E%92%E5%BA%8F/"},{"content":"èµ„æºå¡‘å½¢ å¦‚æœèµ„æºçš„å±æ€§è¾ƒå¤š, è€Œä¸”APIæ¶ˆè´¹è€…åªéœ€è¦ä¸€åˆ†éƒ¨å±æ€§, é‚£ä¹ˆå°±åº”è¯¥è€ƒè™‘èµ„æºå¡‘å½¢\né›†åˆèµ„æº å•ä¸ªèµ„æº å¼‚å¸¸å¤„ç†\n IEnumerableExtensions  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50  //é›†åˆèµ„æºå¡‘æ€§  public static class IEnumerableExtensions { public static IEnumerable\u0026lt;ExpandoObject\u0026gt; ToDynamicIEnumerable\u0026lt;TSource\u0026gt;(this IEnumerable\u0026lt;TSource\u0026gt; source,string fields = null) { if (source ==null) { throw new ArgumentNullException(nameof(source)); } var expandoObjectList = new List\u0026lt;ExpandoObject\u0026gt;(); var propertyInfoList = new List\u0026lt;PropertyInfo\u0026gt;(); if (string.IsNullOrWhiteSpace(fields)) { var propertyInfos = typeof(TSource).GetProperties(BindingFlags.Public | BindingFlags.Instance); propertyInfoList.AddRange(propertyInfos); } else { var fieldsAfterSplit = fields.Split(\u0026#39;,\u0026#39;).ToList(); foreach (var field in fieldsAfterSplit) { var propertyName = field.Trim(); if (string.IsNullOrEmpty(propertyName)) { continue; } var propertyInfo = typeof(TSource).GetProperty(propertyName, BindingFlags.IgnoreCase | BindingFlags.Public | BindingFlags.Instance); if (propertyInfo ==null) { throw new Exception($\u0026#34;Property {propertyName} was\u0026#39;t found on {typeof(TSource)}\u0026#34;); } propertyInfoList.Add(propertyInfo); } } foreach (TSource sourceObject in source) { var dataShapedObject = new ExpandoObject(); foreach (var propertyInfo in propertyInfoList) { var propertyValue = propertyInfo.GetValue(sourceObject); ((IDictionary\u0026lt;string, object\u0026gt;)dataShapedObject).Add(propertyInfo.Name, propertyValue); } expandoObjectList.Add(dataShapedObject); } return expandoObjectList; } }   ObjectExtensions  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  //å•ä¸ªèµ„æºå¡‘æ€§  public static class ObjectExtensions { public static ExpandoObject ToDynamic\u0026lt;TSoucre\u0026gt;(this TSoucre source,string fields = null) { if (source == null) { throw new ArgumentNullException(nameof(source)); } var dataShapedObject = new ExpandoObject(); if (string.IsNullOrWhiteSpace(fields)) { var propertyInfos = typeof(TSoucre).GetProperties(BindingFlags.IgnoreCase | BindingFlags.Public | BindingFlags.Instance); foreach (var propertyInfo in propertyInfos) { var propertyValue = propertyInfo.GetValue(source); ((IDictionary\u0026lt;string, object\u0026gt;)dataShapedObject).Add(propertyInfo.Name, propertyValue); } return dataShapedObject; } var fieldsAfterSplit = fields.Split(\u0026#39;,\u0026#39;).ToList(); foreach (var field in fieldsAfterSplit) { var propertyName = field.Trim(); var propertyInfo = typeof(TSoucre).GetProperty(propertyName, BindingFlags.IgnoreCase | BindingFlags.Public | BindingFlags.Instance); if (propertyInfo ==null) { throw new Exception($\u0026#34;Can\u0026#39;t found property {typeof(TSoucre)} on {propertyName}\u0026#34;); } var propertyValue = propertyInfo.GetValue(source); ((IDictionary\u0026lt;string, object\u0026gt;)dataShapedObject).Add(propertyInfo.Name, propertyValue); } return dataShapedObject; } }   ä¿®æ”¹controller  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  [HttpGet(Name =\u0026#34;GetPosts\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; Get(PostParameters postParameters) { var postList = await _postRepository.GetAllPostsAsync(postParameters); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(postList); //é›†åˆèµ„æºå¡‘æ€§  var shapedPostResources = postResources.ToDynamicIEnumerable(postParameters.Fields); var previousPageLink = postList.HasPrevious ? CreatePostUri(postParameters, PaginationResourceUriType.PreviousPage) : null; var nextPageLink = postList.HasNext ? CreatePostUri(postParameters, PaginationResourceUriType.NextPage) : null; var meta = new { postList.PageSize, postList.PageIndex, postList.TotalItemsCount, postList.PageCount, previousPageLink, nextPageLink }; Response.Headers.Add(\u0026#34;X-Pagination\u0026#34;, JsonConvert.SerializeObject(meta, new JsonSerializerSettings { //ä½¿å¾—å‘½åç¬¦åˆé©¼å³°å‘½åæ³•  ContractResolver = new CamelCasePropertyNamesContractResolver() })); return Ok(shapedPostResources);   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  [HttpGet(\u0026#34;{id}\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; Get(int id, string fields = null) { var post = await _postRepository.GetPostByIdAsync(id); if (post == null) { return NotFound();//404  } var postResource = _mapper.Map\u0026lt;Post, PostResource\u0026gt;(post); //å•ä¸ªèµ„æºå¡‘æ€§  var shapedPostResource = postResource.ToDynamic(fields); return Ok(shapedPostResource); //200  }   4. ä¿®æ”¹startup,è¿”å›èµ„æºå‘½åä¸ºé©¼å³°å‘½å\n1 2 3 4 5 6 7 8 9 10  services.AddMvc( options=\u0026gt; { options.ReturnHttpNotAcceptable = true; //å¼€å¯406  options.OutputFormatters.Add(new XmlDataContractSerializerOutputFormatter()); }) .AddJsonOptions(options=\u0026gt; { options.SerializerSettings.ContractResolver = new CamelCasePropertyNamesContractResolver(); });   å¼‚å¸¸å¤„ç†  ITypeHelperService  1 2 3 4  public interface ITypeHelperService { bool TypeHasProperties\u0026lt;T\u0026gt;(string fields); }   TypeHelperService  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  public class TypeHelperService:ITypeHelperService { public bool TypeHasProperties\u0026lt;T\u0026gt;(string fields) { if (string.IsNullOrWhiteSpace(fields)) { return true; } var fieldsAfterSplit = fields.Split(\u0026#39;,\u0026#39;); foreach (var field in fieldsAfterSplit) { var propertyName = field.Trim(); if (string.IsNullOrEmpty(propertyName)) { continue; } var propertyInfo = typeof(T) .GetProperty(propertyName, BindingFlags.IgnoreCase | BindingFlags.Public | BindingFlags.Instance); if (propertyInfo == null) { return false; } } return true; } }   æ³¨å†ŒTypeHelperService  1  services.AddTransient\u0026lt;ITypeHelperService, TypeHelperService\u0026gt;();   ä¿®æ”¹Controller  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56  [HttpGet(Name =\u0026#34;GetPosts\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; Get(PostParameters postParameters) { if (!_propertyMappingContainer.ValidateMappingExistsFor\u0026lt;PostResource,Post\u0026gt;(postParameters.OrderBy)) { return BadRequest(\u0026#34;cannot finds fields for sorting.\u0026#34;); } if (!_typeHelperService.TypeHasProperties\u0026lt;PostResource\u0026gt;(postParameters.Fields)) { return BadRequest(\u0026#34;Fields not exist.\u0026#34;); } var postList = await _postRepository.GetAllPostsAsync(postParameters); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(postList); //é›†åˆèµ„æºå¡‘æ€§  var shapedPostResources = postResources.ToDynamicIEnumerable(postParameters.Fields); var previousPageLink = postList.HasPrevious ? CreatePostUri(postParameters, PaginationResourceUriType.PreviousPage) : null; var nextPageLink = postList.HasNext ? CreatePostUri(postParameters, PaginationResourceUriType.NextPage) : null; var meta = new { postList.PageSize, postList.PageIndex, postList.TotalItemsCount, postList.PageCount, previousPageLink, nextPageLink }; Response.Headers.Add(\u0026#34;X-Pagination\u0026#34;, JsonConvert.SerializeObject(meta, new JsonSerializerSettings { //ä½¿å¾—å‘½åç¬¦åˆé©¼å³°å‘½åæ³•  ContractResolver = new CamelCasePropertyNamesContractResolver() })); return Ok(shapedPostResources); } [HttpGet(\u0026#34;{id}\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; Get(int id, string fields = null) { if (!_typeHelperService.TypeHasProperties\u0026lt;PostResource\u0026gt;(fields)) { return BadRequest(\u0026#34;Fields not exist.\u0026#34;); } var post = await _postRepository.GetPostByIdAsync(id); if (post == null) { return NotFound();//404  } var postResource = _mapper.Map\u0026lt;Post, PostResource\u0026gt;(post); //å•ä¸ªèµ„æºå¡‘æ€§  var shapedPostResource = postResource.ToDynamic(fields); return Ok(shapedPostResource); //200  }   ","description":"","id":25,"section":"code","tags":null,"title":"10_èµ„æºå¡‘å½¢","uri":"https://xtddw.github.io/code/dotnetcore/10%E8%B5%84%E6%BA%90%E5%A1%91%E5%BD%A2/"},{"content":"Hypermedia as the Engine of Application State\nRESTé‡Œæœ€å¤æ‚çš„çº¦æŸ, æ„å»ºæˆç†ŸREST APIçš„æ ¸å¿ƒ\n å¯è¿›åŒ–æ€§, è‡ªæˆ‘æè¿° è¶…åª’ä½“(Hypermedia, ä¾‹å¦‚è¶…é“¾æ¥)é©±åŠ¨å¦‚ä½•æ¶ˆè´¹å’Œä½¿ç”¨API  ä¸ä½¿ç”¨HATEOAS  å®¢æˆ·ç«¯æ›´å¤šçš„éœ€è¦äº†è§£APIå†…åœ¨é€»è¾‘ å¦‚æœAPIå‘ç”Ÿäº†ä¸€ç‚¹å˜åŒ–(æ·»åŠ äº†é¢å¤–çš„è§„åˆ™, æ”¹å˜è§„åˆ™)éƒ½ä¼šç ´åAPIçš„æ¶ˆè´¹è€…. APIæ— æ³•ç‹¬ç«‹äºæ¶ˆè´¹å®ƒçš„åº”ç”¨è¿›è¡Œè¿›åŒ–.\n  ä½¿ç”¨HATEOAS  è¿™ä¸ªresponseé‡Œé¢åŒ…å«äº†è‹¥å¹²link, ç¬¬ä¸€ä¸ªlinkåŒ…å«ç€è·å–å½“å‰å“åº”çš„é“¾æ¥, ç¬¬äºŒä¸ªlinkåˆ™å‘Šè¯‰å®¢æˆ·ç«¯å¦‚ä½•å»æ›´æ–°è¯¥post. ä¸æ”¹å˜å“åº”ä¸»ä½“ç»“æœçš„æƒ…å†µä¸‹æ·»åŠ å¦å¤–ä¸€ä¸ªåˆ é™¤çš„åŠŸèƒ½(link), å®¢æˆ·ç«¯é€šè¿‡å“åº”é‡Œçš„linkså°±ä¼šå‘ç°è¿™ä¸ªåˆ é™¤åŠŸèƒ½, ä½†æ˜¯å¯¹å…¶ä»–éƒ¨åˆ†éƒ½æ²¡æœ‰å½±å“.\n  å±•ç¤ºé“¾æ¥  JSONå’ŒXMLå¹¶æ²¡æœ‰å¦‚ä½•å±•ç¤ºlinkçš„æ¦‚å¿µ. ä½†æ˜¯HTMLçš„anchorå…ƒç´ å´çŸ¥é“: .  hrefåŒ…å«äº†URI relåˆ™æè¿°äº†linkå¦‚ä½•å’Œèµ„æºçš„å…³ç³» typeæ˜¯å¯é€‰çš„, å®ƒè¡¨ç¤ºäº†åª’ä½“çš„ç±»å‹   æˆ‘ä»¬çš„ä¾‹å­:  method: å®šä¹‰äº†éœ€è¦ä½¿ç”¨çš„æ–¹æ³• rel: è¡¨æ˜äº†åŠ¨ä½œçš„ç±»å‹ href: åŒ…å«äº†æ‰§è¡Œè¿™ä¸ªåŠ¨ä½œæ‰€åŒ…å«çš„URI.\n    å®ç°  é™æ€åŸºç±»\néœ€è¦åŸºç±»(åŒ…å«link)å’ŒåŒ…è£…ç±», ä¹Ÿå°±æ˜¯è¿”å›çš„èµ„æºé‡Œé¢éƒ½å«æœ‰link, é€šè¿‡ç»§æ‰¿äºåŒä¸€ä¸ªåŸºç±»æ¥å®ç° åŠ¨æ€ç±»å‹, éœ€è¦ä½¿ç”¨ä¾‹å¦‚åŒ¿åç±»æˆ–ExpandoObjectç­‰\n* å¯¹äºå•ä¸ªèµ„æºå¯ä»¥ä½¿ç”¨ExpandoObject\n* å¯¹äºé›†åˆç±»èµ„æºåˆ™ä½¿ç”¨åŒ¿åç±».   LinkResource  1 2 3 4 5 6 7 8 9 10 11 12  public class LinkResource { public LinkResource(string href,string rel,string method) { Href = href; Rel = rel; Method = method; } public string Href { get; set; } public string Rel { get; set; } public string Method { get; set; } }   Controllerä¸­æ·»åŠ CreateLinksForPost  1 2 3 4 5 6 7 8 9 10 11 12 13  //ä¸ºæ¯ä¸ªèµ„æºåˆ›å»ºé“¾æ¥link  private IEnumerable\u0026lt;LinkResource\u0026gt; CreateLinksForPost(int id,string fields = null) { var links = new List\u0026lt;LinkResource\u0026gt;(); if (string.IsNullOrWhiteSpace(fields)) links.Add(new LinkResource(_urlHelper.Link(\u0026#34;GetPost\u0026#34;, new { id }), \u0026#34;self\u0026#34;, \u0026#34;GET\u0026#34;)); else links.Add(new LinkResource(_urlHelper.Link(\u0026#34;GetPost\u0026#34;, new { id,fields}), \u0026#34;self\u0026#34;, \u0026#34;GET\u0026#34;)); links.Add(new LinkResource(_urlHelper.Link(\u0026#34;DeletePost\u0026#34;, new { id }), \u0026#34;delete_post\u0026#34;, \u0026#34;DELETE\u0026#34;)); return links; }   GETPOSTä¸­è°ƒç”¨  1 2 3 4 5 6 7 8 9 10 11  //å•ä¸ªèµ„æºå¡‘æ€§ var shapedPostResource = postResource.ToDynamic(fields); //åŠ è½½link var links = CreateLinksForPost(id, fields); //æ•´åˆè¿”å›æ•°æ® var result = shapedPostResource as IDictionary\u0026lt;string, object\u0026gt;; result.Add(\u0026#34;links\u0026#34;, links); return Ok(result);   1 2 3 4 5 6 7 8 9 10 11  //é›†åˆèµ„æºå¡‘æ€§  var shapedPostResources = postResources.ToDynamicIEnumerable(postParameters.Fields); //å¾ªç¯éå†ä¸ºæ¯ä¸ªèµ„æºæ·»åŠ link var shapdeWithLinks = shapedPostResources.Select(x =\u0026gt; { var dict = x as IDictionary\u0026lt;string, object\u0026gt;; var postLinks = CreateLinksForPost((int)dict[\u0026#34;Id\u0026#34;], postParameters.Fields); dict.Add(\u0026#34;links\u0026#34;, psotLinks); return dict; });   4. é›†åˆèµ„æºæ•´ä½“Link\n1 2 3 4 5 6 7 8 9 10 11 12 13  //ä¸ºé›†åˆèµ„æºåˆ›å»ºæ•´ä½“link private IEnumerable\u0026lt;LinkResource\u0026gt; CreateLinksForPosts(PostParameters postParameters,bool hasPrevious,bool hasNext) { var links = new List\u0026lt;LinkResource\u0026gt; { new LinkResource(CreatePostUri(postParameters,PaginationResourceUriType.CurrentPage),\u0026#34;self\u0026#34;,\u0026#34;GET\u0026#34;) }; if (hasPrevious) links.Add(new LinkResource(CreatePostUri(postParameters,PaginationResourceUriType.PreviousPage),\u0026#34;previous_page\u0026#34;,\u0026#34;GET\u0026#34;)); if (hasNext) links.Add(new LinkResource(CreatePostUri(postParameters,PaginationResourceUriType.NextPage),\u0026#34;next_page\u0026#34;,\u0026#34;GET\u0026#34;)); return links; }   1 2 3 4 5 6 7 8  //é›†åˆçš„æ•´ä½“links var links = CreateLinksForPosts(postParameters, postList.HasPrevious, postList.HasNext); var result = new { values = shapdeWithLinks, links };   Vendor-specific media type åˆ›å»ºä¾›åº”å•†ç‰¹å®šåª’ä½“ç±»å‹\nä¸Šä¾‹ä¸­ä½¿ç”¨application/jsonä¼šç ´åäº†èµ„æºçš„è‡ªæˆ‘æè¿°æ€§è¿™æ¡çº¦æŸ, APIæ¶ˆè´¹è€…æ— æ³•ä»content-typeçš„ç±»å‹æ¥æ­£ç¡®çš„è§£æå“åº”.\n application/vnd.mycompany.hateoas+json\n* vndæ˜¯vendorçš„ç¼©å†™ï¼Œè¿™ä¸€æ¡æ˜¯mime typeçš„åŸåˆ™ï¼Œè¡¨ç¤ºè¿™ä¸ªåª’ä½“ç±»å‹æ˜¯ä¾›åº”å•†ç‰¹å®šçš„  è‡ªå®šä¹‰çš„æ ‡è¯†ï¼Œä¹Ÿå¯èƒ½è¿˜åŒ…æ‹¬é¢å¤–çš„å€¼ï¼Œè¿™é‡Œæˆ‘æ˜¯ç”¨çš„æ˜¯å…¬å¸åï¼Œéšåæ˜¯hateoasè¡¨ç¤ºè¿”å›çš„å“åº”é‡Œé¢è¦åŒ…å«é“¾æ¥ +json   åœ¨Startupé‡Œæ³¨å†Œ.  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  services.AddMvc( options=\u0026gt; { options.ReturnHttpNotAcceptable = true; //å¼€å¯406  //æ”¯æŒxml  //options.OutputFormatters.Add(new XmlDataContractSerializerOutputFormatter());  //è‡ªå®šä¹‰mediaType  var outputFormatter = options.OutputFormatters.OfType\u0026lt;JsonOutputFormatter\u0026gt;().FirstOrDefault(); if (outputFormatter!=null) { outputFormatter.SupportedMediaTypes.Add(\u0026#34;application/vnd.enfi.hateoas+json\u0026#34;); } }) .AddJsonOptions(options=\u0026gt; { options.SerializerSettings.ContractResolver = new CamelCasePropertyNamesContractResolver(); });    åˆ¤æ–­Media Typeç±»å‹\n* [FromHeader(Name = \u0026ldquo;Accept\u0026rdquo;)] string mediaType\n* è‡ªå®šä¹‰Actionçº¦æŸ.  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80  [HttpGet(Name = \u0026#34;GetPosts\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; Get(PostParameters postParameters, [FromHeader(Name = \u0026#34;Accept\u0026#34;)] string mediaType) { if (!_propertyMappingContainer.ValidateMappingExistsFor\u0026lt;PostResource, Post\u0026gt;(postParameters.OrderBy)) { return BadRequest(\u0026#34;cannot finds fields for sorting.\u0026#34;); } if (!_typeHelperService.TypeHasProperties\u0026lt;PostResource\u0026gt;(postParameters.Fields)) { return BadRequest(\u0026#34;Fields not exist.\u0026#34;); } var postList = await _postRepository.GetAllPostsAsync(postParameters); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(postList); //åˆ¤æ–­mediaType  if (mediaType == \u0026#34;application/vnd.enfi.hateoas+json\u0026#34;) { //é›†åˆèµ„æºå¡‘æ€§  var shapedPostResources = postResources.ToDynamicIEnumerable(postParameters.Fields); //å¾ªç¯éå†ä¸ºæ¯ä¸ªèµ„æºæ·»åŠ link  var shapdeWithLinks = shapedPostResources.Select(x =\u0026gt; { var dict = x as IDictionary\u0026lt;string, object\u0026gt;; var postLinks = CreateLinksForPost((int)dict[\u0026#34;Id\u0026#34;], postParameters.Fields); dict.Add(\u0026#34;links\u0026#34;, postLinks); return dict; }); //é›†åˆçš„æ•´ä½“links  var links = CreateLinksForPosts(postParameters, postList.HasPrevious, postList.HasNext); var result = new { values = shapdeWithLinks, links }; //var previousPageLink = postList.HasPrevious ? CreatePostUri(postParameters, PaginationResourceUriType.PreviousPage) : null;  //var nextPageLink = postList.HasNext ? CreatePostUri(postParameters, PaginationResourceUriType.NextPage) : null;  var meta = new { postList.PageSize, postList.PageIndex, postList.TotalItemsCount, postList.PageCount, //previousPageLink,  //nextPageLink  }; Response.Headers.Add(\u0026#34;X-Pagination\u0026#34;, JsonConvert.SerializeObject(meta, new JsonSerializerSettings { //ä½¿å¾—å‘½åç¬¦åˆé©¼å³°å‘½åæ³•  ContractResolver = new CamelCasePropertyNamesContractResolver() })); return Ok(result); } else //ä¸æ˜¯è‡ªå®šä¹‰çš„mediaTypeæŒ‰jsonè¿”å›ï¼Œå…ƒæ•°æ®åŒ…å«åœ¨è¿”å›çš„headä¸­  { var previousPageLink = postList.HasPrevious ? CreatePostUri(postParameters, PaginationResourceUriType.PreviousPage) : null; var nextPageLink = postList.HasNext ? CreatePostUri(postParameters, PaginationResourceUriType.NextPage) : null; var meta = new { postList.PageSize, postList.PageIndex, postList.TotalItemsCount, postList.PageCount, previousPageLink, nextPageLink }; Response.Headers.Add(\u0026#34;X-Pagination\u0026#34;, JsonConvert.SerializeObject(meta, new JsonSerializerSettings { //ä½¿å¾—å‘½åç¬¦åˆé©¼å³°å‘½åæ³•  ContractResolver = new CamelCasePropertyNamesContractResolver() })); return Ok(postResources.ToDynamicIEnumerable(postParameters.Fields)); } }   ä½¿ç”¨Actionçº¦æŸåˆ†è§£ä¸ºä¸¤ä¸ªæ–¹æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  [AttributeUsage(AttributeTargets.All, Inherited = true, AllowMultiple = true)] public class RequestHeaderMatchingMediaTypeAttribute : Attribute, IActionConstraint { private readonly string _requestHeaderToMatch; private readonly string[] _mediaTypes; public RequestHeaderMatchingMediaTypeAttribute(string requestHeaderToMatch, string[] mediaTypes) { _requestHeaderToMatch = requestHeaderToMatch; _mediaTypes = mediaTypes; } public bool Accept(ActionConstraintContext context) { var requestHeaders = context.RouteContext.HttpContext.Request.Headers; if (!requestHeaders.ContainsKey(_requestHeaderToMatch)) { return false; } foreach (var mediaType in _mediaTypes) { var mediaTypeMatches = string.Equals(requestHeaders[_requestHeaderToMatch].ToString(), mediaType, StringComparison.OrdinalIgnoreCase); if (mediaTypeMatches) { return true; } } return false; } public int Order { get; } = 0; }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51  [HttpGet(Name = \u0026#34;GetPosts\u0026#34;)] [RequestHeaderMatchingMediaType(\u0026#34;Accept\u0026#34;, new[] { \u0026#34;application/vnd.enfi.hateoas+json\u0026#34; })] public async Task\u0026lt;IActionResult\u0026gt; GetHateoas(PostParameters postParameters) { if (!_propertyMappingContainer.ValidateMappingExistsFor\u0026lt;PostResource, Post\u0026gt;(postParameters.OrderBy)) { return BadRequest(\u0026#34;cannot finds fields for sorting.\u0026#34;); } if (!_typeHelperService.TypeHasProperties\u0026lt;PostResource\u0026gt;(postParameters.Fields)) { return BadRequest(\u0026#34;Fields not exist.\u0026#34;); } var postList = await _postRepository.GetAllPostsAsync(postParameters); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(postList); //é›†åˆèµ„æºå¡‘æ€§  var shapedPostResources = postResources.ToDynamicIEnumerable(postParameters.Fields); //å¾ªç¯éå†ä¸ºæ¯ä¸ªèµ„æºæ·»åŠ link  var shapdeWithLinks = shapedPostResources.Select(x =\u0026gt; { var dict = x as IDictionary\u0026lt;string, object\u0026gt;; var postLinks = CreateLinksForPost((int)dict[\u0026#34;Id\u0026#34;], postParameters.Fields); dict.Add(\u0026#34;links\u0026#34;, postLinks); return dict; }); //é›†åˆçš„æ•´ä½“links  var links = CreateLinksForPosts(postParameters, postList.HasPrevious, postList.HasNext); var result = new { values = shapdeWithLinks, links }; var meta = new { postList.PageSize, postList.PageIndex, postList.TotalItemsCount, postList.PageCount, }; Response.Headers.Add(\u0026#34;X-Pagination\u0026#34;, JsonConvert.SerializeObject(meta, new JsonSerializerSettings { //ä½¿å¾—å‘½åç¬¦åˆé©¼å³°å‘½åæ³•  ContractResolver = new CamelCasePropertyNamesContractResolver() })); return Ok(result); }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  [HttpGet(Name = \u0026#34;GetPosts\u0026#34;)] [RequestHeaderMatchingMediaType(\u0026#34;Accept\u0026#34;, new[] { \u0026#34;application/json\u0026#34; })] //ä¸æ˜¯è‡ªå®šä¹‰çš„mediaTypeæŒ‰jsonè¿”å›ï¼Œå…ƒæ•°æ®åŒ…å«åœ¨è¿”å›çš„headä¸­  public async Task\u0026lt;IActionResult\u0026gt; Get(PostParameters postParameters) { if (!_propertyMappingContainer.ValidateMappingExistsFor\u0026lt;PostResource, Post\u0026gt;(postParameters.OrderBy)) { return BadRequest(\u0026#34;cannot finds fields for sorting.\u0026#34;); } if (!_typeHelperService.TypeHasProperties\u0026lt;PostResource\u0026gt;(postParameters.Fields)) { return BadRequest(\u0026#34;Fields not exist.\u0026#34;); } var postList = await _postRepository.GetAllPostsAsync(postParameters); var postResources = _mapper.Map\u0026lt;IEnumerable\u0026lt;Post\u0026gt;, IEnumerable\u0026lt;PostResource\u0026gt;\u0026gt;(postList); var previousPageLink = postList.HasPrevious ? CreatePostUri(postParameters, PaginationResourceUriType.PreviousPage) : null; var nextPageLink = postList.HasNext ? CreatePostUri(postParameters, PaginationResourceUriType.NextPage) : null; var meta = new { postList.PageSize, postList.PageIndex, postList.TotalItemsCount, postList.PageCount, previousPageLink, nextPageLink }; Response.Headers.Add(\u0026#34;X-Pagination\u0026#34;, JsonConvert.SerializeObject(meta, new JsonSerializerSettings { //ä½¿å¾—å‘½åç¬¦åˆé©¼å³°å‘½åæ³•  ContractResolver = new CamelCasePropertyNamesContractResolver() })); return Ok(postResources.ToDynamicIEnumerable(postParameters.Fields)); }   ","description":"","id":26,"section":"code","tags":null,"title":"11_HATEOAS","uri":"https://xtddw.github.io/code/dotnetcore/11hateoas/"},{"content":"å®‰å…¨æ€§\u0026amp;å¹‚ç­‰æ€§  å®‰å…¨æ€§â˜æ–¹æ³•æ‰§è¡Œåå¹¶ä¸ä¼šæ”¹å˜èµ„æºçš„è¡¨è¿° å¹‚ç­‰æ€§â˜æ–¹æ³•æ— è®ºæ‰§è¡Œå¤šå°‘æ¬¡éƒ½ä¼šå¾—åˆ°åŒæ ·çš„ç»“æœ\n  POST æ·»åŠ èµ„æº ä¸å®‰å…¨ï¼Œä¸å¹‚ç­‰\n å‚æ•°[FromBody] è¿”å›201 Created\n* CreatedAtRoute(): å®ƒå…è®¸å“åº”é‡Œå¸¦ç€LocationHeaderï¼Œå…¶ä¸­åŒ…å«ç€ä¸€ä¸ªURI,é€šè¿‡è¿™ä¸ªURIå°±å¯ä»¥GETåˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„èµ„æºã€‚ HATEOAS   PostAddResource  1 2 3 4 5  public class PostAddResource { public string Title { get; set; } public string Body { get; set; } }   MappingProfile  1 2 3 4 5 6 7 8 9  public MappingProfile() { CreateMap\u0026lt;Post, PostResource\u0026gt;() .ForMember(dest =\u0026gt; dest.UpdateTime, opt =\u0026gt; opt.MapFrom(src =\u0026gt; src.LastModified)); CreateMap\u0026lt;PostResource, Post\u0026gt;(); CreateMap\u0026lt;PostAddResource,Post\u0026gt;(); }   Actionä¸­Postæ–¹æ³•  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  [HttpPost(Name =\u0026#34;CreatePost\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; Post([FromBody] PostAddResource postAddResource) { if (postAddResource == null) { return BadRequest(\u0026#34;not data!\u0026#34;); } var newPost = _mapper.Map\u0026lt;PostAddResource, Post\u0026gt;(postAddResource); newPost.Author = \u0026#34;admin\u0026#34;; newPost.LastModified = DateTime.Now; _postRepository.AddPost(newPost); if (!await _unitOfWork.SaveAsync()) { throw new Exception(\u0026#34;Save post data Failed!\u0026#34;); } var resultResource = _mapper.Map\u0026lt;Post, PostResource\u0026gt;(newPost); //HATEOAS  var links = CreateLinksForPost(newPost.Id); var linkedPostResource = resultResource.ToDynamic() as IDictionary\u0026lt;string, object\u0026gt;; linkedPostResource.Add(\u0026#34;links\u0026#34;, links); //return Ok(resultResource);//200  return CreatedAtRoute(\u0026#34;GetPost\u0026#34;,new { id = linkedPostResource[\u0026#34;Id\u0026#34;] },linkedPostResource); //201  }   Model éªŒè¯  å®šä¹‰éªŒè¯è§„åˆ™ æ£€æŸ¥éªŒè¯è§„åˆ™ æŠŠéªŒè¯é”™è¯¯ä¿¡æ¯å‘é€ç»™APIæ¶ˆè´¹è€…   å†…ç½®éªŒè¯ï¼š  DataAnnotation\n ValidationAttribute IValidatebleObject   ç¬¬ä¸‰æ–¹FluentValidation  å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSOC,Seperation of Concerns) å®‰è£…åŒ…\n* FluentValidation\n* FluentValidation.AspNetCore ä¸ºæ¯ä¸€ä¸ªResourceå»ºç«‹éªŒè¯å™¨  ç»§æ‰¿AbstractValidator\n      1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  public class PostAddResourceValidator:AbstractValidator\u0026lt;PostAddResource\u0026gt; { public PostAddResourceValidator() { RuleFor(x =\u0026gt; x.Title) .NotNull() .WithName(\u0026#34;æ ‡é¢˜\u0026#34;) .WithMessage(\u0026#34;{PropertyName}æ˜¯å¿…å¡«çš„\u0026#34;) .MaximumLength(50) .WithMessage(\u0026#34;{PropertyName}çš„æœ€å¤§é•¿åº¦æ˜¯{MaxLength}\u0026#34;); RuleFor(x =\u0026gt; x.Body) .NotNull() .WithName(\u0026#34;æ­£æ–‡\u0026#34;) .WithMessage(\u0026#34;{PropertyName}æ˜¯å¿…å¡«çš„\u0026#34;) .MinimumLength(50) .WithMessage(\u0026#34;{PropertyName}çš„æœ€å°é•¿åº¦æ˜¯{MaxLength}\u0026#34;); } }    é…ç½®  1 2  //æ³¨å†ŒFluentValidator services.AddTransient\u0026lt;IValidator\u0026lt;PostAddResource\u0026gt;, PostAddResourceValidator\u0026gt;();   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  services.AddMvc( options =\u0026gt; { options.ReturnHttpNotAcceptable = true; //å¼€å¯406  //options.OutputFormatters.Add(new XmlDataContractSerializerOutputFormatter());  //è‡ªå®šä¹‰mediaType  var outputFormatter = options.OutputFormatters.OfType\u0026lt;JsonOutputFormatter\u0026gt;().FirstOrDefault(); if (outputFormatter != null) { outputFormatter.SupportedMediaTypes.Add(\u0026#34;application/vnd.enfi.hateoas+json\u0026#34;); } }) .AddJsonOptions(options =\u0026gt; { options.SerializerSettings.ContractResolver = new CamelCasePropertyNamesContractResolver(); }) .AddFluentValidation();    éªŒè¯  ModelStatus.IsValid ModelState  å­—å…¸ï¼ŒåŒ…å«Modelçš„çŠ¶æ€ä»¥åŠModelæ‰€ç»‘å®šçš„éªŒè¯ å¯¹äºæäº¤çš„æ¯ä¸ªå±æ€§ï¼Œå®ƒéƒ½åŒ…å«äº†ä¸€ä¸ªé”™è¯¯ä¿¡æ¯çš„é›†åˆ     è¿”å›ï¼š422 UnprocessableEntity  éªŒè¯é”™è¯¯ä¿¡æ¯åœ¨å“åº”çš„bodyé‡Œé¢å¸¦å›å»    1 2 3 4  if (!ModelState.IsValid) { return UnprocessableEntity(ModelState); }    MediaType  1 2 3 4 5  var inputFormatter = options.InputFormatters.OfType\u0026lt;JsonInputFormatter\u0026gt;().FirstOrDefault(); if (inputFormatter!=null) { inputFormatter.SupportedMediaTypes.Add(\u0026#34;application/vnd.enfi.post.create+json\u0026#34;); }   1 2 3 4 5 6 7  [HttpPost(Name =\u0026#34;CreatePost\u0026#34;)] [RequestHeaderMatchingMediaType(\u0026#34;Content-Type\u0026#34;, new[] { \u0026#34;application/vnd.enfi.post.create+json\u0026#34; })] [RequestHeaderMatchingMediaType(\u0026#34;Accept\u0026#34;, new[] { \u0026#34;application/vnd.enfi.hateoas+json\u0026#34; })] public async Task\u0026lt;IActionResult\u0026gt; Post([FromBody] PostAddResource postAddResource) { ... }   POST ä¸€æ¬¡æ€§æ·»åŠ é›†åˆèµ„æº  æŠŠæ•´ä¸ªé›†åˆçœ‹ä½œä¸€ç§èµ„æº å‚æ•°[FromBody]IEnumerable è¿”å›201ï¼ŒCreatedAtRoute()ï¼Œå¸¦ç€IDçš„é›†åˆ GETæ–¹æ³•å‚æ•°ä¸ºIDçš„é›†åˆï¼Œç”¨äºæŸ¥è¯¢åˆ›å»ºçš„é›†åˆèµ„æº  ArrayModelBinder:IModelBinder    è‡ªå®šä¹‰éªŒè¯é”™è¯¯è¿”å›ç»“æœ  æ»¡è¶³Angularå®¢æˆ·ç«¯è¡¨å•éªŒè¯è¦æ±‚ï¼š  é”™è¯¯çš„ç±»å‹ï¼šrequired,maxLength \u0026hellip;   MyUnprocessableEntityObjectResult  ç»§æ‰¿ï¼šObjectResult ResourceValidationResult:Dictionary\u0026lt;string,IEnumerable\u0026gt;     PostAddResourceValidator  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  public class PostAddResourceValidator:AbstractValidator\u0026lt;PostAddResource\u0026gt; { public PostAddOrUpdateResourceValidator() { RuleFor(x =\u0026gt; x.Title) .NotNull() .WithName(\u0026#34;æ ‡é¢˜\u0026#34;) .WithMessage(\u0026#34;required|{propertyName}æ˜¯å¿…å¡«çš„\u0026#34;) .MaximumLength(50) .WithMessage(\u0026#34;maxlength|{PropertyName}çš„æœ€å¤§é•¿åº¦æ˜¯{MaxLength}\u0026#34;); RuleFor(x =\u0026gt; x.Body) .NotNull() .WithName(\u0026#34;æ­£æ–‡\u0026#34;) .WithMessage(\u0026#34;required|{PropertyName}æ˜¯å¿…å¡«çš„\u0026#34;) .MinimumLength(50) .WithMessage(\u0026#34;minlength|{PropertyName}çš„æœ€å°é•¿åº¦æ˜¯{MinLength}\u0026#34;); } }   ResourceValidationError  1 2 3 4 5 6 7 8 9 10 11 12  public class ResourceValidationError { public ResourceValidationError(string message,string validatorKey =\u0026#34;\u0026#34;) { Message = message; ValidatorKey = validatorKey; } public string Message { get; private set; } public string ValidatorKey { get; private set; } }   ResourceValidationResult  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36  public class ResourceValidationResult:Dictionary\u0026lt;string,IEnumerable\u0026lt;ResourceValidationError\u0026gt;\u0026gt; { public ResourceValidationResult():base(StringComparer.OrdinalIgnoreCase) { } public ResourceValidationResult(ModelStateDictionary modelState):this() { if (modelState ==null) { throw new ArgumentNullException(nameof(modelState)); } foreach (var keyModelStatePair in modelState) { var key = keyModelStatePair.Key; var errors = keyModelStatePair.Value.Errors; if (errors!=null\u0026amp;\u0026amp;errors.Count\u0026gt;0) { var errorsToAdd = new List\u0026lt;ResourceValidationError\u0026gt;(); foreach (var error in errors) { var keyAndMessage = error.ErrorMessage.Split(\u0026#39;|\u0026#39;); if (keyAndMessage.Length \u0026gt;1) { errorsToAdd.Add(new ResourceValidationError(keyAndMessage[1], keyAndMessage[0])); } else { errorsToAdd.Add(new ResourceValidationError(keyAndMessage[0])); } } Add(key, errorsToAdd); } } } }   MyUnprocessableEntityObjectResult  1 2 3 4 5 6 7 8 9 10 11  public class MyUnprocessableEntityObjectResult : UnprocessableEntityObjectResult { public MyUnprocessableEntityObjectResult(ModelStateDictionary modelState) : base(new ResourceValidationResult(modelState)) { if (modelState == null) { throw new ArgumentNullException(nameof(modelState)); } StatusCode = 422; } }   ä½¿ç”¨  1 2 3 4 5  if (!ModelState.IsValid) { return new MyUnprocessableEntityObjectResult(ModelState); //return UnprocessableEntity(ModelState); }   DELETE  å‚æ•°ï¼š ID è¿”å›ï¼š 204 No Content ä¸å®‰å…¨ å¹‚ç­‰ï¼šå¤šæ¬¡è¯·æ±‚çš„å‰¯ä½œç”¨å’Œå•æ¬¡è¯·æ±‚çš„å‰¯ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œæ¯æ¬¡å‘é€DELETEè¯·æ±‚åï¼ŒæœåŠ¡å™¨çš„çŠ¶æ€æ˜¯ä¸€æ ·çš„  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  [HttpDelete(\u0026#34;{id}\u0026#34;,Name =\u0026#34;DeletePost\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; DeletePost(int id) { var post = await _postRepository.GetPostByIdAsync(id); if (post ==null) { return NotFound(); } _postRepository.DeletePost(post); if (!await _unitOfWork.SaveAsync()) { throw new Exception($\u0026#34;Deleting post {id} failed when saving.\u0026#34;); } return NoContent(); }   PUT æ•´ä½“æ›´æ–°  å‚æ•°ï¼š ID [FromBody]ä¸éœ€è¦IDå±æ€§  å•ç‹¬çš„Resource Model.   è¿”å›ï¼š 204 No Content 202 OK ä¸å®‰å…¨ å¹‚ç­‰ æ•´ä½“æ›´æ–° å®¹æ˜“å¼•èµ·é—®é¢˜ é›†åˆèµ„æºæ•´ä½“æ›´æ–°   æŠ½è±¡çˆ¶ç±»  1 2 3 4 5  public class PostAddOrUpdateResource { public string Title { get; set; } public string Body { get; set; } }   ç»§æ‰¿  1 2 3  public class PostUpdateResource:PostAddOrUpdateResource { }   ä¿®æ”¹FluentValidator  1 2 3 4  public class PostAddOrUpdateResourceValidator\u0026lt;T\u0026gt;:AbstractValidator\u0026lt;T\u0026gt; where T:PostAddOrUpdateResource { ...... }   ä¿®æ”¹æ³¨å†Œ  1 2 3  //æ³¨å†ŒFluentValidator  services.AddTransient\u0026lt;IValidator\u0026lt;PostAddResource\u0026gt;, PostAddOrUpdateResourceValidator\u0026lt;PostAddResource\u0026gt;\u0026gt;(); services.AddTransient\u0026lt;IValidator\u0026lt;PostUpdateResource\u0026gt;, PostAddOrUpdateResourceValidator\u0026lt;PostUpdateResource\u0026gt;\u0026gt;();   æ·»åŠ mappingProfile  1  CreateMap\u0026lt;PostUpdateResource,Post\u0026gt;();   6.Action\u0026raquo;\u0026gt;Post\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  [HttpPut(\u0026#34;{id}\u0026#34;,Name =\u0026#34;UpdatePost\u0026#34;)] //æ³¨æ„è¦åœ¨mvcä¸­æ³¨å†Œ Content-Type [RequestHeaderMatchingMediaType(\u0026#34;Content-Type\u0026#34;, new[] { \u0026#34;application/vnd.enfi.post.update+json\u0026#34; })] public async Task\u0026lt;IActionResult\u0026gt; UpdatePost(int id,[FromBody] PostUpdateResource postUpdate) { if (postUpdate == null) { return BadRequest(); } if (!ModelState.IsValid) { return new MyUnprocessableEntityObjectResult(ModelState); } var post = await _postRepository.GetPostByIdAsync(id); if (post == null) { return NotFound(\u0026#34;Cannot found the data for update.\u0026#34;); } post.LastModified = DateTime.Now; _mapper.Map(postUpdate, post); if (!await _unitOfWork.SaveAsync()) { throw new Exception($\u0026#34;Deleting post {id} failed when updating.\u0026#34;); } return NoContent(); }   PATCH å±€éƒ¨æ›´æ–°  application/json-patch+json\n å‚æ•°ï¼š ID [FromBody] JsonPatchDocument patchDoc.ApplyTo() è¿”å›ï¼š 204 No Content 202 OK ä¸å®‰å…¨ ä¸å¹‚ç­‰   Repositoryä¸­æ·»åŠ Updateæ–¹æ³•  1 2 3 4  public void UpdatePost(Post post) { _applicationContext.Entry(post).State = EntityState.Modified; }   Action ä¸­æ·»åŠ Updateæ–¹æ³•  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  [HttpPatch(\u0026#34;{id}\u0026#34;,Name =\u0026#34;PartiallyUpdatePost\u0026#34;)] public async Task\u0026lt;IActionResult\u0026gt; PartiallyUpdatePost(int id,[FromBody] JsonPatchDocument\u0026lt;PostUpdateResource\u0026gt; pathDoc) { if (pathDoc ==null) { return BadRequest(); } var post = await _postRepository.GetPostByIdAsync(id); if (post ==null) { return NotFound(\u0026#34;Cannot found the data for update.\u0026#34;); } var postToPatch = _mapper.Map\u0026lt;PostUpdateResource\u0026gt;(post); pathDoc.ApplyTo(postToPatch, ModelState); TryValidateModel(postToPatch); if (!ModelState.IsValid) { return new MyUnprocessableEntityObjectResult(ModelState); } _mapper.Map(postToPatch, post); post.LastModified = DateTime.Now; _postRepository.UpdatePost(post); if (!await _unitOfWork.SaveAsync()) { throw new Exception($\u0026#34;post {id} failed when partially updating patch.\u0026#34;); } return NoContent(); }   æ€»ç»“ ","description":"","id":27,"section":"code","tags":null,"title":"12_CURD","uri":"https://xtddw.github.io/code/dotnetcore/12postputpatchdelete/"},{"content":"BASE ","description":"","id":28,"section":"code","tags":null,"title":"base go","uri":"https://xtddw.github.io/code/go/base/"},{"content":"å‡†å¤‡  https://identityserver4.readthedocs.io/en/release/ OpenID Connect \u0026amp; OAuth 2.0 framework for ASP.NET Core 2.   å»ºç«‹Identity Provideré¡¹ç›®   IdentityServer4.Templates https://github.com/IdentityServer/IdentityServer4.Templates å®‰è£…å·¥å…·:  dotnet new -i identityserver4.templates é‡ç½® â€œdotnet newâ€ åŠŸèƒ½åˆ—è¡¨: dotnet new --debug:reinit   æ¨¡æ¿:  dotnet new is4empty dotnet new is4ui dotnet new is4inmem dotnet new is4aspid dotnet new is4ef dotnet new is4admin (æ”¶è´¹)    åˆ›å»ºé¡¹ç›®  dotnet new -i identityserver4.templates dotnet new is4aspid --name BlogIdp å‡çº§ä¸º.NET Core 2.1, æ›´æ–°NugetåŒ… é…ç½®Hsts|HttpsRedirection  1 2 3 4 5 6 7 8 9 10 11 12 13 14  //æ³¨å†ŒHsts  services.AddHsts(options =\u0026gt; { options.Preload = true; options.IncludeSubDomains = true; options.MaxAge = TimeSpan.FromDays(60); }); //é…ç½®HTTPé‡å®šå‘  services.AddHttpsRedirection(options =\u0026gt; { options.RedirectStatusCode = StatusCodes.Status307TemporaryRedirect; options.HttpsPort = 6001; });   MVC æµ‹è¯•  å®‰å…¨/æœºå¯†å®¢æˆ·ç«¯(Confidential Client), å®ƒæ˜¯ä¼ ç»Ÿçš„æœåŠ¡å™¨ç«¯Webåº”ç”¨. å®ƒéœ€è¦é•¿æ—¶é—´è®¿é—®(long-lived access), æ‰€ä»¥éœ€è¦refresh token. é‚£ä¹ˆå®ƒå¯ä»¥ä½¿ç”¨Authorization Code Flowæˆ–Hybrid Flow. Hybrid Flowæ˜¯ç›¸å¯¹é«˜çº§ä¸€äº›çš„, å®ƒå¯ä»¥è®©å®¢æˆ·ç«¯é¦–å…ˆä»æˆæƒç«¯ç‚¹è·å¾—ä¸€ä¸ªID Tokenå¹¶é€šè¿‡æµè§ˆå™¨(front-channel)ä¼ é€’è¿‡æ¥, è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éªŒè¯è¿™ä¸ªID Token. å¦‚æœéªŒè¯æˆåŠŸç„¶å, å®¢æˆ·ç«¯å†æ‰“å¼€ä¸€ä¸ªåç«¯é€šé“(back-channel), ä»Tokenç«¯ç‚¹è·å–Access Token.   èº«ä»½è®¤è¯è¯·æ±‚\n   ç¬¬ä¸€è¡Œçš„URI: \u0026ldquo;/authorize\u0026rdquo; å°±æ˜¯æˆæƒç«¯ç‚¹(Authorization Endpoint), å®ƒä½äºèº«ä»½æä¾›å•†(Identity provider, IDP)é‚£é‡Œ. è¿™ä¸ªURIå¯ä»¥ä»å‰é¢ä»‹ç»çš„discovery documenté‡Œé¢æ‰¾åˆ°. ç¬¬äºŒè¡ŒÂ response_type=code id_token, å®ƒå†³å®šäº†é‡‡å–äº†å“ªä¸€ç§Hybridæµç¨‹(å‚è€ƒä¸Šé¢é‚£ä¸‰ä¸ªå›¾). ç¬¬ä¸‰è¡Œ client_id=xxxx, è¿™æ˜¯å®¢æˆ·ç«¯çš„èº«ä»½æ ‡è¯†. ç¬¬å››è¡Œ redirect_uri=https\u0026hellip;., è¿™æ˜¯å®¢æˆ·ç«¯é‚£é‡Œçš„é‡å®šå‘ç«¯ç‚¹(Redirection Endpoint). ç¬¬äº”è¡Œ scope=openid profile email, è¿™å°±æ˜¯å®¢æˆ·ç«¯æ‰€è¯·æ±‚çš„scopes.  Hybrid Flow\n   ä¸ºä»€ä¹ˆè¦è¿”å›ä¸¤æ¬¡ID Tokenå‘¢? è¿™æ˜¯å› ä¸ºç¬¬(4)æ­¥é‡Œé¢è¯·æ±‚Tokençš„æ—¶å€™è¦æ±‚å®¢æˆ·ç«¯èº«ä»½è®¤è¯, è¿™æ—¶è¯·æ±‚Tokençš„æ—¶å€™éœ€è¦æä¾›Authorization Code, Client IDå’Œ Client Secret, è¿™äº›secretå¹¶ä¸æš´éœ²ç»™å¤–ç•Œ, è¿™äº›ä¸œè¥¿æ˜¯ç”±å®¢æˆ·ç«¯æœåŠ¡å™¨é€šè¿‡åç«¯é€šé“ä¼ é€’ç»™Tokenç«¯ç‚¹çš„. è€Œç¬¬ä¸€æ¬¡è·å¾—çš„ID Tokenæ˜¯ä»å‰ç«¯é€šé“(æµè§ˆå™¨)è¿”å›çš„.Â å½“è¿™ä¸ªID Tokenè¢«éªŒè¯é€šè¿‡ä¹‹å, ä¹Ÿå°±è¯æ˜äº†å½“å‰ç”¨æˆ·åˆ°åº•æ˜¯è°.\n  code demo  æ–°å»ºMVC ä¿®æ”¹ç«¯å£ä¸º7000ï¼Œ7001 ä¿®æ”¹Idpé¡¹ç›®config.cs  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  new Client { ClientId = \u0026#34;mvcclient\u0026#34;, ClientName = \u0026#34;MVCå®¢æˆ·ç«¯\u0026#34;, AllowedGrantTypes = GrantTypes.HybridAndClientCredentials, ClientSecrets = { new Secret(\u0026#34;49C1A7E1-0C79-4A89-A3D6-A37998FB86B0\u0026#34;.Sha256()) }, RedirectUris = { \u0026#34;http://localhost:7001/signin-oidc\u0026#34; }, FrontChannelLogoutUri = \u0026#34;http://localhost:7001/signout-oidc\u0026#34;, PostLogoutRedirectUris = { \u0026#34;http://localhost:7001/signout-callback-oidc\u0026#34; }, AllowOfflineAccess = true, //offline_access(refresh token)  AllowedScopes = { IdentityServerConstants.StandardScopes.OpenId }// { \u0026#34;openid\u0026#34;, \u0026#34;profile\u0026#34;, \u0026#34;api1\u0026#34; }  },   ä¿®æ”¹mvcé¡¹ç›®Startup  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77  public class Startup { public Startup(IConfiguration configuration) { Configuration = configuration; } public IConfiguration Configuration { get; } public void ConfigureServices(IServiceCollection services) { services.Configure\u0026lt;CookiePolicyOptions\u0026gt;(options =\u0026gt; { // This lambda determines whether user consent for non-essential cookies is needed for a given request.  options.CheckConsentNeeded = context =\u0026gt; true; options.MinimumSameSitePolicy = SameSiteMode.None; }); services.AddMvc().SetCompatibilityVersion(CompatibilityVersion.Version_2_1); JwtSecurityTokenHandler.DefaultInboundClaimTypeMap.Clear(); services.AddAuthentication(options =\u0026gt; { options.DefaultScheme = \u0026#34;Cookies\u0026#34;; options.DefaultChallengeScheme = \u0026#34;oidc\u0026#34;; }) .AddCookie(\u0026#34;Cookies\u0026#34;, options =\u0026gt; { options.AccessDeniedPath = \u0026#34;/Authorization/AccessDenied\u0026#34;; }) .AddOpenIdConnect(\u0026#34;oidc\u0026#34;, options =\u0026gt; { options.SignInScheme = \u0026#34;Cookies\u0026#34;; options.Authority = \u0026#34;https://localhost:6001\u0026#34;; options.RequireHttpsMetadata = true; options.ClientId = \u0026#34;mvcclient\u0026#34;; options.ResponseType = \u0026#34;code id_token\u0026#34;; options.Scope.Clear(); options.Scope.Add(\u0026#34;openid\u0026#34;); //ä¸Idpä¸­configå¯¹åº”  //options.Scope.Add(\u0026#34;profile\u0026#34;);  //options.Scope.Add(\u0026#34;email\u0026#34;);  //options.Scope.Add(\u0026#34;restapi\u0026#34;);  options.SaveTokens = true; options.ClientSecret = \u0026#34;49C1A7E1-0C79-4A89-A3D6-A37998FB86B0\u0026#34;; options.GetClaimsFromUserInfoEndpoint = true; }); } public void Configure(IApplicationBuilder app, IHostingEnvironment env) { if (env.IsDevelopment()) { app.UseDeveloperExceptionPage(); } else { app.UseExceptionHandler(\u0026#34;/Home/Error\u0026#34;); app.UseHsts(); } app.UseHttpsRedirection(); app.UseAuthentication(); app.UseStaticFiles(); app.UseCookiePolicy(); app.UseMvc(routes =\u0026gt; { routes.MapRoute( name: \u0026#34;default\u0026#34;, template: \u0026#34;{controller=Home}/{action=Index}/{id?}\u0026#34;); }); } }   HomeController æµ‹è¯•  1 2 3 4 5 6 7 8  [Authorize] public class HomeController : Controller { public IActionResult Index() { return View(); } ......   6. æ·»åŠ æ›´å¤šè·å–èµ„æº\n1 2 3 4 5 6 7 8  public async Task\u0026lt;IActionResult\u0026gt; About() { var idToken = await HttpContext.GetTokenAsync(OpenIdConnectParameterNames.IdToken); ViewData[\u0026#34;idToken\u0026#34;] = idToken; return View(); }   Config.csæ·»åŠ   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  public static IEnumerable\u0026lt;IdentityResource\u0026gt; GetIdentityResources() { return new IdentityResource[] { new IdentityResources.OpenId(), new IdentityResources.Profile(), new IdentityResources.Email(), }; } public static IEnumerable\u0026lt;ApiResource\u0026gt; GetApis() { return new ApiResource[] { new ApiResource(\u0026#34;restapi\u0026#34;, \u0026#34;My RESTful API\u0026#34;) }; }   1 2 3 4 5 6 7 8  AllowOfflineAccess = true, //offline_access(å¼€å¯refresh token)  AllowedScopes = { IdentityServerConstants.StandardScopes.OpenId, IdentityServerConstants.StandardScopes.Profile, IdentityServerConstants.StandardScopes.Email, \u0026#34;restapi\u0026#34; }// { \u0026#34;openid\u0026#34;, \u0026#34;profile\u0026#34;, \u0026#34;api1\u0026#34; }   ä¿®æ”¹html  1 2 3 4 5 6 7 8 9 10 11 12 13  @{ ViewData[\u0026#34;Title\u0026#34;] = \u0026#34;About\u0026#34;; } \u0026lt;h2\u0026gt;@ViewData[\u0026#34;Title\u0026#34;]\u0026lt;/h2\u0026gt; \u0026lt;h3\u0026gt;IdToken:@ViewData[\u0026#34;idToken\u0026#34;]\u0026lt;/h3\u0026gt; \u0026lt;dl\u0026gt; @foreach (var claim in User.Claims) { \u0026lt;dt\u0026gt;@claim.Type\u0026lt;/dt\u0026gt; \u0026lt;dd\u0026gt;@claim.Value\u0026lt;/dd\u0026gt; } \u0026lt;/dl\u0026gt;   ä¿æŠ¤APIèµ„æº  å®‰è£…åŒ… `IdentityServer4.AccessTokenValidation æ³¨å†Œ  1 2 3 4 5 6 7 8  // æ³¨å†ŒIdentityServer  services.AddAuthentication(IdentityServerAuthenticationDefaults.AuthenticationScheme) .AddIdentityServerAuthentication(options =\u0026gt; { options.Authority = \u0026#34;https://localhost:6001\u0026#34;; options.ApiName = \u0026#34;restapi\u0026#34;; });   config\napp.UseAuthentication(); apiä¸­åŠ éªŒè¯  å±æ€§æ ‡ç­¾ [Authorize] å…¨å±€filter    1 2 3 4 5 6 7 8  //è®¾ç½®å…¨å±€filterä¿æŠ¤apiéœ€è¦è®¤çœŸç”¨æˆ·æ‰å¯è®¿é—®  services.Configure\u0026lt;MvcOptions\u0026gt;(options =\u0026gt; { var policy = new AuthorizationPolicyBuilder() .RequireAuthenticatedUser() .Build(); options.Filters.Add(new AuthorizeFilter(policy)); });   NoAuth\n MVCå®¢æˆ·ç«¯   å®‰è£…IdentityModel ä¿®æ”¹HomeController  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  public async Task\u0026lt;IActionResult\u0026gt; Contact() { var httpClient = new HttpClient { BaseAddress = new Uri(\u0026#34;https://localhost:5001\u0026#34;) }; httpClient.DefaultRequestHeaders.Clear(); httpClient.DefaultRequestHeaders.Accept.Add( new MediaTypeWithQualityHeaderValue(\u0026#34;application/vnd.enfi.hateoas+json\u0026#34;) ); var accessToken = await HttpContext.GetTokenAsync(OpenIdConnectParameterNames.AccessToken); ViewData[\u0026#34;accessToken\u0026#34;] = accessToken; httpClient.SetBearerToken(accessToken); var res = await httpClient.GetAsync(\u0026#34;api/posts\u0026#34;).ConfigureAwait(false); if (res.IsSuccessStatusCode) { var json = await res.Content.ReadAsStringAsync().ConfigureAwait(false); var objects = JsonConvert.DeserializeObject\u0026lt;dynamic\u0026gt;(json); ViewData[\u0026#34;json\u0026#34;] = objects; return View(); } if (res.StatusCode == HttpStatusCode.Unauthorized) { return RedirectToAction(\u0026#34;AccessDenied\u0026#34;, \u0026#34;Authorization\u0026#34;); } throw new Exception($\u0026#34;Error Occurred:${res.ReasonPhrase}\u0026#34;); }    æ·»åŠ  Authorization/AccessDenied  1 2 3 4 5 6 7  public class AuthorizationController : Controller { public IActionResult AccessDenied() { return View(); } }   1 2 3 4  @{ViewData[\u0026#34;Title\u0026#34;] = \u0026#34;AccessDenied\u0026#34;;} \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Access Denied\u0026lt;/h2\u0026gt; \u0026lt;/div\u0026gt;   https://jwt.io ç½‘ç«™è§£ætoken  ","description":"","id":29,"section":"code","tags":null,"title":"ex_IdentityServer4","uri":"https://xtddw.github.io/code/dotnetcore/identityserver4/"},{"content":"OAuth 2.0 vs OpenId Connect OAuth 2.0  OAuth 2.0æ˜¯ä¸€ä¸ªå§”æ‰˜åè®®, å®ƒå¯ä»¥è®©é‚£äº›æ§åˆ¶èµ„æºçš„äººå…è®¸æŸä¸ªåº”ç”¨ä»£è¡¨ä»–ä»¬æ¥è®¿é—®ä»–ä»¬æ§åˆ¶çš„èµ„æº, æ³¨æ„æ˜¯ä»£è¡¨è¿™äº›äºº, è€Œä¸æ˜¯å‡å†’æˆ–æ¨¡ä»¿è¿™äº›äºº. è¿™ä¸ªåº”ç”¨ä»èµ„æºçš„æ‰€æœ‰è€…é‚£é‡Œè·å¾—åˆ°æˆæƒ(Authorization)å’Œaccess token, éšåå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªaccess tokenæ¥è®¿é—®èµ„æº. (è¿™é‡Œæåˆ°çš„å‡å†’æˆ–æ¨¡ä»¿å°±æ˜¯æŒ‡åœ¨å®¢æˆ·ç«¯å¤åˆ¶ä¸€ä»½ç”¨æˆ·åå’Œå¯†ç ï¼Œä»è€Œè·å–ç›¸åº”çš„æƒé™)ã€‚ æ˜¯å…³äºæˆæƒ(Authorization)çš„, å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥è¯·æ±‚access token, ä½¿ç”¨è¿™ä¸ªtokenå°±å¯ä»¥è®¿é—®APIèµ„æºäº† è®©å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥ä»£è¡¨èµ„æºæ‰€æœ‰è€…(é€šå¸¸æ˜¯ç”¨æˆ·)æ¥è®¿é—®è¢«ä¿æŠ¤çš„èµ„æº\n èµ„æºæ‰€æœ‰è€…(Resource Owner), ä»–æ‹¥æœ‰è®¿é—®APIèµ„æºçš„æƒé™, å¹¶ä¸”ä»–è¿˜å¯ä»¥å§”æ´¾æƒé™(delegate)ç»™å…¶ä»–åº”ç”¨æ¥è®¿é—®API. èµ„æºæ‰€æœ‰è€…é€šå¸¸æ˜¯å¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„äºº. è¢«ä¿æŠ¤çš„èµ„æº(Protected Resource)å°±æ˜¯èµ„æºæ‰€æœ‰è€…æ‹¥æœ‰æƒé™å»è®¿é—®çš„ç»„ä»¶, å®ƒå¯ä»¥æ˜¯å¾ˆå¤šç§å½¢å¼çš„, ä½†æ˜¯web APIçš„å½¢å¼è¿˜æ˜¯æœ€å¸¸è§çš„. å®¢æˆ·ç«¯(Client)åº”ç”¨å°±æ˜¯ä»£è¡¨èµ„æºæ‰€æœ‰è€…è®¿é—®è¢«ä¿æŠ¤èµ„æºçš„ä¸€ä¸ªè½¯ä»¶. æ³¨æ„å®ƒæ—¢ä¸æ˜¯æŒ‡æµè§ˆå™¨, ä¹Ÿä¸æ˜¯æŒ‡ç»™ä½ é’±è®©ä½ å¼€å‘è½¯ä»¶çš„äºº. åœ¨OAuth2é‡Œé¢, å®ƒæ˜¯æŒ‡è¢«ä¿æŠ¤çš„APIèµ„æºçš„æ¶ˆè´¹è€….     æˆæƒæœåŠ¡å™¨ (Authorization Server, AS)   æ˜¯è¢«å—ä¿æŠ¤çš„èµ„æºæ‰€ä¿¡ä»»çš„, å®ƒå¯ä»¥å‘è¡Œå…·æœ‰ç‰¹å®šç›®çš„çš„å®‰å…¨å‡­æ®ç»™å®¢æˆ·ç«¯åº”ç”¨, è¿™ä¸ªå‡­æ®å«åšOAuthçš„Â access token.\n  æˆæƒç§ç±»   Authorization Code mplicit Resource Owner Password Credentials, ç›´æ¥ä½¿ç”¨å¯†ç å‡­æ®(ç”¨æˆ·åå’Œå¯†ç )ä½œä¸ºæˆæƒæ¥è·å¾—access token. åªæœ‰å½“èµ„æºæ‰€æœ‰è€…å’Œå®¢æˆ·ç«¯ä¹‹é—´é«˜åº¦ä¿¡ä»»çš„æ—¶å€™å¹¶ä¸”å…¶å®ƒæˆæƒæ–¹å¼ä¸å¯ç”¨çš„æ—¶å€™æ‰å¯ä»¥ä½¿ç”¨è¿™ç§æˆæƒæ–¹å¼ Client Credentials, æœ‰æ—¶å€™, èµ„æºæˆ–è€…å«èµ„æºæœåŠ¡å™¨å¹¶ä¸å±äºæŸä¸ªæœ€ç»ˆç”¨æˆ·, ä¹Ÿå°±æ˜¯æ²¡æœ‰èµ„æºæ‰€æœ‰è€…å¯¹è¯¥èµ„æºè´Ÿè´£. ä½†æ˜¯å®¢æˆ·ç«¯åº”ç”¨è‚¯å®šè¿˜æ˜¯è¦è®¿é—®è¿™äº›èµ„æº, è¿™æ—¶å€™å°±åªèƒ½ä½¿ç”¨Client Credentialsè¿™ç§æˆæƒæ–¹å¼äº†.  å…¶å®ƒé‡è¦è§’è‰²å’Œç»„ä»¶   èµ„æºæ‰€æœ‰è€…Â Resource Owner å®¢æˆ·ç«¯Â Client è¢«ä¿æŠ¤èµ„æºÂ Protected Resource æˆæƒæœåŠ¡å™¨Â Authorization Server Access Token, å®ƒæ˜¯ç”¨æ¥è®¿é—®è¢«ä¿æŠ¤èµ„æºçš„å‡­æ®. æˆæƒæœåŠ¡å™¨åªæ˜¯å‘è¡Œtoken, è¢«ä¿æŠ¤èµ„æºéªŒè¯token. å®¢æˆ·ç«¯å¯¹äºaccess tokenåº”è¯¥æ˜¯å®Œå…¨å¥å¿˜çš„. Scopes, è¡¨ç¤ºè¢«ä¿æŠ¤èµ„æºé‚£é‡Œçš„ä¸€å¥—æƒé™, å…·æœ‰å åŠ æ€§. Refresh Token, ç”¨æ¥è·å¾—Access Tokençš„å‡­æ®. å®¢æˆ·ç«¯æ˜¯ç”¨refresh tokenæ¥è¯·æ±‚æ–°çš„access token  é€šè¿‡refresh tokenæ¥å–å¾—æ–°çš„access tokençš„æµç¨‹\n é‡è¦ç«¯ç‚¹   æˆæƒç«¯ç‚¹(authorization endpoint)æ˜¯ç”¨æ¥å’Œèµ„æºæ‰€æœ‰è€…äº¤äº’çš„, èµ„æºæ‰€æœ‰è€…åœ¨è¿™é‡Œè¿›è¡Œç™»å½•(èº«ä»½è®¤è¯), ç„¶åé€šè¿‡è¯¥ç«¯ç‚¹å¯ä»¥å¯¹å®¢æˆ·ç«¯è¿›è¡Œæˆæƒ(authorization grant). æˆæƒæœåŠ¡å™¨é¦–å…ˆè¦éªŒè¯èµ„æºæ‰€æœ‰è€…çš„èº«ä»½, ä½†æ˜¯éªŒè¯çš„æ–¹å¼å¹¶ä¸åœ¨OAuth2çš„åè®®èŒƒå›´å†…. Tokenç«¯ç‚¹(token endpoint), å®¢æˆ·ç«¯é€šè¿‡å‘tokenç«¯ç‚¹å±•ç¤ºå®ƒçš„æˆæƒ(auhtorization grant)æˆ–refresh tokenæ¥è·å–access token. é™¤äº†implicitä¹‹å¤–æ‰€æœ‰çš„æˆæƒç±»å‹éƒ½éœ€è¦ä½¿ç”¨è¯¥ç«¯ç‚¹, å› ä¸ºimplicitçš„access tokenæ˜¯ç›´æ¥å‘è¡Œçš„.  OpenId Connect   èº«ä»½è®¤è¯ä¸æˆæƒ\n OAuth 2.0 ä¸æ˜¯èº«ä»½è®¤è¯(Authentication)åè®®, OpenId Connect å¯ä»¥è¿›è¡Œèº«ä»½è®¤è¯(Authentication).\nä¸€ä¸ªæ¯”å–»:\næˆæƒ: ç”Ÿç‰›å¥¶ (å¤šç”¨é€”åŸæ–™).\nèº«ä»½è®¤è¯: å¥¶èŒ¶ (ä¸€ä¸ªæœ€ç»ˆäº§å“), ä»¥ç‰›å¥¶ä¸ºä¸»åŸæ–™. OAuth 2.0, ç”Ÿç‰›å¥¶, ä¼—å¤šwebå®‰å…¨æ¶æ„çš„ä¸€ç§å¤šç”¨é€”çš„åŸºæœ¬æˆåˆ†. OIDC, å¥¶èŒ¶, åŸºäºOAuth 2.0çš„èº«ä»½è®¤è¯åè®®, æ·»åŠ äº†ä¸€äº›ç»„ä»¶æ¥æä¾›èº«ä»½è®¤è¯çš„èƒ½åŠ›.    æ›´é«˜çº§çš„åè®®, æ‰©å±•å¹¶æ›¿ä»£äº†OAuth2\n OpenID Connectæ˜¯å»ºç«‹åœ¨OAuth2åè®®ä¸Šçš„ä¸€ä¸ªç®€å•çš„èº«ä»½æ ‡è¯†å±‚, æ‰€ä»¥OpenID Connectå…¼å®¹OAuth2.Â  ä½¿ç”¨OpenID Connect, å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥è¯·æ±‚identity token, å®ƒä¼šå’Œaccess tokenä¸€åŒè¿”å›ç»™å®¢æˆ·ç«¯åº”ç”¨. è¿™ä¸ªidentity tokenå°±å¯ä»¥è¢«ç”¨æ¥ç™»å½•å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº, è€Œå®¢æˆ·ç«¯åº”ç”¨è¿˜å¯ä»¥ä½¿ç”¨access tokenæ¥è®¿é—®APIèµ„æº. UserInfoç«¯ç‚¹, (OAuth2å®šä¹‰äº†Authorizationç«¯ç‚¹å’ŒTokenç«¯ç‚¹)å®ƒå…è®¸å®¢æˆ·ç«¯åº”ç”¨è·å–ç”¨æˆ·çš„é¢å¤–ä¿¡æ¯.Â  å®šä¹‰äº†ä¸åŒç±»å‹çš„åº”ç”¨å¦‚ä½•ä»èº«ä»½è¯†åˆ«æä¾›å•†(IDP)å®‰å…¨çš„è·å–è¿™äº›token    ä¸OAuth 2.0ä¹‹é—´çš„è§’è‰²æ˜ å°„å…³ç³»\nèº«ä»½æä¾›å•†(Identity Provider, IdP)\nä¾èµ–æ–¹(Relying Party, RP, å¯ä»¥ç†è§£ä¸ºå®¢æˆ·ç«¯)\n OAuth2é‡Œå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†: 1.èµ„æºæ‰€æœ‰è€…/å®¢æˆ·ç«¯åº”ç”¨, 2.æˆæƒæœåŠ¡å™¨/è¢«ä¿æŠ¤èµ„æº. èº«ä»½è®¤è¯åè®®é‡Œä¹Ÿæ˜¯ä¸¤å¤§éƒ¨åˆ†: 1.ä¾èµ–æ–¹,Â 2.èº«ä»½æä¾›å•†. æ˜ å°„OAuth 2 \u0026mdash;- OIDC  æˆæƒæœåŠ¡å™¨/è¢«ä¿æŠ¤èµ„æº \u0026mdash;- èº«ä»½æä¾›å•†è¿›è¡Œæ˜ å°„ èµ„æºæ‰€æœ‰è€… \u0026mdash;- æœ€ç»ˆç”¨æˆ· å®¢æˆ·ç«¯åº”ç”¨ \u0026mdash;- ä¾èµ–æ–¹(RP).\n      æŠ½è±¡æµç¨‹\n ä¾èµ–å‘(RP)å‘é€è¯·æ±‚åˆ°OpenIDæä¾›å•†(OP, ä¹Ÿå°±æ˜¯èº«ä»½æä¾›å•†). OpenIDæä¾›å•†éªŒè¯æœ€ç»ˆç”¨æˆ·çš„èº«ä»½, å¹¶è·å¾—äº†ç”¨æˆ·å§”æ´¾çš„æˆæƒ OpenIDæä¾›å•†è¿”å›å“åº”, é‡Œé¢å¸¦ç€ID Token, ä¹Ÿé€šå¸¸å¸¦ç€Access Token. ä¾èµ–æ–¹ç°åœ¨å¯ä»¥ä½¿ç”¨Access Tokenå‘é€è¯·æ±‚åˆ°ç”¨æˆ·ä¿¡æ¯çš„ç«¯ç‚¹. ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹è¿”å›ç”¨æˆ·çš„å£°æ˜(claims, ç›¸å½“äºæ˜¯ç”¨æˆ·çš„ä¿¡æ¯).\n    èº«ä»½è®¤è¯æµç¨‹  Authorization Code Flow  åœ¨Authorization Code æµç¨‹é‡Œ, ä¸€ä¸ªæˆæƒç (Authorization Code)ä¼šè¢«è¿”å›ç»™å®¢æˆ·ç«¯. è¿™ä¸ªæˆæƒç å¯ä»¥è¢«ç›´æ¥ç”¨æ¥äº¤æ¢ID Tokenå’ŒAccess Token. è¯¥æµç¨‹ä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯ä½¿ç”¨æˆæƒç å…‘æ¢Access Tokenä¹‹å‰å¯¹å…¶èº«ä»½è®¤è¯. ä½†æ˜¯è¯¥æµç¨‹è¦æ±‚å®¢æˆ·ç«¯çš„èº«ä»½è®¤è¯åŠ¨ä½œåœ¨åå°ä½¿ç”¨client idå’Œsecretæ¥è·å¾—tokens, è¿™æ ·å°±ä¸ä¼šæŠŠtokensæš´éœ²ç»™æµè§ˆå™¨æˆ–å…¶å®ƒå¯è®¿é—®æµè§ˆå™¨çš„æ¶æ„åº”ç”¨äº†. è¦æ±‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥å®‰å…¨çš„åœ¨å®ƒå’ŒæˆæƒæœåŠ¡å™¨ä¹‹é—´ç»´æŠ¤å®¢æˆ·ç«¯çš„secret, ä¹Ÿå°±æ˜¯è¯´åªé€‚åˆè¿™æ ·çš„å®¢æˆ·ç«¯åº”ç”¨. å®ƒè¿˜é€‚åˆäºé•¿æ—¶é—´çš„è®¿é—®(é€šè¿‡refresh token). æˆæƒç æ¥è‡ªäºæˆæƒç«¯ç‚¹, è€Œæ‰€æœ‰çš„tokenséƒ½æ¥è‡ªäºTokenç«¯ç‚¹.Â  Authorization Codeæµç¨‹çš„æ­¥éª¤å¦‚ä¸‹:  å®¢æˆ·ç«¯å‡†å¤‡èº«ä»½è®¤è¯è¯·æ±‚, è¯·æ±‚é‡ŒåŒ…å«æ‰€éœ€çš„å‚æ•° å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æˆæƒæœåŠ¡å™¨ æˆæƒæœåŠ¡å™¨å¯¹æœ€ç»ˆç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ æˆæƒæœåŠ¡å™¨è·å¾—æœ€ç»ˆç”¨æˆ·çš„åŒæ„/æˆæƒ æˆæƒæœåŠ¡å™¨æŠŠæœ€ç»ˆç”¨æˆ·å‘é€å›å®¢æˆ·ç«¯, åŒæ—¶å¸¦ç€æˆæƒç  å®¢æˆ·ç«¯ä½¿ç”¨æˆæƒç å‘Tokenç«¯ç‚¹è¯·æ±‚ä¸€ä¸ªå“åº” å®¢æˆ·ç«¯æ¥æ”¶åˆ°å“åº”, å“åº”çš„bodyé‡Œé¢åŒ…å«ç€ID Token å’Œ Access Token å®¢æˆ·ç«¯éªŒè¯ID Token, å¹¶è·å¾—ç”¨æˆ·çš„ä¸€äº›èº«ä»½ä¿¡æ¯.     Implicit Flow(Angular)  Implicit Flowåœ¨è¯·æ±‚tokençš„æ—¶å€™ä¸éœ€è¦æ˜ç¡®çš„å®¢æˆ·ç«¯èº«ä»½è®¤è¯, å®ƒä½¿ç”¨é‡å®šå‘URIçš„æ–¹å¼æ¥éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½. å› ä¸ºè¿™ä¸€ç‚¹, refresh tokenä¹Ÿå°±æ— æ³•ä½¿ç”¨äº†, è¿™åŒæ ·ä¹Ÿä¸é€‚åˆäºé•¿æ—¶é—´æœ‰æ•ˆçš„access token. æ‰€æœ‰çš„tokenséƒ½æ¥è‡ªäºæˆæƒç«¯ç‚¹, è€ŒTokenç«¯ç‚¹å¹¶æ²¡æœ‰ç”¨åˆ°. è¯¥æµç¨‹ä¸»è¦ç”¨äºæµè§ˆå™¨å†…çš„åº”ç”¨, Access Tokenå’ŒID Tokenä¸€åŒè¢«ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯. å› ä¸ºè¿™ä¸ªåŸå› , è¿™äº›tokensä¹Ÿä¼šæš´éœ²äºæœ€ç»ˆç”¨æˆ·å’Œå¯ä»¥è®¿é—®è¯¥æµè§ˆå™¨çš„å…¶å®ƒåº”ç”¨äº†.Â  å®ƒå¹¶ä¸é€‚åˆäºé•¿æ—¶é—´çš„è®¿é—®. Implicitæµç¨‹çš„æ­¥éª¤å¦‚ä¸‹:  å®¢æˆ·ç«¯å‡†å¤‡èº«ä»½è®¤è¯è¯·æ±‚, è¯·æ±‚é‡ŒåŒ…å«æ‰€éœ€çš„å‚æ•° å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æˆæƒæœåŠ¡å™¨ æˆæƒæœåŠ¡å™¨å¯¹æœ€ç»ˆç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ æˆæƒæœåŠ¡å™¨è·å¾—æœ€ç»ˆç”¨æˆ·çš„åŒæ„/æˆæƒ æˆæƒæœåŠ¡å™¨æŠŠæœ€ç»ˆç”¨æˆ·å‘é€å›å®¢æˆ·ç«¯, åŒæ—¶å¸¦ç€ID Token. å¦‚æœä¹Ÿè¯·æ±‚äº†Access Tokençš„è¯, é‚£ä¹ˆAccess Tokenä¹Ÿä¼šä¸€åŒè¿”å›. å®¢æˆ·ç«¯éªŒè¯ID Token, å¹¶è·å¾—ç”¨æˆ·çš„ä¸€äº›èº«ä»½ä¿¡æ¯.     Hybrid Flow  Hybrid Flowæ˜¯å‰ä¸¤è€…çš„æ··åˆ, åœ¨è¯¥æµç¨‹é‡Œ. æœ‰ä¸€äº›tokenså’Œæˆæƒç æ¥è‡ªäºæˆæƒç«¯ç‚¹, è€Œå¦å¤–ä¸€äº›tokensåˆ™æ¥è‡ªäºTokenç«¯ç‚¹. è¯¥æµç¨‹å…è®¸å®¢æˆ·ç«¯ç«‹å³ä½¿ç”¨ID Token, å¹¶ä¸”åªéœ€è¦ä¸€æ¬¡å¾€è¿”å³å¯è·å¾—æˆæƒç . è¿™ç§æµç¨‹ä¹Ÿè¦æ±‚å®¢æˆ·ç«¯åº”ç”¨å¯ä»¥å®‰å…¨çš„ç»´æŠ¤secret. å®ƒä¹Ÿé€‚åˆäºé•¿æ—¶é—´çš„è®¿é—®.\nHybridæµç¨‹çš„æ­¥éª¤å¦‚ä¸‹:  å®¢æˆ·ç«¯å‡†å¤‡èº«ä»½è®¤è¯è¯·æ±‚, è¯·æ±‚é‡ŒåŒ…å«æ‰€éœ€çš„å‚æ•° å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æˆæƒæœåŠ¡å™¨ æˆæƒæœåŠ¡å™¨å¯¹æœ€ç»ˆç”¨æˆ·è¿›è¡Œèº«ä»½è®¤è¯ æˆæƒæœåŠ¡å™¨è·å¾—æœ€ç»ˆç”¨æˆ·çš„åŒæ„/æˆæƒ æˆæƒæœåŠ¡å™¨æŠŠæœ€ç»ˆç”¨æˆ·å‘é€å›å®¢æˆ·ç«¯, åŒæ—¶å¸¦ç€æˆæƒç , æ ¹æ®å“åº”ç±»å‹çš„ä¸åŒ, ä¹Ÿå¯èƒ½è¿˜å¸¦ç€ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…¶å®ƒçš„å‚æ•°. å®¢æˆ·ç«¯ä½¿ç”¨æˆæƒç å‘Tokenç«¯ç‚¹è¯·æ±‚ä¸€ä¸ªå“åº” å®¢æˆ·ç«¯æ¥æ”¶åˆ°å“åº”, å“åº”çš„bodyé‡Œé¢åŒ…å«ç€ID Token å’Œ Access Token å®¢æˆ·ç«¯éªŒè¯ID Token, å¹¶è·å¾—ç”¨æˆ·çš„ä¸€äº›èº«ä»½ä¿¡æ¯.     æ¯”è¾ƒ\n  Hybrid Flow æ ¹æ®response_typeçš„ä¸åŒ, åˆ†ä¸º:\n response_type=code id_token response_type=code token response_type=code id_token token\næ³¨æ„:ä¸ºäº†è¡¨æ˜æ˜¯OpenID Connectåè®®çš„è¯·æ±‚, scopeå‚æ•°é‡Œå¿…é¡»åŒ…å«openid   response_type=code id_token\n response_type=code token\n response_type=code id_token token\n  ","description":"","id":30,"section":"code","tags":null,"title":"ex_OAuth2","uri":"https://xtddw.github.io/code/dotnetcore/oauth2openidconnect/"},{"content":"flaskéƒ¨ç½² ä¸å»ºè®®åœ¨windowsç³»ç»Ÿä¸Šéƒ¨ç½²flaskåº”ç”¨\nå‡†å¤‡  IP config MongoDB setup MongoDB-express setup Nginx  linux ç³»ç»Ÿ * uwsgi  windowsç³»ç»Ÿ * waitress * ç¼–å†™.batæ–‡ä»¶ RunHiddenConsole * æŠŠ.batå¿«æ·æ–¹å¼å‘é€å¼€æœºå¯åŠ¨ç›®å½•  å“åº” flaské»˜è®¤æ”¯æŒ2ç§å“åº”æ–¹å¼ï¼š\n æ•°æ®å“åº”ï¼šé»˜è®¤å“åº”htmlæ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥è¿”å›JSONæ ¼å¼(jsonify()å‡½æ•°) é¡µé¢å“åº”ï¼š  é‡å®šå‘ redirect('\u0026ldquo;http://www.baidu.com\u0026quot;') || redirect('/json\u0026rsquo;) redirect(url_for(\u0026ldquo;è§†å›¾å‡½æ•°å\u0026rdquo;)ï¼‰è‡ªåŠ¨è§£æå¯¹åº”è§†å›¾å‡½æ•°åç§°çš„urlåœ°å€    å“åº”æ—¶ï¼Œflaskä¹Ÿæ”¯æŒè‡ªå®šä¹‰httpå“åº”çŠ¶æ€ç \n","description":"","id":31,"section":"code","tags":null,"title":"Flask","uri":"https://xtddw.github.io/code/python/flask/"},{"content":"jupyter  jupyter 0198  1 2 3 4 5 6  @echo off cd \u0026#34;c:\\jupyter\u0026#34;\rjupyter notebook\recho ã€æŒ‰ä»»æ„é”®é€€å‡ºã€‘\rpause\u0026gt;nul\rexit\r  mysql  3306 root 12346  1 2 3 4 5 6  @echo off cd \u0026#34;C:\\MySQL\\Engine\\bin\u0026#34;\rmysqld --console\recho ã€æŒ‰ä»»æ„é”®é€€å‡ºã€‘\rpause\u0026gt;nul\rexit\r  mkdocs 1  mkdocs serve --dev-addr=0.0.0.0:5858\r  zhtj  ID ggcjdss9/  server  10.30.0.14 enfiyjy-svr\\svradmin ggcjdss9/  ","description":"","id":32,"section":"note","tags":null,"title":"sercet","uri":"https://xtddw.github.io/note/sercet/"},{"content":"whoami  Name: å¼ å®˜ç¥¥ Phone: +8613811772347 Email: zhanggx@enfi.com.cn Blog: xtddw Company: ä¸­å›½æ©è²å·¥ç¨‹æŠ€æœ¯æœ‰é™å…¬å¸  ","description":"","id":33,"section":"","tags":null,"title":"","uri":"https://xtddw.github.io/about/"},{"content":"ä¸‡ ç‹ å¼  å®‹\nè¡Œä¸šè§£å†³æ–¹æ¡ˆ\næ•°æ®é©±åŠ¨\nä¸­çŸ³åŒ– PaaSæœåŠ¡\näº‘å¹³å°ç§Ÿèµ SaaSæœåŠ¡\nç§æœ‰äº‘ä¸å…¬æœ‰äº‘çš„ç‰ˆæœ¬ç»´æŠ¤ã€å®‰å…¨ç®¡ç†\nç»Ÿä¸€è®¾å¤‡æ¥å…¥æ ‡å‡†ï¼ˆRomaå¹³å°äº§å“)\nè®¾è®¡é™¢çš„æ•°å­—åŒ–äº¤ä»˜ï¼ˆäº§æƒã€ä½¿ç”¨æƒé™ç­‰ï¼‰\nä¾›åº”é“¾ååŒ\næ•°å­—åŒ–é›†æˆå¹³å°\nå…¨è¿æ¥å·¥é‹ååŒæ•°å­—åŒ–åº§èˆ± WeLink\nåä¸ºå»A\næ™ºæ…§å›­åŒº\nAtlasäººå·¥æ™ºèƒ½è®­ç»ƒç®—æ³•ï¼ŒåµŒå…¥è®¾å¤‡\nåˆä½œåˆ†å·¥ï¼šåä¸ºäº‘ç«¯èµ„æºæä¾›ï¼Œè¾¹ç¼˜è®¡ç®—æœåŠ¡\n","description":"","id":34,"section":"work","tags":null,"title":"","uri":"https://xtddw.github.io/work/huawei/"}]